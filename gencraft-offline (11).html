<!DOCTYPE html>
<html lang="en"><head><style>
        @import url(https://fonts.googleapis.com/css?family=Google+Sans+Text);
        html {
          font-family: 'Google Sans Text', 'Google Sans';
          font-size: 14px;
          color-scheme: light dark;
          background: light-dark(white, black);
          color: light-dark(black, white);
        }
        </style>
        
        <script type="importmap">{"imports":{"@modelcontextprotocol/sdk/":"https://aistudiocdn.com/@modelcontextprotocol/sdk/dist/esm/","https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/es2022/":"https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/es2022/dist/esm/","https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/client/index?target=es2022":"https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/dist/esm/client/index?target=es2022","https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/types?target=es2022":"https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/dist/esm/types?target=es2022","@google/genai":"https://esm.sh/@google/genai","react/":"https://esm.sh/react@^19.1.1/","react":"https://esm.sh/react@^19.1.1","@/index":"data:application/javascript;base64,aW1wb3J0IHsgR29vZ2xlR2VuQUksIFR5cGUgfSBmcm9tICJAZ29vZ2xlL2dlbmFpIjsKLy8gLS0tIFNvdW5kIE1hbmFnZXIgLS0tCmNvbnN0IFNvdW5kTWFuYWdlciA9IHsKICAgIGF1ZGlvQ29udGV4dDogbnVsbCwKICAgIGlzSW5pdGlhbGl6ZWQ6IGZhbHNlLAogICAgaW5pdCgpIHsKICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkIHx8IHR5cGVvZiB3aW5kb3cuQXVkaW9Db250ZXh0ID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpOwogICAgICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJXZWIgQXVkaW8gQVBJIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLiIsIGUpOwogICAgICAgIH0KICAgIH0sCiAgICBwbGF5U291bmQodHlwZSwgZnJlcXVlbmN5LCBkdXJhdGlvbiwgdm9sdW1lID0gMC41KSB7CiAgICAgICAgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IG9zY2lsbGF0b3IgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCk7CiAgICAgICAgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7CiAgICAgICAgb3NjaWxsYXRvci5jb25uZWN0KGdhaW5Ob2RlKTsKICAgICAgICBnYWluTm9kZS5jb25uZWN0KHRoaXMuYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTsKICAgICAgICBvc2NpbGxhdG9yLnR5cGUgPSB0eXBlOwogICAgICAgIG9zY2lsbGF0b3IuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKGZyZXF1ZW5jeSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUpOwogICAgICAgIGdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUodm9sdW1lLCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7CiAgICAgICAgZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDAwMSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7CiAgICAgICAgb3NjaWxsYXRvci5zdGFydCh0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7CiAgICAgICAgb3NjaWxsYXRvci5zdG9wKHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lICsgZHVyYXRpb24pOwogICAgfSwKICAgIHBsYXlDbGljaygpIHsKICAgICAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgdGhpcy5pbml0KCk7CiAgICAgICAgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHRoaXMucGxheVNvdW5kKCd0cmlhbmdsZScsIDUwMCwgMC4xLCAwLjMpOwogICAgICAgIHRoaXMucGxheVNvdW5kKCd0cmlhbmdsZScsIDgwMCwgMC4xLCAwLjMpOwogICAgfSwKICAgIHBsYXlUYWIoKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDcwMCwgMC4wOCwgMC4yKTsKICAgIH0sCiAgICBwbGF5Q29tYmluZSgpIHsKICAgICAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHRoaXMucGxheVNvdW5kKCdzYXd0b290aCcsIDIwMCwgMC4yLCAwLjQpOwogICAgICAgIHRoaXMucGxheVNvdW5kKCdzYXd0b290aCcsIDEwMCwgMC4zLCAwLjQpOwogICAgfSwKICAgIHBsYXlEaXNjb3ZlcigpIHsKICAgICAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5hdWRpb0NvbnRleHQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGxheVNvdW5kKCdzaW5lJywgNTIzLjI1LCAwLjEsIDAuNCksIDApOyAvLyBDNQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5wbGF5U291bmQoJ3NpbmUnLCA2NTkuMjUsIDAuMSwgMC40KSwgMTAwKTsgLy8gRTUKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGxheVNvdW5kKCdzaW5lJywgNzgzLjk5LCAwLjEsIDAuNCksIDIwMCk7IC8vIEc1CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDEwNDYuNTAsIDAuMiwgMC41KSwgMzAwKTsgLy8gQzYKICAgIH0sCiAgICBwbGF5RXJyb3IoKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB0aGlzLnBsYXlTb3VuZCgnc3F1YXJlJywgMTUwLCAwLjIsIDAuMyk7CiAgICB9Cn07Ci8vIC0tLSBHZW1pbmkgU2VydmljZSAtLS0KY29uc3QgYWkgPSBuZXcgR29vZ2xlR2VuQUkoeyBhcGlLZXk6IHByb2Nlc3MuZW52LkFQSV9LRVkgfSk7CmNvbnN0IHByZW1hZGVDb21iaW5hdGlvbnMgPSB7CiAgICAvLyBCYXNlIENvbWJpbmF0aW9ucwogICAgJ0Fpcl9FYXJ0aCc6IHsgbmFtZTogJ0R1c3QnLCBlbW9qaTogJ/CfjKzvuI8nIH0sICdBaXJfRmlyZSc6IHsgbmFtZTogJ1Ntb2tlJywgZW1vamk6ICfwn4yr77iPJyB9LCAnQWlyX1dhdGVyJzogeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwKICAgICdFYXJ0aF9GaXJlJzogeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfSwgJ0VhcnRoX1dhdGVyJzogeyBuYW1lOiAnUGxhbnQnLCBlbW9qaTogJ/CfjLEnIH0sICdGaXJlX1dhdGVyJzogeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwKICAgIC8vIFRpZXIgMiBDb21iaW5hdGlvbnMKICAgICdEdXN0X0ZpcmUnOiB7IG5hbWU6ICdHdW5wb3dkZXInLCBlbW9qaTogJ/CfkqMnIH0sICdEdXN0X1dhdGVyJzogeyBuYW1lOiAnTXVkJywgZW1vamk6ICfwn5KpJyB9LCAnRWFydGhfTGF2YSc6IHsgbmFtZTogJ1ZvbGNhbm8nLCBlbW9qaTogJ/CfjIsnIH0sCiAgICAnTGF2YV9XYXRlcic6IHsgbmFtZTogJ1N0b25lJywgZW1vamk6ICfwn6qoJyB9LCAnTGF2YV9BaXInOiB7IG5hbWU6ICdPYnNpZGlhbicsIGVtb2ppOiAn8J+WpCcgfSwgJ1BsYW50X0ZpcmUnOiB7IG5hbWU6ICdBc2gnLCBlbW9qaTogJ+KaqycgfSwKICAgICdQbGFudF9TbW9rZSc6IHsgbmFtZTogJ1RvYmFjY28nLCBlbW9qaTogJ/CfmqwnIH0sICdQbGFudF9TdG9uZSc6IHsgbmFtZTogJ0Zvc3NpbCcsIGVtb2ppOiAn8J+mtCcgfSwgJ1BsYW50X1dhdGVyJzogeyBuYW1lOiAnU3dhbXAnLCBlbW9qaTogJ/CfkIonIH0sCiAgICAnUGxhbnRfQWlyJzogeyBuYW1lOiAnUG9sbGVuJywgZW1vamk6ICfwn4y8JyB9LCAnUGxhbnRfRWFydGgnOiB7IG5hbWU6ICdHcmFzcycsIGVtb2ppOiAn8J+MvicgfSwgJ1JhaW5fRWFydGgnOiB7IG5hbWU6ICdNdWQnLCBlbW9qaTogJ/CfkqknIH0sCiAgICAnUmFpbl9GaXJlJzogeyBuYW1lOiAnUmFpbmJvdycsIGVtb2ppOiAn8J+MiCcgfSwgJ1N0ZWFtX0Fpcic6IHsgbmFtZTogJ0Nsb3VkJywgZW1vamk6ICfimIHvuI8nIH0sICdTdGVhbV9FYXJ0aCc6IHsgbmFtZTogJ0dleXNlcicsIGVtb2ppOiAn4pmo77iPJyB9LAogICAgJ1Ntb2tlX1dhdGVyJzogeyBuYW1lOiAnRm9nJywgZW1vamk6ICfwn4yr77iPJyB9LAogICAgLy8gVGllciAzIENvbWJpbmF0aW9ucwogICAgJ0FzaF9TdG9uZSc6IHsgbmFtZTogJ1N0YXR1ZScsIGVtb2ppOiAn8J+XvycgfSwgJ0Nsb3VkX0ZpcmUnOiB7IG5hbWU6ICdMaWdodG5pbmcnLCBlbW9qaTogJ+KaoScgfSwgJ0Nsb3VkX1dhdGVyJzogeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwKICAgICdHcmFzc19HcmFzcyc6IHsgbmFtZTogJ0xhd24nLCBlbW9qaTogJ/Cfj6EnIH0sICdHcmFzc19FYXJ0aCc6IHsgbmFtZTogJ0ZpZWxkJywgZW1vamk6ICfwn4+e77iPJyB9LCAnTGlnaHRuaW5nX01ldGFsJzogeyBuYW1lOiAnRWxlY3RyaWNpdHknLCBlbW9qaTogJ/CfkqEnIH0sCiAgICAnTGlnaHRuaW5nX0VhcnRoJzogeyBuYW1lOiAnQ3J5c3RhbCcsIGVtb2ppOiAn8J+SjicgfSwgJ011ZF9GaXJlJzogeyBuYW1lOiAnQnJpY2snLCBlbW9qaTogJ/Cfp7EnIH0sICdTdG9uZV9GaXJlJzogeyBuYW1lOiAnTWV0YWwnLCBlbW9qaTogJ/CflKknIH0sCiAgICAnU3RvbmVfV2F0ZXInOiB7IG5hbWU6ICdTYW5kJywgZW1vamk6ICfwn4+W77iPJyB9LCAnU3RvbmVfQWlyJzogeyBuYW1lOiAnU2FuZHN0b3JtJywgZW1vamk6ICfwn4yq77iPJyB9LAogICAgLy8gVGllciA0KwogICAgJ0JyaWNrX0JyaWNrJzogeyBuYW1lOiAnV2FsbCcsIGVtb2ppOiAn8J+nsScgfSwgJ0VsZWN0cmljaXR5X0dsYXNzJzogeyBuYW1lOiAnTGlnaHQgQnVsYicsIGVtb2ppOiAn8J+SoScgfSwgJ01ldGFsX1dhdGVyJzogeyBuYW1lOiAnUnVzdCcsIGVtb2ppOiAn8J+UqScgfSwKICAgICdTYW5kX0ZpcmUnOiB7IG5hbWU6ICdHbGFzcycsIGVtb2ppOiAn8J+lgycgfSwgJ1dhbGxfV2FsbCc6IHsgbmFtZTogJ0hvdXNlJywgZW1vamk6ICfwn4+gJyB9LAogICAgLy8gU2VsZi1jb21iaW5hdGlvbnMgJiBsb2dpY2FsIGV4dGVuc2lvbnMKICAgICdFYXJ0aF9FYXJ0aCc6IHsgbmFtZTogJ0xhbmQnLCBlbW9qaTogJ/Cfj57vuI8nIH0sICdXYXRlcl9XYXRlcic6IHsgbmFtZTogJ1NlYScsIGVtb2ppOiAn8J+MiicgfSwgJ1NlYV9TZWEnOiB7IG5hbWU6ICdPY2VhbicsIGVtb2ppOiAn8J+MiicgfSwKICAgICdPY2Vhbl9FYXJ0aCc6IHsgbmFtZTogJ0lzbGFuZCcsIGVtb2ppOiAn8J+Pne+4jycgfSwgJ1BsYW50X1BsYW50JzogeyBuYW1lOiAnR2FyZGVuJywgZW1vamk6ICfwn6q0JyB9LCAnR2FyZGVuX1BsYW50JzogeyBuYW1lOiAnRm9yZXN0JywgZW1vamk6ICfwn4yzJyB9LAogICAgJ0ZvcmVzdF9GaXJlJzogeyBuYW1lOiAnV2lsZGZpcmUnLCBlbW9qaTogJ/CflKUnIH0sICdTdG9uZV9TdG9uZSc6IHsgbmFtZTogJ01vdW50YWluJywgZW1vamk6ICfim7DvuI8nIH0sICdNb3VudGFpbl9MYXZhJzogeyBuYW1lOiAnRXJ1cHRpb24nLCBlbW9qaTogJ/CfjIsnIH0sCiAgICAvLyBMaWZlICYgSHVtYW4gUGF0aAogICAgJ0VhcnRoX0xpZmUnOiB7IG5hbWU6ICdIdW1hbicsIGVtb2ppOiAn8J+njScgfSwgJ0ZpcmVfTGlmZSc6IHsgbmFtZTogJ1Bob2VuaXgnLCBlbW9qaTogJ/CfkKbigI3wn5SlJyB9LCAnSHVtYW5fUGxhbnQnOiB7IG5hbWU6ICdGYXJtZXInLCBlbW9qaTogJ/CfkajigI3wn4y+JyB9LAogICAgJ0h1bWFuX1N0b25lJzogeyBuYW1lOiAnVG9vbCcsIGVtb2ppOiAn8J+UpycgfSwgJ0h1bWFuX0ZpcmUnOiB7IG5hbWU6ICdDb29rJywgZW1vamk6ICfwn5Go4oCN8J+NsycgfSwgJ0h1bWFuX1dhdGVyJzogeyBuYW1lOiAnU2FpbG9yJywgZW1vamk6ICfwn5Go4oCN4pyI77iPJyB9LAogICAgJ0h1bWFuX0h1bWFuJzogeyBuYW1lOiAnTG92ZScsIGVtb2ppOiAn4p2k77iPJyB9LCAnSHVtYW5fSG91c2UnOiB7IG5hbWU6ICdGYW1pbHknLCBlbW9qaTogJ/CfkajigI3wn5Gp4oCN8J+Rp+KAjfCfkaYnIH0sICdGYXJtZXJfRmllbGQnOiB7IG5hbWU6ICdXaGVhdCcsIGVtb2ppOiAn8J+MvicgfSwKICAgICdUb29sX0ZvcmVzdCc6IHsgbmFtZTogJ1dvb2QnLCBlbW9qaTogJ/CfqrUnIH0sICdUb29sX1dvb2QnOiB7IG5hbWU6ICdXaGVlbCcsIGVtb2ppOiAn8J+bnicgfSwgJ1doZWF0X1N0b25lJzogeyBuYW1lOiAnRmxvdXInLCBlbW9qaTogJ+KaqicgfSwKICAgICdGbG91cl9XYXRlcic6IHsgbmFtZTogJ0RvdWdoJywgZW1vamk6ICfwn42qJyB9LCAnRG91Z2hfRmlyZSc6IHsgbmFtZTogJ0JyZWFkJywgZW1vamk6ICfwn42eJyB9LAp9Owpjb25zdCByZXNwb25zZVNjaGVtYSA9IHsKICAgIHR5cGU6IFR5cGUuT0JKRUNULAogICAgcHJvcGVydGllczogewogICAgICAgIG5hbWU6IHsgdHlwZTogVHlwZS5TVFJJTkcsIGRlc2NyaXB0aW9uOiAiVGhlIG5hbWUgb2YgdGhlIHJlc3VsdGluZyBlbGVtZW50LiBTaG91bGQgYmUgc2ltcGxlLCBvbmUgb3IgdHdvIHdvcmRzLiBJZiB0aGUgY29tYmluYXRpb24gaXMgbm9uc2Vuc2ljYWwgb3IgcmVzdWx0cyBpbiB0aGUgc2FtZSBlbGVtZW50LCB1c2UgJ05vdGhpbmcnIG9yIHRoZSBvcmlnaW5hbCBlbGVtZW50J3MgbmFtZS4iIH0sCiAgICAgICAgZW1vamk6IHsgdHlwZTogVHlwZS5TVFJJTkcsIGRlc2NyaXB0aW9uOiAiQSBzaW5nbGUsIHJlbGV2YW50IGVtb2ppIGZvciB0aGUgcmVzdWx0aW5nIGVsZW1lbnQuIFVzZSAn8J+ktycgZm9yIG5vbnNlbnNpY2FsIGNvbWJpbmF0aW9ucy4iIH0sCiAgICAgICAgaXNOZXdEaXNjb3Zlcnk6IHsgdHlwZTogVHlwZS5CT09MRUFOLCBkZXNjcmlwdGlvbjogIlNldCB0byB0cnVlIGlmIHRoZSBjb21iaW5hdGlvbiBjcmVhdGVzIGEgZ2VudWluZWx5IG5ldyBhbmQgZGlzdGluY3QgZWxlbWVudC4gU2V0IHRvIGZhbHNlIGlmIGl0IHJlc3VsdHMgaW4gJ05vdGhpbmcnLCBvbmUgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnRzLCBvciBzb21ldGhpbmcgdHJpdmlhbC4iIH0sCiAgICAgICAgY29tbWVudGFyeTogeyB0eXBlOiBUeXBlLlNUUklORywgZGVzY3JpcHRpb246ICJBIHF1aXJreSwgc2hvcnQsIGZpcnN0LXBlcnNvbiBjb21tZW50IGZyb20gdGhlIHBlcnNwZWN0aXZlIG9mIHRoZSBuZXcgZWxlbWVudC4gTWF4IDE1IHdvcmRzLiIgfQogICAgfSwKICAgIHJlcXVpcmVkOiBbIm5hbWUiLCAiZW1vamkiLCAiaXNOZXdEaXNjb3ZlcnkiLCAiY29tbWVudGFyeSJdCn07CmFzeW5jIGZ1bmN0aW9uIGdldENvbWJpbmF0aW9uKGVsZW1lbnQxLCBlbGVtZW50MikgewogICAgY29uc3Qga2V5ID0gW2VsZW1lbnQxLm5hbWUsIGVsZW1lbnQyLm5hbWVdLnNvcnQoKS5qb2luKCdfJyk7CiAgICBjb25zdCBwcmVtYWRlUmVzdWx0ID0gcHJlbWFkZUNvbWJpbmF0aW9uc1trZXldOwogICAgaWYgKHByZW1hZGVSZXN1bHQpIHsKICAgICAgICByZXR1cm4geyAuLi5wcmVtYWRlUmVzdWx0LCBpc05ldzogdHJ1ZSwgY29tbWVudGFyeTogJ0EgY2xhc3NpYyBjb21iaW5hdGlvbiEnIH07CiAgICB9CiAgICBpZiAoZWxlbWVudDEubmFtZSA9PT0gZWxlbWVudDIubmFtZSkgewogICAgICAgIHJldHVybiB7IG5hbWU6IGVsZW1lbnQxLm5hbWUsIGVtb2ppOiBlbGVtZW50MS5lbW9qaSwgaXNOZXc6IGZhbHNlLCBjb21tZW50YXJ5OiAnVHdvIG9mIHRoZSBzYW1lIG1ha2Ugbm8gY2hhbmdlLicgfTsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJvbXB0ID0gYFlvdSBhcmUgYW4gQUkgZm9yIGEgY3JlYXRpdmUgYWxjaGVteSBnYW1lLiBXaGF0IGlzIGNyZWF0ZWQgd2hlbiB5b3UgY29tYmluZSAiJHtlbGVtZW50MS5uYW1lfSAke2VsZW1lbnQxLmVtb2ppfSIgYW5kICIke2VsZW1lbnQyLm5hbWV9ICR7ZWxlbWVudDIuZW1vaml9Ij8KICAgIC0gSWYgaXQgY3JlYXRlcyBhIG5ldywgbG9naWNhbCBpdGVtLCBwcm92aWRlIGl0cyBuYW1lLCBlbW9qaSwgYW5kIGEgZnVuIGNvbW1lbnRhcnkgZnJvbSBpdHMgcGVyc3BlY3RpdmUuCiAgICAtIElmIHRoZSBjb21iaW5hdGlvbiBpcyBpbGxvZ2ljYWwsIGltcG9zc2libGUsIG9yIGp1c3QgbWFrZXMgbW9yZSBvZiBvbmUgb2YgdGhlIGlucHV0cyAoZS5nLiwgRmlyZSArIEZpcmUpLCByZXNwb25kIHdpdGggYSByZXN1bHQgd2hlcmUgaXNOZXdEaXNjb3ZlcnkgaXMgZmFsc2UuCiAgICAtIEtlZXAgdGhlIG5hbWVzIHNpbXBsZSAoMS0zIHdvcmRzKS4gLSBCZSBjcmVhdGl2ZSBhbmQgY29uc2lzdGVudC5gOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7CiAgICAgICAgICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaCcsIGNvbnRlbnRzOiBwcm9tcHQsCiAgICAgICAgICAgIGNvbmZpZzogeyByZXNwb25zZU1pbWVUeXBlOiAnYXBwbGljYXRpb24vanNvbicsIHJlc3BvbnNlU2NoZW1hOiByZXNwb25zZVNjaGVtYSwgdGVtcGVyYXR1cmU6IDAuOCB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS50ZXh0LnRyaW0oKSk7CiAgICAgICAgcmV0dXJuIHsgbmFtZTogcmVzdWx0Lm5hbWUsIGVtb2ppOiByZXN1bHQuZW1vamksIGlzTmV3OiByZXN1bHQuaXNOZXdEaXNjb3ZlcnksIGNvbW1lbnRhcnk6IHJlc3VsdC5jb21tZW50YXJ5IH07CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjYWxsaW5nIEdlbWluaSBBUEk6IiwgZXJyb3IpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQp9Ci8vIC0tLSBBcHAgU3RhdGUgJiBDb25zdGFudHMgLS0tCmNvbnN0IGluaXRpYWxFbGVtZW50cyA9IFsKICAgIHsgbmFtZTogJ1dhdGVyJywgZW1vamk6ICfwn5KnJyB9LCB7IG5hbWU6ICdGaXJlJywgZW1vamk6ICfwn5SlJyB9LAogICAgeyBuYW1lOiAnRWFydGgnLCBlbW9qaTogJ/CfjI0nIH0sIHsgbmFtZTogJ0FpcicsIGVtb2ppOiAn8J+SqCcgfSwKXTsKY29uc3QgY2hhbGxlbmdlVGllcnMgPSBbCiAgICBbeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwgeyBuYW1lOiAnRHVzdCcsIGVtb2ppOiAn8J+MrO+4jycgfSwgeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwgeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfV0sCiAgICBbeyBuYW1lOiAnU3RvbmUnLCBlbW9qaTogJ/CfqqgnIH0sIHsgbmFtZTogJ1BsYW50JywgZW1vamk6ICfwn4yxJyB9LCB7IG5hbWU6ICdTbW9rZScsIGVtb2ppOiAn8J+Mq++4jycgfSwgeyBuYW1lOiAnT2JzaWRpYW4nLCBlbW9qaTogJ/CflqQnIH1dLAogICAgW3sgbmFtZTogJ011ZCcsIGVtb2ppOiAn8J+SqScgfSwgeyBuYW1lOiAnQnJpY2snLCBlbW9qaTogJ/Cfp7EnIH0sIHsgbmFtZTogJ0dyYXNzJywgZW1vamk6ICfwn4y+JyB9LCB7IG5hbWU6ICdTYW5kJywgZW1vamk6ICfwn4+W77iPJyB9XSwKICAgIFt7IG5hbWU6ICdNZXRhbCcsIGVtb2ppOiAn8J+UqScgfSwgeyBuYW1lOiAnR2xhc3MnLCBlbW9qaTogJ/CfpYMnIH0sIHsgbmFtZTogJ1dhbGwnLCBlbW9qaTogJ/Cfp7EnIH0sIHsgbmFtZTogJ0xpZ2h0bmluZycsIGVtb2ppOiAn4pqhJyB9XSwKICAgIFt7IG5hbWU6ICdIb3VzZScsIGVtb2ppOiAn8J+PoCcgfSwgeyBuYW1lOiAnRWxlY3RyaWNpdHknLCBlbW9qaTogJ/CfkqEnIH0sIHsgbmFtZTogJ0h1bWFuJywgZW1vamk6ICfwn6eNJyB9LCB7IG5hbWU6ICdQaG9lbml4JywgZW1vamk6ICfwn5Cm4oCN8J+UpScgfV0KXTsKY29uc3QgRElTQ09WRVJFRF9FTEVNRU5UU19LRVkgPSAnZ2VuY3JhZnRfZGlzY292ZXJlZEVsZW1lbnRzJzsKY29uc3QgQ0hBTExFTkdFX0xFVkVMX0tFWSA9ICdnZW5jcmFmdF9jaGFsbGVuZ2VMZXZlbCc7CmxldCBnYW1lTW9kZSA9ICdtZW51JzsgLy8gJ21lbnUnLCAnZnJlZScsICdjaGFsbGVuZ2UnCmxldCB3b3Jrc3BhY2VFbGVtZW50cyA9IFtdOwpsZXQgZGlzY292ZXJlZEVsZW1lbnRzID0gWy4uLmluaXRpYWxFbGVtZW50c107CmxldCBjaGFsbGVuZ2VTdGF0ZSA9IHsgbGV2ZWw6IDAsIHRhcmdldDogbnVsbCwgc3RhcnRUaW1lOiAwLCB0aW1lcjogJzAwOjAwJywgaXNBY3RpdmU6IGZhbHNlIH07CmxldCBuZXh0SWQgPSAwOwpsZXQgdGltZXJJbnRlcnZhbDsKbGV0IGRyYWdnaW5nSW5mbyA9IHsgaWQ6IG51bGwsIGVsZW1lbnQ6IG51bGwsIG9mZnNldFg6IDAsIG9mZnNldFk6IDAgfTsKbGV0IGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCA9IG51bGw7Ci8vIC0tLSBEYXRhIFBlcnNpc3RlbmNlIC0tLQpmdW5jdGlvbiBzYXZlUHJvZ3Jlc3MoKSB7CiAgICBpZiAoZ2FtZU1vZGUgPT09ICdmcmVlJykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKERJU0NPVkVSRURfRUxFTUVOVFNfS0VZLCBKU09OLnN0cmluZ2lmeShkaXNjb3ZlcmVkRWxlbWVudHMpKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIHNhdmUgcHJvZ3Jlc3M6IiwgZSk7CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIGxvYWRQcm9ncmVzcygpIHsKICAgIGNvbnN0IHNhdmVkRGlzY292ZXJpZXMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShESVNDT1ZFUkVEX0VMRU1FTlRTX0tFWSk7CiAgICBpZiAoc2F2ZWREaXNjb3ZlcmllcykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2Uoc2F2ZWREaXNjb3Zlcmllcyk7CiAgICAgICAgICAgIC8vIEJhc2ljIHZhbGlkYXRpb24gdG8gZW5zdXJlIGl0J3MgYSB2YWxpZCBhcnJheSBvZiBkaXNjb3ZlcmllcwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXJzZWQpICYmIHBhcnNlZC5sZW5ndGggPj0gaW5pdGlhbEVsZW1lbnRzLmxlbmd0aCAmJiBwYXJzZWRbMF0ubmFtZSkgewogICAgICAgICAgICAgICAgZGlzY292ZXJlZEVsZW1lbnRzID0gcGFyc2VkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBwYXJzZSBzYXZlZCBkaXNjb3ZlcmllczoiLCBlKTsKICAgICAgICB9CiAgICB9Cn0KLy8gLS0tIERPTSBSZWZlcmVuY2VzIC0tLQpjb25zdCB3b3Jrc3BhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NwYWNlJyk7CmNvbnN0IGdhbWVNZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUtbWVudScpOwpjb25zdCBjaGFsbGVuZ2VQcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXByb21wdCcpOwpjb25zdCBjaGFsbGVuZ2VIVUQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLWh1ZCcpOwpjb25zdCBlbmRHYW1lQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuZC1nYW1lLWJ0bicpOwpjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyk7CmNvbnN0IGFpUG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWktcG9wdXAnKTsKY29uc3QgZGlzY292ZXJ5Q291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzY292ZXJ5LWNvdW50Jyk7CmNvbnN0IGVsZW1lbnRzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbGVtZW50cy1saXN0Jyk7CmNvbnN0IHJlY2lwZXNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtbGlzdCcpOwpjb25zdCBzZWFyY2hJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gtaW5wdXQnKTsKY29uc3QgdGFiRWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLWVsZW1lbnRzJyk7CmNvbnN0IHRhYlJlY2lwZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLXJlY2lwZXMnKTsKY29uc3QgZWxlbWVudHNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VsZW1lbnRzLWVtcHR5LXN0YXRlJyk7CmNvbnN0IHJlY2lwZXNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtZW1wdHktc3RhdGUnKTsKY29uc3QgY2xlYXJTZWFyY2hCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItc2VhcmNoLWJ0bicpOwpjb25zdCBhcGlLZXlNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcGkta2V5LW1vZGFsJyk7CmNvbnN0IGFwaUtleUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaS1rZXktaW5wdXQnKTsKY29uc3QgYXBpS2V5U3VibWl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaS1rZXktc3VibWl0LWJ0bicpOwpjb25zdCBhcGlLZXlDYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBpLWtleS1jYW5jZWwtYnRuJyk7CmNvbnN0IGludHJvT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnRyby1vdmVybGF5Jyk7Ci8vIC0tLSBVSSBVcGRhdGUgRnVuY3Rpb25zIC0tLQpmdW5jdGlvbiB1cGRhdGVVSSgpIHsKICAgIC8vIEdhbWUgTW9kZSB2aXNpYmlsaXR5CiAgICBnYW1lTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBnYW1lTW9kZSAhPT0gJ21lbnUnKTsKICAgIGNoYWxsZW5nZUhVRC5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBnYW1lTW9kZSAhPT0gJ2NoYWxsZW5nZScgfHwgIWNoYWxsZW5nZVN0YXRlLmlzQWN0aXZlKTsKICAgIGVuZEdhbWVCdG4uZGlzYWJsZWQgPSBnYW1lTW9kZSA9PT0gJ21lbnUnOwogICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJykgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFsbGVuZ2UtbGV2ZWwnKS50ZXh0Q29udGVudCA9IGNoYWxsZW5nZVN0YXRlLmxldmVsLnRvU3RyaW5nKCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYWxsZW5nZS10YXJnZXQnKS50ZXh0Q29udGVudCA9IGNoYWxsZW5nZVN0YXRlLnRhcmdldD8ubmFtZSB8fCAnLi4uJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXRpbWVyJykudGV4dENvbnRlbnQgPSBjaGFsbGVuZ2VTdGF0ZS50aW1lcjsKICAgICAgICBlbmRHYW1lQnRuLmlubmVySFRNTCA9ICc8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHB4LTIiPlFVSVQ8L3NwYW4+JzsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGlmIChlbmRHYW1lQnRuRGVmYXVsdENvbnRlbnQpIHsKICAgICAgICAgICAgZW5kR2FtZUJ0bi5pbm5lckhUTUwgPSBlbmRHYW1lQnRuRGVmYXVsdENvbnRlbnQ7CiAgICAgICAgfQogICAgfQogICAgcmVuZGVyU2lkZWJhcigpOwogICAgcmVuZGVyV29ya3NwYWNlKCk7Cn0KZnVuY3Rpb24gcmVuZGVyV29ya3NwYWNlKCkgewogICAgd29ya3NwYWNlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5lbGVtZW50LWNhcmQnKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgIHdvcmtzcGFjZUVsZW1lbnRzLmZvckVhY2goZWwgPT4gewogICAgICAgIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBjYXJkLmNsYXNzTmFtZSA9ICdlbGVtZW50LWNhcmQnOwogICAgICAgIGNhcmQuZGF0YXNldC5pZCA9IFN0cmluZyhlbC5pZCk7CiAgICAgICAgY2FyZC5zdHlsZS5sZWZ0ID0gYCR7ZWwueH1weGA7CiAgICAgICAgY2FyZC5zdHlsZS50b3AgPSBgJHtlbC55fXB4YDsKICAgICAgICBjYXJkLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJ0ZXh0LTR4bCBtci0zIHBvaW50ZXItZXZlbnRzLW5vbmUiPiR7ZWwuZW1vaml9PC9kaXY+PGRpdiBjbGFzcz0idGV4dC1sZyBmb250LWJvbGQgZm9udC1vcmJpdHJvbiBwb2ludGVyLWV2ZW50cy1ub25lIHRydW5jYXRlIj4ke2VsLm5hbWV9PC9kaXY+YDsKICAgICAgICBpZiAoZWwuaXNOZXcpIHsKICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCduZXcnKTsKICAgICAgICAgICAgLy8gUmVtb3ZlIGNsYXNzIGFmdGVyIGFuaW1hdGlvbgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnbmV3JyksIDUwMCk7CiAgICAgICAgfQogICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IGhhbmRsZU1vdXNlRG93bihlLCBlbC5pZCkpOwogICAgICAgIHdvcmtzcGFjZS5hcHBlbmRDaGlsZChjYXJkKTsKICAgIH0pOwp9CmZ1bmN0aW9uIHJlbmRlclNpZGViYXIoKSB7CiAgICBjb25zdCB0ZXJtID0gc2VhcmNoSW5wdXQudmFsdWUudG9Mb3dlckNhc2UoKTsKICAgIC8vIFVwZGF0ZSBjb3VudAogICAgZGlzY292ZXJ5Q291bnQudGV4dENvbnRlbnQgPSBgJHtkaXNjb3ZlcmVkRWxlbWVudHMubGVuZ3RofSBmb3VuZGA7CiAgICAvLyBGaWx0ZXIgYW5kIHJlbmRlciBlbGVtZW50cwogICAgY29uc3QgZmlsdGVyZWRFbGVtZW50cyA9IGRpc2NvdmVyZWRFbGVtZW50cwogICAgICAgIC5maWx0ZXIoZWwgPT4gZWwubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pKQogICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTsKICAgIGVsZW1lbnRzTGlzdC5pbm5lckhUTUwgPSAnJzsKICAgIGlmIChmaWx0ZXJlZEVsZW1lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICBmaWx0ZXJlZEVsZW1lbnRzLmZvckVhY2goZWwgPT4gewogICAgICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICAgICAgYnRuLmNsYXNzTmFtZSA9ICJmbGV4IGl0ZW1zLWNlbnRlciBwLTIgYmctZ3JheS04MDAvNTAgcm91bmRlZC1sZyBob3ZlcjpiZy1jeWFuLTUwMC8yMCBib3JkZXIgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1jeWFuLTUwMCB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSI7CiAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9InRleHQtMnhsIG1yLTIiPiR7ZWwuZW1vaml9PC9zcGFuPjxzcGFuIGNsYXNzPSJ0ZXh0LXdoaXRlIHRleHQtc20gdHJ1bmNhdGUiPiR7ZWwubmFtZX08L3NwYW4+YDsKICAgICAgICAgICAgYnRuLm9uY2xpY2sgPSAoKSA9PiBzcGF3bkVsZW1lbnQoZWwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmYWxzZSk7CiAgICAgICAgICAgIGVsZW1lbnRzTGlzdC5hcHBlbmRDaGlsZChidG4pOwogICAgICAgIH0pOwogICAgfQogICAgZWxlbWVudHNFbXB0eVN0YXRlLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsIGZpbHRlcmVkRWxlbWVudHMubGVuZ3RoID4gMCk7CiAgICAvLyBGaWx0ZXIgYW5kIHJlbmRlciByZWNpcGVzCiAgICBjb25zdCBmaWx0ZXJlZFJlY2lwZXMgPSBkaXNjb3ZlcmVkRWxlbWVudHMKICAgICAgICAuZmlsdGVyKGVsID0+IGVsLnJlY2lwZSAmJiAoZWwubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pIHx8IGVsLnJlY2lwZS5lbGVtZW50MS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pIHx8IGVsLnJlY2lwZS5lbGVtZW50Mi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pKSkKICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7CiAgICByZWNpcGVzTGlzdC5pbm5lckhUTUwgPSAnJzsKICAgIGlmIChmaWx0ZXJlZFJlY2lwZXMubGVuZ3RoID4gMCkgewogICAgICAgIGZpbHRlcmVkUmVjaXBlcy5mb3JFYWNoKGVsID0+IHsKICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSAicC0yIGJnLWdyYXktODAwLzUwIHJvdW5kZWQtbGcgdGV4dC1zbSB0ZXh0LWNlbnRlciI7CiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCI+JHtlbC5yZWNpcGUuZWxlbWVudDF9PC9zcGFuPiArIDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7ZWwucmVjaXBlLmVsZW1lbnQyfTwvc3Bhbj4g4oaSIDxzcGFuIGNsYXNzPSJ0ZXh0LWN5YW4tMzAwIGZvbnQtYm9sZCI+JHtlbC5uYW1lfSAke2VsLmVtb2ppfTwvc3Bhbj5gOwogICAgICAgICAgICByZWNpcGVzTGlzdC5hcHBlbmRDaGlsZChkaXYpOwogICAgICAgIH0pOwogICAgfQogICAgcmVjaXBlc0VtcHR5U3RhdGUuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgZmlsdGVyZWRSZWNpcGVzLmxlbmd0aCA+IDApOwp9CmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykgewogICAgbG9hZGVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFzaG93KTsKfQpmdW5jdGlvbiBzaG93QUlQb3B1cCh7IHR5cGUsIHRpdGxlLCB0ZXh0LCBjb21tZW50YXJ5IH0pIHsKICAgIGNvbnN0IHRoZW1lcyA9IHsKICAgICAgICBzdWNjZXNzOiB7IGJnOiAnYmctZ3JlZW4tOTAwLzgwJywgYm9yZGVyOiAnYm9yZGVyLWdyZWVuLTQwMCcsIGljb246ICd0ZXh0LWdyZWVuLTMwMCcgfSwKICAgICAgICBlcnJvcjogeyBiZzogJ2JnLXJlZC05MDAvODAnLCBib3JkZXI6ICdib3JkZXItcmVkLTQwMCcsIGljb246ICd0ZXh0LXJlZC0zMDAnIH0sCiAgICAgICAgaW5mbzogeyBiZzogJ2JnLWJsdWUtOTAwLzgwJywgYm9yZGVyOiAnYm9yZGVyLWJsdWUtNDAwJywgaWNvbjogJ3RleHQtYmx1ZS0zMDAnIH0KICAgIH07CiAgICBjb25zdCB0aGVtZSA9IHRoZW1lc1t0eXBlXTsKICAgIGFpUG9wdXAuY2xhc3NOYW1lID0gYGZpeGVkIHRvcC01IGxlZnQtMS8yIC10cmFuc2xhdGUteC0xLzIgdy1mdWxsIG1heC13LXNtIHAtNCByb3VuZGVkLWxnIHNoYWRvdy0yeGwgYm9yZGVyLTIgYmFja2Ryb3AtYmx1ci1tZCB6LTUwIGFuaW1hdGUtZmFkZS1pbi1kb3duICR7dGhlbWUuYmd9ICR7dGhlbWUuYm9yZGVyfWA7CiAgICBsZXQgY29tbWVudGFyeUh0bWwgPSBjb21tZW50YXJ5ID8gYDxwIGNsYXNzPSJtdC0yIHRleHQtc20gaXRhbGljIGJvcmRlci1sLTIgcGwtMiAke3RoZW1lLmJvcmRlcn0gJHt0aGVtZS5pY29ufSI+JHtjb21tZW50YXJ5fTwvcD5gIDogJyc7CiAgICBhaVBvcHVwLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLXN0YXJ0Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC1zaHJpbmstMCI+CiAgICAgICAgICAgICAgICA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgY2xhc3M9ImgtNiB3LTYgJHt0aGVtZS5pY29ufSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik01IDN2NE0zIDVoNE02IDE3djRtLTItMmg0bTUtMTZsMi4yODYgNi44NTdMMjEgMTJsLTUuNzE0IDIuMTQzTDEzIDIxbC0yLjI4Ni02Ljg1N0w1IDEybDUuNzE0LTIuMTQzTDEzIDN6IiAvPgogICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtbC0zIHctMCBmbGV4LTEiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGcgZm9udC1ib2xkIGZvbnQtb3JiaXRyb24gdGV4dC13aGl0ZSI+JHt0aXRsZX08L3A+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtMSB0ZXh0LXNtICR7dHlwZSA9PT0gJ3N1Y2Nlc3MnID8gJ3RleHQtZ3JlZW4tMjAwJyA6IHR5cGUgPT09ICdlcnJvcicgPyAndGV4dC1yZWQtMjAwJyA6ICd0ZXh0LWJsdWUtMjAwJ30iPiR7dGV4dH08L3A+CiAgICAgICAgICAgICAgICAke2NvbW1lbnRhcnlIdG1sfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWwtNCBmbGV4LXNocmluay0wIGZsZXgiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY2xvc2UtcG9wdXAtYnRuIiBjbGFzcz0iaW5saW5lLWZsZXggcm91bmRlZC1tZCB0ZXh0LWdyYXktMzAwIGhvdmVyOnRleHQtd2hpdGUiPgogICAgICAgICAgICAgICAgICAgIDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBjbGFzcz0iaC01IHctNSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNiAxOEwxOCA2TTYgNmwxMiAxMiIgLz4KICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBhaVBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLXBvcHVwLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiBhaVBvcHVwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgc2V0VGltZW91dCgoKSA9PiBhaVBvcHVwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpLCA2MDAwKTsKfQpmdW5jdGlvbiBjcmVhdGVQYXJ0aWNsZUJ1cnN0KHgsIHkpIHsKICAgIGNvbnN0IGJ1cnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBidXJzdC5jbGFzc05hbWUgPSAncGFydGljbGUtYnVyc3QnOwogICAgYnVyc3Quc3R5bGUubGVmdCA9IGAke3ggKyA4MH1weGA7IC8vIGNlbnRlciBvbiBjYXJkCiAgICBidXJzdC5zdHlsZS50b3AgPSBgJHt5ICsgNDh9cHhgOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMjsgaSsrKSB7CiAgICAgICAgY29uc3QgcGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBwYXJ0aWNsZS5jbGFzc05hbWUgPSAncGFydGljbGUnOwogICAgICAgIHBhcnRpY2xlLnN0eWxlLnNldFByb3BlcnR5KCctLWknLCBpKTsKICAgICAgICBidXJzdC5hcHBlbmRDaGlsZChwYXJ0aWNsZSk7CiAgICB9CiAgICB3b3Jrc3BhY2UuYXBwZW5kQ2hpbGQoYnVyc3QpOwogICAgc2V0VGltZW91dCgoKSA9PiBidXJzdC5yZW1vdmUoKSwgNjAwKTsKfQovLyAtLS0gR2FtZSBMb2dpYyAtLS0KZnVuY3Rpb24gc3Bhd25FbGVtZW50KGVsZW1lbnQsIHgsIHksIGlzTmV3ID0gdHJ1ZSkgewogICAgY29uc3QgYm91bmRzID0gd29ya3NwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3QgbmV3WCA9IHggPz8gTWF0aC5yYW5kb20oKSAqIChib3VuZHMud2lkdGggLSAyMDApICsgMjA7CiAgICBjb25zdCBuZXdZID0geSA/PyBNYXRoLnJhbmRvbSgpICogKGJvdW5kcy5oZWlnaHQgLSAxNTApICsgMjA7CiAgICB3b3Jrc3BhY2VFbGVtZW50cy5wdXNoKHsgLi4uZWxlbWVudCwgaWQ6IG5leHRJZCsrLCB4OiBuZXdYLCB5OiBuZXdZLCBpc05ldyB9KTsKICAgIHJlbmRlcldvcmtzcGFjZSgpOwp9CmZ1bmN0aW9uIHJlc2V0V29ya3NwYWNlKHNwYXduSW5pdGlhbCA9IHRydWUpIHsKICAgIHdvcmtzcGFjZUVsZW1lbnRzID0gW107CiAgICBpZiAoc3Bhd25Jbml0aWFsKSB7CiAgICAgICAgY29uc3QgYm91bmRzID0gd29ya3NwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IFsKICAgICAgICAgICAgeyB4OiBib3VuZHMud2lkdGggLyAyIC0gMTYwIC0gMjAsIHk6IGJvdW5kcy5oZWlnaHQgLyAyIC0gOTYgLSAyMCB9LCB7IHg6IGJvdW5kcy53aWR0aCAvIDIgKyAyMCwgeTogYm91bmRzLmhlaWdodCAvIDIgLSA5NiAtIDIwIH0sCiAgICAgICAgICAgIHsgeDogYm91bmRzLndpZHRoIC8gMiAtIDE2MCAtIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sIHsgeDogYm91bmRzLndpZHRoIC8gMiArIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sCiAgICAgICAgXTsKICAgICAgICBpbml0aWFsRWxlbWVudHMuZm9yRWFjaCgoZWwsIGkpID0+IHNwYXduRWxlbWVudChlbCwgcG9zaXRpb25zW2ldLngsIHBvc2l0aW9uc1tpXS55LCBmYWxzZSkpOwogICAgfQogICAgcmVuZGVyV29ya3NwYWNlKCk7Cn0KYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUNvbWJpbmF0aW9uKGVsMSwgZWwyKSB7CiAgICBjb25zdCBjYXJkMSA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7ZWwxLmlkfSddYCk7CiAgICBjb25zdCBjYXJkMiA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7ZWwyLmlkfSddYCk7CiAgICBjYXJkMT8uY2xhc3NMaXN0LmFkZCgnY29tYmluaW5nJyk7CiAgICBjYXJkMj8uY2xhc3NMaXN0LmFkZCgnY29tYmluaW5nJyk7CiAgICBTb3VuZE1hbmFnZXIucGxheUNvbWJpbmUoKTsKICAgIHNob3dMb2FkZXIodHJ1ZSk7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb21iaW5hdGlvbihlbDEsIGVsMik7CiAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5pc05ldykgewogICAgICAgIFNvdW5kTWFuYWdlci5wbGF5RGlzY292ZXIoKTsKICAgICAgICBjb25zdCBpc0ZpcnN0RGlzY292ZXJ5ID0gIWRpc2NvdmVyZWRFbGVtZW50cy5zb21lKGQgPT4gZC5uYW1lID09PSByZXN1bHQubmFtZSk7CiAgICAgICAgY29uc3QgbmV3RWxlbWVudCA9IHsgbmFtZTogcmVzdWx0Lm5hbWUsIGVtb2ppOiByZXN1bHQuZW1vamkgfTsKICAgICAgICBpZiAoaXNGaXJzdERpc2NvdmVyeSkgewogICAgICAgICAgICBkaXNjb3ZlcmVkRWxlbWVudHMucHVzaCh7IC4uLm5ld0VsZW1lbnQsIHJlY2lwZTogeyBlbGVtZW50MTogZWwxLm5hbWUsIGVsZW1lbnQyOiBlbDIubmFtZSB9IH0pOwogICAgICAgICAgICBzYXZlUHJvZ3Jlc3MoKTsgLy8gU2F2ZSBhZnRlciBhIG5ldyBkaXNjb3ZlcnkgaW4gZnJlZSBwbGF5IG1vZGUKICAgICAgICAgICAgc2hvd0FJUG9wdXAoeyB0eXBlOiAnc3VjY2VzcycsIHRpdGxlOiAnRmlyc3QgRGlzY292ZXJ5IScsIHRleHQ6IGBZb3UndmUgY3JlYXRlZCAke3Jlc3VsdC5uYW1lfSAke3Jlc3VsdC5lbW9qaX0hYCwgY29tbWVudGFyeTogcmVzdWx0LmNvbW1lbnRhcnkgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzaG93QUlQb3B1cCh7IHR5cGU6ICdpbmZvJywgdGl0bGU6ICdOZXcgRWxlbWVudCEnLCB0ZXh0OiBgWW91IG1hZGUgJHtyZXN1bHQubmFtZX0gJHtyZXN1bHQuZW1vaml9IWAsIGNvbW1lbnRhcnk6IHJlc3VsdC5jb21tZW50YXJ5IH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBzcGF3blggPSAoZWwxLnggKyBlbDIueCkgLyAyOwogICAgICAgIGNvbnN0IHNwYXduWSA9IChlbDEueSArIGVsMi55KSAvIDI7CiAgICAgICAgd29ya3NwYWNlRWxlbWVudHMgPSB3b3Jrc3BhY2VFbGVtZW50cy5maWx0ZXIoZWwgPT4gZWwuaWQgIT09IGVsMS5pZCAmJiBlbC5pZCAhPT0gZWwyLmlkKTsKICAgICAgICBzcGF3bkVsZW1lbnQobmV3RWxlbWVudCwgc3Bhd25YLCBzcGF3blkpOwogICAgICAgIGNyZWF0ZVBhcnRpY2xlQnVyc3Qoc3Bhd25YLCBzcGF3blkpOwogICAgICAgIGlmIChnYW1lTW9kZSA9PT0gJ2NoYWxsZW5nZScgJiYgcmVzdWx0Lm5hbWUgPT09IGNoYWxsZW5nZVN0YXRlLnRhcmdldD8ubmFtZSkgewogICAgICAgICAgICBjaGFsbGVuZ2VTdGF0ZS5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICBjb25zdCB0aW1lVGFrZW4gPSAoRGF0ZS5ub3coKSAtIGNoYWxsZW5nZVN0YXRlLnN0YXJ0VGltZSkgLyAxMDAwOwogICAgICAgICAgICBjb25zdCB0aWVySW5kZXggPSBNYXRoLm1pbihNYXRoLmZsb29yKChjaGFsbGVuZ2VTdGF0ZS5sZXZlbCAtIDEpIC8gMiksIGNoYWxsZW5nZVRpZXJzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICBjb25zdCBnb2xkVGltZSA9IDEwICsgdGllckluZGV4ICogNTsKICAgICAgICAgICAgY29uc3Qgc2lsdmVyVGltZSA9IDIwICsgdGllckluZGV4ICogMTA7CiAgICAgICAgICAgIGxldCByYW5rID0gJ0Jyb256ZSDwn6WJJzsKICAgICAgICAgICAgaWYgKHRpbWVUYWtlbiA8IGdvbGRUaW1lKQogICAgICAgICAgICAgICAgcmFuayA9ICdHb2xkIPCfpYcnOwogICAgICAgICAgICBlbHNlIGlmICh0aW1lVGFrZW4gPCBzaWx2ZXJUaW1lKQogICAgICAgICAgICAgICAgcmFuayA9ICdTaWx2ZXIg8J+liCc7CiAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ3N1Y2Nlc3MnLCB0aXRsZTogYExldmVsICR7Y2hhbGxlbmdlU3RhdGUubGV2ZWx9IENvbXBsZXRlIWAsIHRleHQ6IGBSYW5rOiAke3Jhbmt9IHwgVGltZTogJHt0aW1lVGFrZW4udG9GaXhlZCgxKX1zYCwgY29tbWVudGFyeTogYFlvdSBjcmFmdGVkICR7Y2hhbGxlbmdlU3RhdGUudGFyZ2V0Lm5hbWV9IWAgfSk7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVksIEpTT04uc3RyaW5naWZ5KGNoYWxsZW5nZVN0YXRlLmxldmVsKSk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc3RhcnROZXh0TGV2ZWwoY2hhbGxlbmdlU3RhdGUubGV2ZWwpLCA0MDAwKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBTb3VuZE1hbmFnZXIucGxheUVycm9yKCk7CiAgICAgICAgY29uc3QgcmVhc29uID0gcmVzdWx0ID8gYENvbWJpbmluZyAke2VsMS5uYW1lfSBhbmQgJHtlbDIubmFtZX0gcmVzdWx0cyBpbiAke3Jlc3VsdC5uYW1lfS4gTm90aGluZyBuZXcgY3JlYXRlZC5gIDogIlRob3NlIGVsZW1lbnRzIGRvbid0IHNlZW0gdG8gY29tYmluZSB3ZWxsLiI7CiAgICAgICAgc2hvd0FJUG9wdXAoeyB0eXBlOiAnZXJyb3InLCB0aXRsZTogJ05vIFJlYWN0aW9uJywgdGV4dDogcmVhc29uLCBjb21tZW50YXJ5OiByZXN1bHQ/LmNvbW1lbnRhcnkgfSk7CiAgICB9CiAgICBzaG93TG9hZGVyKGZhbHNlKTsKICAgIGNhcmQxPy5jbGFzc0xpc3QucmVtb3ZlKCdjb21iaW5pbmcnKTsKICAgIGNhcmQyPy5jbGFzc0xpc3QucmVtb3ZlKCdjb21iaW5pbmcnKTsKICAgIHVwZGF0ZVVJKCk7Cn0KLy8gLS0tIEV2ZW50IEhhbmRsZXJzICYgR2FtZSBGbG93IC0tLQpmdW5jdGlvbiBoYW5kbGVNb3VzZURvd24oZSwgaWQpIHsKICAgIGlmIChnYW1lTW9kZSA9PT0gJ21lbnUnIHx8IGRyYWdnaW5nSW5mby5pZCkKICAgICAgICByZXR1cm47CiAgICBjb25zdCBlbGVtZW50ID0gd29ya3NwYWNlRWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gaWQpOwogICAgY29uc3QgY2FyZCA9IGUuY3VycmVudFRhcmdldDsKICAgIGlmICghZWxlbWVudCB8fCAhY2FyZCkKICAgICAgICByZXR1cm47CiAgICBjYXJkLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJyk7CiAgICBkcmFnZ2luZ0luZm8gPSB7CiAgICAgICAgaWQsIGVsZW1lbnQ6IGNhcmQsCiAgICAgICAgb2Zmc2V0WDogZS5jbGllbnRYIC0gY2FyZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0LAogICAgICAgIG9mZnNldFk6IGUuY2xpZW50WSAtIGNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wLAogICAgfTsKICAgIC8vIE1vdmUgdG8gdG9wCiAgICB3b3Jrc3BhY2UuYXBwZW5kQ2hpbGQoY2FyZCk7CiAgICBkb2N1bWVudC5vbm1vdXNlbW92ZSA9IGhhbmRsZU1vdXNlTW92ZTsKICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGhhbmRsZU1vdXNlVXA7Cn0KZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlKGUpIHsKICAgIGlmICghZHJhZ2dpbmdJbmZvLmlkIHx8ICFkcmFnZ2luZ0luZm8uZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBjb25zdCB7IGVsZW1lbnQsIG9mZnNldFgsIG9mZnNldFkgfSA9IGRyYWdnaW5nSW5mbzsKICAgIGNvbnN0IHdvcmtzcGFjZVJlY3QgPSB3b3Jrc3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBsZXQgeCA9IGUuY2xpZW50WCAtIHdvcmtzcGFjZVJlY3QubGVmdCAtIG9mZnNldFg7CiAgICBsZXQgeSA9IGUuY2xpZW50WSAtIHdvcmtzcGFjZVJlY3QudG9wIC0gb2Zmc2V0WTsKICAgIC8vIENsYW1wIHBvc2l0aW9uIHdpdGhpbiB3b3Jrc3BhY2UKICAgIHggPSBNYXRoLm1heCgwLCBNYXRoLm1pbih4LCB3b3Jrc3BhY2VSZWN0LndpZHRoIC0gZWxlbWVudC5vZmZzZXRXaWR0aCkpOwogICAgeSA9IE1hdGgubWF4KDAsIE1hdGgubWluKHksIHdvcmtzcGFjZVJlY3QuaGVpZ2h0IC0gZWxlbWVudC5vZmZzZXRIZWlnaHQpKTsKICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3h9cHhgOwogICAgZWxlbWVudC5zdHlsZS50b3AgPSBgJHt5fXB4YDsKICAgIGNvbnN0IGRyYWdnZWRSZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGZvciAoY29uc3Qgb3RoZXJFbCBvZiB3b3Jrc3BhY2VFbGVtZW50cykgewogICAgICAgIGlmIChvdGhlckVsLmlkID09PSBkcmFnZ2luZ0luZm8uaWQpCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNvbnN0IG90aGVyQ2FyZCA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7b3RoZXJFbC5pZH0nXWApOwogICAgICAgIGlmICghb3RoZXJDYXJkKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICBjb25zdCBvdGhlclJlY3QgPSBvdGhlckNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgaWYgKGRyYWdnZWRSZWN0LmxlZnQgPCBvdGhlclJlY3QucmlnaHQgJiYgZHJhZ2dlZFJlY3QucmlnaHQgPiBvdGhlclJlY3QubGVmdCAmJgogICAgICAgICAgICBkcmFnZ2VkUmVjdC50b3AgPCBvdGhlclJlY3QuYm90dG9tICYmIGRyYWdnZWRSZWN0LmJvdHRvbSA+IG90aGVyUmVjdC50b3ApIHsKICAgICAgICAgICAgY29uc3QgZHJhZ2dlZEVsZW1lbnQgPSB3b3Jrc3BhY2VFbGVtZW50cy5maW5kKGVsID0+IGVsLmlkID09PSBkcmFnZ2luZ0luZm8uaWQpOwogICAgICAgICAgICBpZiAoZHJhZ2dlZEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBwb3NpdGlvbiBmb3Igc3Bhd24gY2FsY3VsYXRpb24KICAgICAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50LnggPSB4OwogICAgICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQueSA9IHk7CiAgICAgICAgICAgICAgICBoYW5kbGVNb3VzZVVwKCk7CiAgICAgICAgICAgICAgICBwZXJmb3JtQ29tYmluYXRpb24oZHJhZ2dlZEVsZW1lbnQsIG90aGVyRWwpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIGhhbmRsZU1vdXNlVXAoKSB7CiAgICBpZiAoIWRyYWdnaW5nSW5mby5pZCB8fCAhZHJhZ2dpbmdJbmZvLmVsZW1lbnQpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgeyBpZCwgZWxlbWVudCB9ID0gZHJhZ2dpbmdJbmZvOwogICAgY29uc3QgZWxJblN0YXRlID0gd29ya3NwYWNlRWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gaWQpOwogICAgaWYgKGVsSW5TdGF0ZSkgewogICAgICAgIGVsSW5TdGF0ZS54ID0gcGFyc2VGbG9hdChlbGVtZW50LnN0eWxlLmxlZnQpOwogICAgICAgIGVsSW5TdGF0ZS55ID0gcGFyc2VGbG9hdChlbGVtZW50LnN0eWxlLnRvcCk7CiAgICB9CiAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nJyk7CiAgICBkcmFnZ2luZ0luZm8gPSB7IGlkOiBudWxsLCBlbGVtZW50OiBudWxsLCBvZmZzZXRYOiAwLCBvZmZzZXRZOiAwIH07CiAgICBkb2N1bWVudC5vbm1vdXNlbW92ZSA9IG51bGw7CiAgICBkb2N1bWVudC5vbm1vdXNldXAgPSBudWxsOwp9CmZ1bmN0aW9uIHN0YXJ0TmV4dExldmVsKGN1cnJlbnRMZXZlbCkgewogICAgY29uc3QgbmV4dExldmVsID0gY3VycmVudExldmVsICsgMTsKICAgIGNvbnN0IHRpZXJJbmRleCA9IE1hdGgubWluKE1hdGguZmxvb3IoKG5leHRMZXZlbCAtIDEpIC8gMiksIGNoYWxsZW5nZVRpZXJzLmxlbmd0aCAtIDEpOwogICAgY29uc3QgdGllciA9IGNoYWxsZW5nZVRpZXJzW3RpZXJJbmRleF07CiAgICBjb25zdCB0YXJnZXQgPSB0aWVyW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRpZXIubGVuZ3RoKV07CiAgICBjaGFsbGVuZ2VTdGF0ZSA9IHsgbGV2ZWw6IG5leHRMZXZlbCwgdGFyZ2V0LCBzdGFydFRpbWU6IERhdGUubm93KCksIHRpbWVyOiAnMDA6MDAnLCBpc0FjdGl2ZTogdHJ1ZSB9OwogICAgdGltZXJJbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IoKERhdGUubm93KCkgLSBjaGFsbGVuZ2VTdGF0ZS5zdGFydFRpbWUpIC8gMTAwMCk7CiAgICAgICAgY29uc3QgbWlucyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDYwKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3Qgc2VjcyA9IChzZWNvbmRzICUgNjApLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICBjaGFsbGVuZ2VTdGF0ZS50aW1lciA9IGAke21pbnN9OiR7c2Vjc31gOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFsbGVuZ2UtdGltZXInKS50ZXh0Q29udGVudCA9IGNoYWxsZW5nZVN0YXRlLnRpbWVyOwogICAgfSwgMTAwMCk7CiAgICByZXNldFdvcmtzcGFjZSgpOwogICAgdXBkYXRlVUkoKTsKfQpmdW5jdGlvbiBzdGFydEZyZWVQbGF5KCkgewogICAgZ2FtZU1vZGUgPSAnZnJlZSc7CiAgICByZXNldFdvcmtzcGFjZSgpOwogICAgdXBkYXRlVUkoKTsKfQpmdW5jdGlvbiBoYW5kbGVDaGFsbGVuZ2VTdGFydFJlcXVlc3QoKSB7CiAgICBjb25zdCBzYXZlZExldmVsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ0hBTExFTkdFX0xFVkVMX0tFWSk7CiAgICBpZiAoc2F2ZWRMZXZlbCAmJiBwYXJzZUludChzYXZlZExldmVsLCAxMCkgPiAwKSB7CiAgICAgICAgY2hhbGxlbmdlUHJvbXB0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSgpOwogICAgfQp9CmZ1bmN0aW9uIGhhbmRsZUNvbnRpbnVlQ2hhbGxlbmdlKCkgewogICAgY29uc3Qgc2F2ZWRMZXZlbCA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpIHx8ICcwJywgMTApOwogICAgZ2FtZU1vZGUgPSAnY2hhbGxlbmdlJzsKICAgIGRpc2NvdmVyZWRFbGVtZW50cyA9IFsuLi5pbml0aWFsRWxlbWVudHNdOwogICAgc3RhcnROZXh0TGV2ZWwoc2F2ZWRMZXZlbCk7CiAgICBjaGFsbGVuZ2VQcm9tcHQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0KZnVuY3Rpb24gaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSgpIHsKICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpOwogICAgZ2FtZU1vZGUgPSAnY2hhbGxlbmdlJzsKICAgIGRpc2NvdmVyZWRFbGVtZW50cyA9IFsuLi5pbml0aWFsRWxlbWVudHNdOwogICAgc3RhcnROZXh0TGV2ZWwoMCk7CiAgICBjaGFsbGVuZ2VQcm9tcHQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0KZnVuY3Rpb24gaGFuZGxlRW5kR2FtZSgpIHsKICAgIGdhbWVNb2RlID0gJ21lbnUnOwogICAgd29ya3NwYWNlRWxlbWVudHMgPSBbXTsKICAgIGlmIChjaGFsbGVuZ2VTdGF0ZS5pc0FjdGl2ZSkgewogICAgICAgIGNoYWxsZW5nZVN0YXRlLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsKTsKICAgIH0KICAgIHVwZGF0ZVVJKCk7Cn0KZnVuY3Rpb24gZ2V0QXBwU2NyaXB0KCkgewogICAgLy8gVGhpcyBmdW5jdGlvbiB3cmFwcyB0aGUgZW50aXJlIGFwcGxpY2F0aW9uIGxvZ2ljIGluIGEgc3RyaW5nLAogICAgLy8gbWFraW5nIGl0IHBvcnRhYmxlIGZvciB0aGUgb2ZmbGluZSBIVE1MIGZpbGUuCiAgICAvLyBOT1RFOiBBbGwgZnVuY3Rpb25zIGFuZCB2YXJpYWJsZXMgbXVzdCBiZSBzZWxmLWNvbnRhaW5lZCB3aXRoaW4gdGhpcyBmdW5jdGlvbidzIHNjb3BlLgogICAgY29uc3Qgc2NyaXB0ID0gKCkgPT4gewogICAgICAgIC8vIC0tLSBTdGFydCBvZiBFbWJlZGRlZCBBcHAgU2NyaXB0IC0tLQogICAgICAgIGNvbnN0IHsgR29vZ2xlR2VuQUksIFR5cGUgfSA9IHdpbmRvdy5nb29nbGVHZW5haTsKICAgICAgICAvLyAtLS0gRW1iZWRkZWQgU291bmQgTWFuYWdlciAtLS0KICAgICAgICBjb25zdCBTb3VuZE1hbmFnZXIgPSB7IGF1ZGlvQ29udGV4dDogbnVsbCwgaXNJbml0aWFsaXplZDogZmFsc2UsIGluaXQoKSB7IGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQgfHwgdHlwZW9mIHdpbmRvdy5BdWRpb0NvbnRleHQgPT09ICd1bmRlZmluZWQnKQogICAgICAgICAgICAgICAgcmV0dXJuOyB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7CiAgICAgICAgICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJXZWIgQXVkaW8gQVBJIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLiIsIGUpOwogICAgICAgICAgICB9IH0sIHBsYXlTb3VuZCh0eXBlLCBmcmVxdWVuY3ksIGR1cmF0aW9uLCB2b2x1bWUgPSAwLjUpIHsgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgICAgIHJldHVybjsgY29uc3Qgb3NjaWxsYXRvciA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZU9zY2lsbGF0b3IoKTsgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7IG9zY2lsbGF0b3IuY29ubmVjdChnYWluTm9kZSk7IGdhaW5Ob2RlLmNvbm5lY3QodGhpcy5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pOyBvc2NpbGxhdG9yLnR5cGUgPSB0eXBlOyBvc2NpbGxhdG9yLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShmcmVxdWVuY3ksIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lKTsgZ2Fpbk5vZGUuZ2Fpbi5zZXRWYWx1ZUF0VGltZSh2b2x1bWUsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lKTsgZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDAwMSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7IG9zY2lsbGF0b3Iuc3RhcnQodGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUpOyBvc2NpbGxhdG9yLnN0b3AodGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7IH0sIHBsYXlDbGljaygpIHsgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgICAgICB0aGlzLmluaXQoKTsgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgICAgIHJldHVybjsgdGhpcy5wbGF5U291bmQoJ3RyaWFuZ2xlJywgNTAwLCAwLjEsIDAuMyk7IHRoaXMucGxheVNvdW5kKCd0cmlhbmdsZScsIDgwMCwgMC4xLCAwLjMpOyB9LCBwbGF5VGFiKCkgeyBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgICAgIHJldHVybjsgdGhpcy5wbGF5U291bmQoJ3NpbmUnLCA3MDAsIDAuMDgsIDAuMik7IH0sIHBsYXlDb21iaW5lKCkgeyBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgICAgIHJldHVybjsgdGhpcy5wbGF5U291bmQoJ3Nhd3Rvb3RoJywgMjAwLCAwLjIsIDAuNCk7IHRoaXMucGxheVNvdW5kKCdzYXd0b290aCcsIDEwMCwgMC4zLCAwLjQpOyB9LCBwbGF5RGlzY292ZXIoKSB7IGlmICghdGhpcy5pc0luaXRpYWxpemVkIHx8ICF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgICAgIHJldHVybjsgc2V0VGltZW91dCgoKSA9PiB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDUyMy4yNSwgMC4xLCAwLjQpLCAwKTsgc2V0VGltZW91dCgoKSA9PiB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDY1OS4yNSwgMC4xLCAwLjQpLCAxMDApOyBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGxheVNvdW5kKCdzaW5lJywgNzgzLjk5LCAwLjEsIDAuNCksIDIwMCk7IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5wbGF5U291bmQoJ3NpbmUnLCAxMDQ2LjUwLCAwLjIsIDAuNSksIDMwMCk7IH0sIHBsYXlFcnJvcigpIHsgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgICAgICByZXR1cm47IHRoaXMucGxheVNvdW5kKCdzcXVhcmUnLCAxNTAsIDAuMiwgMC4zKTsgfSB9OwogICAgICAgIGNvbnN0IHByZW1hZGVDb21iaW5hdGlvbnMgPSB7CiAgICAgICAgICAgICdBaXJfRWFydGgnOiB7IG5hbWU6ICdEdXN0JywgZW1vamk6ICfwn4ys77iPJyB9LCAnQWlyX0ZpcmUnOiB7IG5hbWU6ICdTbW9rZScsIGVtb2ppOiAn8J+Mq++4jycgfSwgJ0Fpcl9XYXRlcic6IHsgbmFtZTogJ1JhaW4nLCBlbW9qaTogJ/CfjKfvuI8nIH0sICdFYXJ0aF9GaXJlJzogeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfSwgJ0VhcnRoX1dhdGVyJzogeyBuYW1lOiAnUGxhbnQnLCBlbW9qaTogJ/CfjLEnIH0sICdGaXJlX1dhdGVyJzogeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwgJ0R1c3RfRmlyZSc6IHsgbmFtZTogJ0d1bnBvd2RlcicsIGVtb2ppOiAn8J+SoycgfSwgJ0R1c3RfV2F0ZXInOiB7IG5hbWU6ICdNdWQnLCBlbW9qaTogJ/CfkqknIH0sICdFYXJ0aF9MYXZhJzogeyBuYW1lOiAnVm9sY2FubycsIGVtb2ppOiAn8J+MiycgfSwgJ0xhdmFfV2F0ZXInOiB7IG5hbWU6ICdTdG9uZScsIGVtb2ppOiAn8J+qqCcgfSwgJ0xhdmFfQWlyJzogeyBuYW1lOiAnT2JzaWRpYW4nLCBlbW9qaTogJ/CflqQnIH0sICdQbGFudF9GaXJlJzogeyBuYW1lOiAnQXNoJywgZW1vamk6ICfimqsnIH0sICdQbGFudF9TbW9rZSc6IHsgbmFtZTogJ1RvYmFjY28nLCBlbW9qaTogJ/CfmqwnIH0sICdQbGFudF9TdG9uZSc6IHsgbmFtZTogJ0Zvc3NpbCcsIGVtb2ppOiAn8J+mtCcgfSwgJ1BsYW50X1dhdGVyJzogeyBuYW1lOiAnU3dhbXAnLCBlbW9qaTogJ/CfkIonIH0sICdQbGFudF9BaXInOiB7IG5hbWU6ICdQb2xsZW4nLCBlbW9qaTogJ/CfjLwnIH0sICdQbGFudF9FYXJ0aCc6IHsgbmFtZTogJ0dyYXNzJywgZW1vamk6ICfwn4y+JyB9LCAnUmFpbl9FYXJ0aCc6IHsgbmFtZTogJ011ZCcsIGVtb2ppOiAn8J+SqScgfSwgJ1JhaW5fRmlyZSc6IHsgbmFtZTogJ1JhaW5ib3cnLCBlbW9qaTogJ/CfjIgnIH0sICdTdGVhbV9BaXInOiB7IG5hbWU6ICdDbG91ZCcsIGVtb2ppOiAn4piB77iPJyB9LCAnU3RlYW1fRWFydGgnOiB7IG5hbWU6ICdHZXlzZXInLCBlbW9qaTogJ+KZqO+4jycgfSwgJ1Ntb2tlX1dhdGVyJzogeyBuYW1lOiAnRm9nJywgZW1vamk6ICfwn4yr77iPJyB9LCAnQXNoX1N0b25lJzogeyBuYW1lOiAnU3RhdHVlJywgZW1vamk6ICfwn5e/JyB9LCAnQ2xvdWRfRmlyZSc6IHsgbmFtZTogJ0xpZ2h0bmluZycsIGVtb2ppOiAn4pqhJyB9LCAnQ2xvdWRfV2F0ZXInOiB7IG5hbWU6ICdSYWluJywgZW1vamk6ICfwn4yn77iPJyB9LCAnR3Jhc3NfR3Jhc3MnOiB7IG5hbWU6ICdMYXduJywgZW1vamk6ICfwn4+hJyB9LCAnR3Jhc3NfRWFydGgnOiB7IG5hbWU6ICdGaWVsZCcsIGVtb2ppOiAn8J+Pnu+4jycgfSwgJ0xpZ2h0bmluZ19NZXRhbCc6IHsgbmFtZTogJ0VsZWN0cmljaXR5JywgZW1vamk6ICfwn5KhJyB9LCAnTGlnaHRuaW5nX0VhcnRoJzogeyBuYW1lOiAnQ3J5c3RhbCcsIGVtb2ppOiAn8J+SjicgfSwgJ011ZF9GaXJlJzogeyBuYW1lOiAnQnJpY2snLCBlbW9qaTogJ/Cfp7EnIH0sICdTdG9uZV9GaXJlJzogeyBuYW1lOiAnTWV0YWwnLCBlbW9qaTogJ/CflKknIH0sICdTdG9uZV9XYXRlcic6IHsgbmFtZTogJ1NhbmQnLCBlbW9qaTogJ/Cfj5bvuI8nIH0sICdTdG9uZV9BaXInOiB7IG5hbWU6ICdTYW5kc3Rvcm0nLCBlbW9qaTogJ/CfjKrvuI8nIH0sICdCcmlja19Ccmljayc6IHsgbmFtZTogJ1dhbGwnLCBlbW9qaTogJ/Cfp7EnIH0sICdFbGVjdHJpY2l0eV9HbGFzcyc6IHsgbmFtZTogJ0xpZ2h0IEJ1bGInLCBlbW9qaTogJ/CfkqEnIH0sICdNZXRhbF9XYXRlcic6IHsgbmFtZTogJ1J1c3QnLCBlbW9qaTogJ/CflKknIH0sICdTYW5kX0ZpcmUnOiB7IG5hbWU6ICdHbGFzcycsIGVtb2ppOiAn8J+lgycgfSwgJ1dhbGxfV2FsbCc6IHsgbmFtZTogJ0hvdXNlJywgZW1vamk6ICfwn4+gJyB9LCAnRWFydGhfRWFydGgnOiB7IG5hbWU6ICdMYW5kJywgZW1vamk6ICfwn4+e77iPJyB9LCAnV2F0ZXJfV2F0ZXInOiB7IG5hbWU6ICdTZWEnLCBlbW9qaTogJ/CfjIonIH0sICdTZWFfU2VhJzogeyBuYW1lOiAnT2NlYW4nLCBlbW9qaTogJ/CfjIonIH0sICdPY2Vhbl9FYXJ0aCc6IHsgbmFtZTogJ0lzbGFuZCcsIGVtb2ppOiAn8J+Pne+4jycgfSwgJ1BsYW50X1BsYW50JzogeyBuYW1lOiAnR2FyZGVuJywgZW1vamk6ICfwn6q0JyB9LCAnR2FyZGVuX1BsYW50JzogeyBuYW1lOiAnRm9yZXN0JywgZW1vamk6ICfwn4yzJyB9LCAnRm9yZXN0X0ZpcmUnOiB7IG5hbWU6ICdXaWxkZmlyZScsIGVtb2ppOiAn8J+UpScgfSwgJ1N0b25lX1N0b25lJzogeyBuYW1lOiAnTW91bnRhaW4nLCBlbW9qaTogJ+KbsO+4jycgfSwgJ01vdW50YWluX0xhdmEnOiB7IG5hbWU6ICdFcnVwdGlvbicsIGVtb2ppOiAn8J+MiycgfSwgJ0VhcnRoX0xpZmUnOiB7IG5hbWU6ICdIdW1hbicsIGVtb2ppOiAn8J+njScgfSwgJ0ZpcmVfTGlmZSc6IHsgbmFtZTogJ1Bob2VuaXgnLCBlbW9qaTogJ/CfkKbigI3wn5SlJyB9LCAnSHVtYW5fUGxhbnQnOiB7IG5hbWU6ICdGYXJtZXInLCBlbW9qaTogJ/CfkajigI3wn4y+JyB9LCAnSHVtYW5fU3RvbmUnOiB7IG5hbWU6ICdUb29sJywgZW1vamk6ICfwn5SnJyB9LCAnSHVtYW5fRmlyZSc6IHsgbmFtZTogJ0Nvb2snLCBlbW9qaTogJ/CfkajigI3wn42zJyB9LCAnSHVtYW5fV2F0ZXInOiB7IG5hbWU6ICdTYWlsb3InLCBlbW9qaTogJ/CfkajigI3inIjvuI8nIH0sICdIdW1hbl9IdW1hbic6IHsgbmFtZTogJ0xvdmUnLCBlbW9qaTogJ+KdpO+4jycgfSwgJ0h1bWFuX0hvdXNlJzogeyBuYW1lOiAnRmFtaWx5JywgZW1vamk6ICfwn5Go4oCN8J+RqeKAjfCfkafigI3wn5GmJyB9LCAnRmFybWVyX0ZpZWxkJzogeyBuYW1lOiAnV2hlYXQnLCBlbW9qaTogJ/CfjL4nIH0sICdUb29sX0ZvcmVzdCc6IHsgbmFtZTogJ1dvb2QnLCBlbW9qaTogJ/CfqrUnIH0sICdUb29sX1dvb2QnOiB7IG5hbWU6ICdXaGVlbCcsIGVtb2ppOiAn8J+bnicgfSwgJ1doZWF0X1N0b25lJzogeyBuYW1lOiAnRmxvdXInLCBlbW9qaTogJ+KaqicgfSwgJ0Zsb3VyX1dhdGVyJzogeyBuYW1lOiAnRG91Z2gnLCBlbW9qaTogJ/CfjaonIH0sICdEb3VnaF9GaXJlJzogeyBuYW1lOiAnQnJlYWQnLCBlbW9qaTogJ/CfjZ4nIH0sCiAgICAgICAgfTsKICAgICAgICBjb25zdCByZXNwb25zZVNjaGVtYSA9IHsgdHlwZTogVHlwZS5PQkpFQ1QsIHByb3BlcnRpZXM6IHsgbmFtZTogeyB0eXBlOiBUeXBlLlNUUklORywgZGVzY3JpcHRpb246ICJUaGUgbmFtZSBvZiB0aGUgcmVzdWx0aW5nIGVsZW1lbnQuIFNob3VsZCBiZSBzaW1wbGUsIG9uZSBvciB0d28gd29yZHMuIElmIHRoZSBjb21iaW5hdGlvbiBpcyBub25zZW5zaWNhbCBvciByZXN1bHRzIGluIHRoZSBzYW1lIGVsZW1lbnQsIHVzZSAnTm90aGluZycgb3IgdGhlIG9yaWdpbmFsIGVsZW1lbnQncyBuYW1lLiIgfSwgZW1vamk6IHsgdHlwZTogVHlwZS5TVFJJTkcsIGRlc2NyaXB0aW9uOiAiQSBzaW5nbGUsIHJlbGV2YW50IGVtb2ppIGZvciB0aGUgcmVzdWx0aW5nIGVsZW1lbnQuIFVzZSAn8J+ktycgZm9yIG5vbnNlbnNpY2FsIGNvbWJpbmF0aW9ucy4iIH0sIGlzTmV3RGlzY292ZXJ5OiB7IHR5cGU6IFR5cGUuQk9PTEVBTiwgZGVzY3JpcHRpb246ICJTZXQgdG8gdHJ1ZSBpZiB0aGUgY29tYmluYXRpb24gY3JlYXRlcyBhIGdlbnVpbmVseSBuZXcgYW5kIGRpc3RpbmN0IGVsZW1lbnQuIFNldCB0byBmYWxzZSBpZiBpdCByZXN1bHRzIGluICdOb3RoaW5nJywgb25lIG9mIHRoZSBvcmlnaW5hbCBlbGVtZW50cywgb3Igc29tZXRoaW5nIHRyaXZpYWwuIiB9LCBjb21tZW50YXJ5OiB7IHR5cGU6IFR5cGUuU1RSSU5HLCBkZXNjcmlwdGlvbjogIkEgcXVpcmt5LCBzaG9ydCwgZmlyc3QtcGVyc29uIGNvbW1lbnQgZnJvbSB0aGUgcGVyc3BlY3RpdmUgb2YgdGhlIG5ldyBlbGVtZW50LiBNYXggMTUgd29yZHMuIiB9IH0sIHJlcXVpcmVkOiBbIm5hbWUiLCAiZW1vamkiLCAiaXNOZXdEaXNjb3ZlcnkiLCAiY29tbWVudGFyeSJdIH07CiAgICAgICAgY29uc3QgaW5pdGlhbEVsZW1lbnRzID0gW3sgbmFtZTogJ1dhdGVyJywgZW1vamk6ICfwn5KnJyB9LCB7IG5hbWU6ICdGaXJlJywgZW1vamk6ICfwn5SlJyB9LCB7IG5hbWU6ICdFYXJ0aCcsIGVtb2ppOiAn8J+MjScgfSwgeyBuYW1lOiAnQWlyJywgZW1vamk6ICfwn5KoJyB9XTsKICAgICAgICBjb25zdCBjaGFsbGVuZ2VUaWVycyA9IFtbeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwgeyBuYW1lOiAnRHVzdCcsIGVtb2ppOiAn8J+MrO+4jycgfSwgeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwgeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfV0sIFt7IG5hbWU6ICdTdG9uZScsIGVtb2ppOiAn8J+qqCcgfSwgeyBuYW1lOiAnUGxhbnQnLCBlbW9qaTogJ/CfjLEnIH0sIHsgbmFtZTogJ1Ntb2tlJywgZW1vamk6ICfwn4yr77iPJyB9LCB7IG5hbWU6ICdPYnNpZGlhbicsIGVtb2ppOiAn8J+WpCcgfV0sIFt7IG5hbWU6ICdNdWQnLCBlbW9qaTogJ/CfkqknIH0sIHsgbmFtZTogJ0JyaWNrJywgZW1vamk6ICfwn6exJyB9LCB7IG5hbWU6ICdHcmFzcycsIGVtb2ppOiAn8J+MvicgfSwgeyBuYW1lOiAnU2FuZCcsIGVtb2ppOiAn8J+Plu+4jycgfV0sIFt7IG5hbWU6ICdNZXRhbCcsIGVtb2ppOiAn8J+UqScgfSwgeyBuYW1lOiAnR2xhc3MnLCBlbW9qaTogJ/CfpYMnIH0sIHsgbmFtZTogJ1dhbGwnLCBlbW9qaTogJ/Cfp7EnIH0sIHsgbmFtZTogJ0xpZ2h0bmluZycsIGVtb2ppOiAn4pqhJyB9XSwgW3sgbmFtZTogJ0hvdXNlJywgZW1vamk6ICfwn4+gJyB9LCB7IG5hbWU6ICdFbGVjdHJpY2l0eScsIGVtb2ppOiAn8J+SoScgfSwgeyBuYW1lOiAnSHVtYW4nLCBlbW9qaTogJ/Cfp40nIH0sIHsgbmFtZTogJ1Bob2VuaXgnLCBlbW9qaTogJ/CfkKbigI3wn5SlJyB9XV07CiAgICAgICAgY29uc3QgRElTQ09WRVJFRF9FTEVNRU5UU19LRVkgPSAnZ2VuY3JhZnRfZGlzY292ZXJlZEVsZW1lbnRzJzsKICAgICAgICBjb25zdCBDSEFMTEVOR0VfTEVWRUxfS0VZID0gJ2dlbmNyYWZ0X2NoYWxsZW5nZUxldmVsJzsKICAgICAgICBsZXQgZ2FtZU1vZGUgPSAnbWVudScsIHdvcmtzcGFjZUVsZW1lbnRzID0gW10sIGRpc2NvdmVyZWRFbGVtZW50cyA9IFsuLi5pbml0aWFsRWxlbWVudHNdLCBjaGFsbGVuZ2VTdGF0ZSA9IHsgbGV2ZWw6IDAsIHRhcmdldDogbnVsbCwgc3RhcnRUaW1lOiAwLCB0aW1lcjogJzAwOjAwJywgaXNBY3RpdmU6IGZhbHNlIH07CiAgICAgICAgbGV0IG5leHRJZCA9IDAsIHRpbWVySW50ZXJ2YWwsIGRyYWdnaW5nSW5mbyA9IHsgaWQ6IG51bGwsIGVsZW1lbnQ6IG51bGwsIG9mZnNldFg6IDAsIG9mZnNldFk6IDAgfTsKICAgICAgICBsZXQgZW5kR2FtZUJ0bkRlZmF1bHRDb250ZW50ID0gbnVsbDsKICAgICAgICBjb25zdCBhaSA9IG5ldyBHb29nbGVHZW5BSSh7IGFwaUtleTogJyUlQVBJX0tFWSUlJyB9KTsKICAgICAgICBhc3luYyBmdW5jdGlvbiBnZXRDb21iaW5hdGlvbihlbGVtZW50MSwgZWxlbWVudDIpIHsKICAgICAgICAgICAgY29uc3Qga2V5ID0gW2VsZW1lbnQxLm5hbWUsIGVsZW1lbnQyLm5hbWVdLnNvcnQoKS5qb2luKCdfJyk7CiAgICAgICAgICAgIGlmIChwcmVtYWRlQ29tYmluYXRpb25zW2tleV0pCiAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wcmVtYWRlQ29tYmluYXRpb25zW2tleV0sIGlzTmV3OiB0cnVlLCBjb21tZW50YXJ5OiAnQSBjbGFzc2ljIGNvbWJpbmF0aW9uIScgfTsKICAgICAgICAgICAgaWYgKGVsZW1lbnQxLm5hbWUgPT09IGVsZW1lbnQyLm5hbWUpCiAgICAgICAgICAgICAgICByZXR1cm4geyBuYW1lOiBlbGVtZW50MS5uYW1lLCBlbW9qaTogZWxlbWVudDEuZW1vamksIGlzTmV3OiBmYWxzZSwgY29tbWVudGFyeTogJ1R3byBvZiB0aGUgc2FtZSBtYWtlIG5vIGNoYW5nZS4nIH07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9tcHQgPSBgWW91IGFyZSBhbiBBSSBmb3IgYSBjcmVhdGl2ZSBhbGNoZW15IGdhbWUuIFdoYXQgaXMgY3JlYXRlZCB3aGVuIHlvdSBjb21iaW5lICIke2VsZW1lbnQxLm5hbWV9ICR7ZWxlbWVudDEuZW1vaml9IiBhbmQgIiR7ZWxlbWVudDIubmFtZX0gJHtlbGVtZW50Mi5lbW9qaX0iP1xuLSBJZiBpdCBjcmVhdGVzIGEgbmV3LCBsb2dpY2FsIGl0ZW0sIHByb3ZpZGUgaXRzIG5hbWUsIGVtb2ppLCBhbmQgYSBmdW4gY29tbWVudGFyeSBmcm9tIGl0cyBwZXJzcGVjdGl2ZS5cbi0gSWYgdGhlIGNvbWJpbmF0aW9uIGlzIGlsbG9naWNhbCwgaW1wb3NzaWJsZSwgb3IganVzdCBtYWtlcyBtb3JlIG9mIG9uZSBvZiB0aGUgaW5wdXRzIChlLmcuLCBGaXJlICsgRmlyZSksIHJlc3BvbmQgd2l0aCBhIHJlc3VsdCB3aGVyZSBpc05ld0Rpc2NvdmVyeSBpcyBmYWxzZS5cbi0gS2VlcCB0aGUgbmFtZXMgc2ltcGxlICgxLTMgd29yZHMpLiAtIEJlIGNyZWF0aXZlIGFuZCBjb25zaXN0ZW50LmA7CiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFpLm1vZGVscy5nZW5lcmF0ZUNvbnRlbnQoeyBtb2RlbDogJ2dlbWluaS0yLjUtZmxhc2gnLCBjb250ZW50czogcHJvbXB0LCBjb25maWc6IHsgcmVzcG9uc2VNaW1lVHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLCByZXNwb25zZVNjaGVtYSwgdGVtcGVyYXR1cmU6IDAuOCB9IH0pOwogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS50ZXh0LnRyaW0oKSk7CiAgICAgICAgICAgICAgICByZXR1cm4geyBuYW1lOiByZXN1bHQubmFtZSwgZW1vamk6IHJlc3VsdC5lbW9qaSwgaXNOZXc6IHJlc3VsdC5pc05ld0Rpc2NvdmVyeSwgY29tbWVudGFyeTogcmVzdWx0LmNvbW1lbnRhcnkgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGNhbGxpbmcgR2VtaW5pIEFQSToiLCBlcnJvcik7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzYXZlUHJvZ3Jlc3MoKSB7IGlmIChnYW1lTW9kZSA9PT0gJ2ZyZWUnKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oRElTQ09WRVJFRF9FTEVNRU5UU19LRVksIEpTT04uc3RyaW5naWZ5KGRpc2NvdmVyZWRFbGVtZW50cykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gc2F2ZSBwcm9ncmVzczoiLCBlKTsKICAgICAgICAgICAgfSB9CiAgICAgICAgZnVuY3Rpb24gbG9hZFByb2dyZXNzKCkgewogICAgICAgICAgICBjb25zdCBzYXZlZERpc2NvdmVyaWVzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oRElTQ09WRVJFRF9FTEVNRU5UU19LRVkpOwogICAgICAgICAgICBpZiAoc2F2ZWREaXNjb3ZlcmllcykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHNhdmVkRGlzY292ZXJpZXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcnNlZCkgJiYgcGFyc2VkLmxlbmd0aCA+PSBpbml0aWFsRWxlbWVudHMubGVuZ3RoICYmIHBhcnNlZFswXS5uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkRWxlbWVudHMgPSBwYXJzZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBwYXJzZSBzYXZlZCBkaXNjb3ZlcmllczoiLCBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NwYWNlJyksIGdhbWVNZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUtbWVudScpLCBjaGFsbGVuZ2VQcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXByb21wdCcpLCBjaGFsbGVuZ2VIVUQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLWh1ZCcpLCBlbmRHYW1lQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuZC1nYW1lLWJ0bicpLCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyksIGFpUG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWktcG9wdXAnKSwgZGlzY292ZXJ5Q291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzY292ZXJ5LWNvdW50JyksIGVsZW1lbnRzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbGVtZW50cy1saXN0JyksIHJlY2lwZXNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtbGlzdCcpLCBzZWFyY2hJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gtaW5wdXQnKSwgdGFiRWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLWVsZW1lbnRzJyksIHRhYlJlY2lwZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLXJlY2lwZXMnKSwgZWxlbWVudHNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VsZW1lbnRzLWVtcHR5LXN0YXRlJyksIHJlY2lwZXNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtZW1wdHktc3RhdGUnKSwgY2xlYXJTZWFyY2hCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItc2VhcmNoLWJ0bicpLCBpbnRyb092ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW50cm8tb3ZlcmxheScpOwogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVVJKCkgewogICAgICAgICAgICBnYW1lTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBnYW1lTW9kZSAhPT0gJ21lbnUnKTsKICAgICAgICAgICAgY2hhbGxlbmdlSFVELmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsIGdhbWVNb2RlICE9PSAnY2hhbGxlbmdlJyB8fCAhY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUpOwogICAgICAgICAgICBlbmRHYW1lQnRuLmRpc2FibGVkID0gZ2FtZU1vZGUgPT09ICdtZW51JzsKICAgICAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJykgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYWxsZW5nZS1sZXZlbCcpLnRleHRDb250ZW50ID0gY2hhbGxlbmdlU3RhdGUubGV2ZWwudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFsbGVuZ2UtdGFyZ2V0JykudGV4dENvbnRlbnQgPSBjaGFsbGVuZ2VTdGF0ZS50YXJnZXQ/Lm5hbWUgfHwgJy4uLic7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXRpbWVyJykudGV4dENvbnRlbnQgPSBjaGFsbGVuZ2VTdGF0ZS50aW1lcjsKICAgICAgICAgICAgICAgIGVuZEdhbWVCdG4uaW5uZXJIVE1MID0gJzxzcGFuIGNsYXNzPSJmb250LWJvbGQgcHgtMiI+UVVJVDwvc3Bhbj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCkgewogICAgICAgICAgICAgICAgICAgIGVuZEdhbWVCdG4uaW5uZXJIVE1MID0gZW5kR2FtZUJ0bkRlZmF1bHRDb250ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbmRlclNpZGViYXIoKTsKICAgICAgICAgICAgcmVuZGVyV29ya3NwYWNlKCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlbmRlcldvcmtzcGFjZSgpIHsKICAgICAgICAgICAgd29ya3NwYWNlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5lbGVtZW50LWNhcmQnKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgICAgICAgICAgd29ya3NwYWNlRWxlbWVudHMuZm9yRWFjaChlbCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBjYXJkLmNsYXNzTmFtZSA9ICdlbGVtZW50LWNhcmQnOwogICAgICAgICAgICAgICAgY2FyZC5kYXRhc2V0LmlkID0gU3RyaW5nKGVsLmlkKTsKICAgICAgICAgICAgICAgIGNhcmQuc3R5bGUubGVmdCA9IGAke2VsLnh9cHhgOwogICAgICAgICAgICAgICAgY2FyZC5zdHlsZS50b3AgPSBgJHtlbC55fXB4YDsKICAgICAgICAgICAgICAgIGNhcmQuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9InRleHQtNHhsIG1yLTMgcG9pbnRlci1ldmVudHMtbm9uZSI+JHtlbC5lbW9qaX08L2Rpdj48ZGl2IGNsYXNzPSJ0ZXh0LWxnIGZvbnQtYm9sZCBmb250LW9yYml0cm9uIHBvaW50ZXItZXZlbnRzLW5vbmUgdHJ1bmNhdGUiPiR7ZWwubmFtZX08L2Rpdj5gOwogICAgICAgICAgICAgICAgaWYgKGVsLmlzTmV3KSB7CiAgICAgICAgICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCduZXcnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnbmV3JyksIDUwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiBoYW5kbGVNb3VzZURvd24oZSwgZWwuaWQpKTsKICAgICAgICAgICAgICAgIHdvcmtzcGFjZS5hcHBlbmRDaGlsZChjYXJkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlbmRlclNpZGViYXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHRlcm0gPSBzZWFyY2hJbnB1dC52YWx1ZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBkaXNjb3ZlcnlDb3VudC50ZXh0Q29udGVudCA9IGAke2Rpc2NvdmVyZWRFbGVtZW50cy5sZW5ndGh9IGZvdW5kYDsKICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRFbGVtZW50cyA9IGRpc2NvdmVyZWRFbGVtZW50cy5maWx0ZXIoZWwgPT4gZWwubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pKS5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTsKICAgICAgICAgICAgZWxlbWVudHNMaXN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBpZiAoZmlsdGVyZWRFbGVtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJlZEVsZW1lbnRzLmZvckVhY2goZWwgPT4geyBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsgYnRuLmNsYXNzTmFtZSA9ICJmbGV4IGl0ZW1zLWNlbnRlciBwLTIgYmctZ3JheS04MDAvNTAgcm91bmRlZC1sZyBob3ZlcjpiZy1jeWFuLTUwMC8yMCBib3JkZXIgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1jeWFuLTUwMCB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSI7IGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9InRleHQtMnhsIG1yLTIiPiR7ZWwuZW1vaml9PC9zcGFuPjxzcGFuIGNsYXNzPSJ0ZXh0LXdoaXRlIHRleHQtc20gdHJ1bmNhdGUiPiR7ZWwubmFtZX08L3NwYW4+YDsgYnRuLm9uY2xpY2sgPSAoKSA9PiBzcGF3bkVsZW1lbnQoZWwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmYWxzZSk7IGVsZW1lbnRzTGlzdC5hcHBlbmRDaGlsZChidG4pOyB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbGVtZW50c0VtcHR5U3RhdGUuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgZmlsdGVyZWRFbGVtZW50cy5sZW5ndGggPiAwKTsKICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRSZWNpcGVzID0gZGlzY292ZXJlZEVsZW1lbnRzLmZpbHRlcihlbCA9PiBlbC5yZWNpcGUgJiYgKGVsLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fCBlbC5yZWNpcGUuZWxlbWVudDEudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fCBlbC5yZWNpcGUuZWxlbWVudDIudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSkpLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpOwogICAgICAgICAgICByZWNpcGVzTGlzdC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgaWYgKGZpbHRlcmVkUmVjaXBlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJlZFJlY2lwZXMuZm9yRWFjaChlbCA9PiB7IGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyBkaXYuY2xhc3NOYW1lID0gInAtMiBiZy1ncmF5LTgwMC81MCByb3VuZGVkLWxnIHRleHQtc20gdGV4dC1jZW50ZXIiOyBkaXYuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7ZWwucmVjaXBlLmVsZW1lbnQxfTwvc3Bhbj4gKyA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIj4ke2VsLnJlY2lwZS5lbGVtZW50Mn08L3NwYW4+IOKGkiA8c3BhbiBjbGFzcz0idGV4dC1jeWFuLTMwMCBmb250LWJvbGQiPiR7ZWwubmFtZX0gJHtlbC5lbW9qaX08L3NwYW4+YDsgcmVjaXBlc0xpc3QuYXBwZW5kQ2hpbGQoZGl2KTsgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVjaXBlc0VtcHR5U3RhdGUuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgZmlsdGVyZWRSZWNpcGVzLmxlbmd0aCA+IDApOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzaG93TG9hZGVyKHNob3cpIHsgbG9hZGVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFzaG93KTsgfQogICAgICAgIGZ1bmN0aW9uIHNob3dBSVBvcHVwKHsgdHlwZSwgdGl0bGUsIHRleHQsIGNvbW1lbnRhcnkgfSkgewogICAgICAgICAgICBjb25zdCB0aGVtZXMgPSB7IHN1Y2Nlc3M6IHsgYmc6ICdiZy1ncmVlbi05MDAvODAnLCBib3JkZXI6ICdib3JkZXItZ3JlZW4tNDAwJywgaWNvbjogJ3RleHQtZ3JlZW4tMzAwJyB9LCBlcnJvcjogeyBiZzogJ2JnLXJlZC05MDAvODAnLCBib3JkZXI6ICdib3JkZXItcmVkLTQwMCcsIGljb246ICd0ZXh0LXJlZC0zMDAnIH0sIGluZm86IHsgYmc6ICdiZy1ibHVlLTkwMC84MCcsIGJvcmRlcjogJ2JvcmRlci1ibHVlLTQwMCcsIGljb246ICd0ZXh0LWJsdWUtMzAwJyB9IH07CiAgICAgICAgICAgIGNvbnN0IHRoZW1lID0gdGhlbWVzW3R5cGVdOwogICAgICAgICAgICBhaVBvcHVwLmNsYXNzTmFtZSA9IGBmaXhlZCB0b3AtNSBsZWZ0LTEvMiAtdHJhbnNsYXRlLXgtMS8yIHctZnVsbCBtYXgtdy1zbSBwLTQgcm91bmRlZC1sZyBzaGFkb3ctMnhsIGJvcmRlci0yIGJhY2tkcm9wLWJsdXItbWQgei01MCBhbmltYXRlLWZhZGUtaW4tZG93biAke3RoZW1lLmJnfSAke3RoZW1lLmJvcmRlcn1gOwogICAgICAgICAgICBsZXQgY29tbWVudGFyeUh0bWwgPSBjb21tZW50YXJ5ID8gYDxwIGNsYXNzPSJtdC0yIHRleHQtc20gaXRhbGljIGJvcmRlci1sLTIgcGwtMiAke3RoZW1lLmJvcmRlcn0gJHt0aGVtZS5pY29ufSI+JHtjb21tZW50YXJ5fTwvcD5gIDogJyc7CiAgICAgICAgICAgIGFpUG9wdXAuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtc3RhcnQiPjxkaXYgY2xhc3M9ImZsZXgtc2hyaW5rLTAiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBjbGFzcz0iaC02IHctNiAke3RoZW1lLmljb259IiBmaWxsPSJub25lIiB2aWV3Qm94PSIwIDAgMjQgMjQiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiPjxwYXRoIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTUgM3Y0TTMgNWg0TTYgMTd2NG0tMi0yaDRtNS0xNmwyLjI4NiA2Ljg1N0wyMSAxMmwtNS43MTQgMi4xNDNMMTMgMjFsLTIuMjg2LTYuODU3TDUgMTJsNS43MTQtMi4xNDNMMTMgM3oiIC8+PC9zdmc+PC9kaXY+PGRpdiBjbGFzcz0ibWwtMyB3LTAgZmxleC0xIj48cCBjbGFzcz0idGV4dC1sZyBmb250LWJvbGQgZm9udC1vcmJpdHJvbiB0ZXh0LXdoaXRlIj4ke3RpdGxlfTwvcD48cCBjbGFzcz0ibXQtMSB0ZXh0LXNtICR7dHlwZSA9PT0gJ3N1Y2Nlc3MnID8gJ3RleHQtZ3JlZW4tMjAwJyA6IHR5cGUgPT09ICdlcnJvcicgPyAndGV4dC1yZWQtMjAwJyA6ICd0ZXh0LWJsdWUtMjAwJ30iPiR7dGV4dH08L3A+JHtjb21tZW50YXJ5SHRtbH08L2Rpdj48ZGl2IGNsYXNzPSJtbC00IGZsZXgtc2hyaW5rLTAgZmxleCI+PGJ1dHRvbiBpZD0iY2xvc2UtcG9wdXAtYnRuIiBjbGFzcz0iaW5saW5lLWZsZXggcm91bmRlZC1tZCB0ZXh0LWdyYXktMzAwIGhvdmVyOnRleHQtd2hpdGUiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBjbGFzcz0iaC01IHctNSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIj48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik02IDE4TDE4IDZNNiA2bDEyIDEyIiAvPjwvc3ZnPjwvYnV0dG9uPjwvZGl2PjwvZGl2PmA7CiAgICAgICAgICAgIGFpUG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1wb3B1cC1idG4nKS5vbmNsaWNrID0gKCkgPT4gYWlQb3B1cC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBhaVBvcHVwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpLCA2MDAwKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlUGFydGljbGVCdXJzdCh4LCB5KSB7IGNvbnN0IGJ1cnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IGJ1cnN0LmNsYXNzTmFtZSA9ICdwYXJ0aWNsZS1idXJzdCc7IGJ1cnN0LnN0eWxlLmxlZnQgPSBgJHt4ICsgODB9cHhgOyBidXJzdC5zdHlsZS50b3AgPSBgJHt5ICsgNDh9cHhgOyBmb3IgKGxldCBpID0gMDsgaSA8IDEyOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgcGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgcGFydGljbGUuY2xhc3NOYW1lID0gJ3BhcnRpY2xlJzsKICAgICAgICAgICAgcGFydGljbGUuc3R5bGUuc2V0UHJvcGVydHkoJy0taScsIFN0cmluZyhpKSk7CiAgICAgICAgICAgIGJ1cnN0LmFwcGVuZENoaWxkKHBhcnRpY2xlKTsKICAgICAgICB9IHdvcmtzcGFjZS5hcHBlbmRDaGlsZChidXJzdCk7IHNldFRpbWVvdXQoKCkgPT4gYnVyc3QucmVtb3ZlKCksIDYwMCk7IH0KICAgICAgICBmdW5jdGlvbiBzcGF3bkVsZW1lbnQoZWxlbWVudCwgeCwgeSwgaXNOZXcgPSB0cnVlKSB7IGNvbnN0IGJvdW5kcyA9IHdvcmtzcGFjZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgY29uc3QgbmV3WCA9IHggPz8gTWF0aC5yYW5kb20oKSAqIChib3VuZHMud2lkdGggLSAyMDApICsgMjA7IGNvbnN0IG5ld1kgPSB5ID8/IE1hdGgucmFuZG9tKCkgKiAoYm91bmRzLmhlaWdodCAtIDE1MCkgKyAyMDsgd29ya3NwYWNlRWxlbWVudHMucHVzaCh7IC4uLmVsZW1lbnQsIGlkOiBuZXh0SWQrKywgeDogbmV3WCwgeTogbmV3WSwgaXNOZXcgfSk7IHJlbmRlcldvcmtzcGFjZSgpOyB9CiAgICAgICAgZnVuY3Rpb24gcmVzZXRXb3Jrc3BhY2Uoc3Bhd25Jbml0aWFsID0gdHJ1ZSkgewogICAgICAgICAgICB3b3Jrc3BhY2VFbGVtZW50cyA9IFtdOwogICAgICAgICAgICBpZiAoc3Bhd25Jbml0aWFsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBib3VuZHMgPSB3b3Jrc3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBbeyB4OiBib3VuZHMud2lkdGggLyAyIC0gMTYwIC0gMjAsIHk6IGJvdW5kcy5oZWlnaHQgLyAyIC0gOTYgLSAyMCB9LCB7IHg6IGJvdW5kcy53aWR0aCAvIDIgKyAyMCwgeTogYm91bmRzLmhlaWdodCAvIDIgLSA5NiAtIDIwIH0sIHsgeDogYm91bmRzLndpZHRoIC8gMiAtIDE2MCAtIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sIHsgeDogYm91bmRzLndpZHRoIC8gMiArIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sXTsKICAgICAgICAgICAgICAgIGluaXRpYWxFbGVtZW50cy5mb3JFYWNoKChlbCwgaSkgPT4gc3Bhd25FbGVtZW50KGVsLCBwb3NpdGlvbnNbaV0ueCwgcG9zaXRpb25zW2ldLnksIGZhbHNlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyV29ya3NwYWNlKCk7CiAgICAgICAgfQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1Db21iaW5hdGlvbihlbDEsIGVsMikgewogICAgICAgICAgICBjb25zdCBjYXJkMSA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7ZWwxLmlkfSddYCksIGNhcmQyID0gd29ya3NwYWNlLnF1ZXJ5U2VsZWN0b3IoYC5lbGVtZW50LWNhcmRbZGF0YS1pZD0nJHtlbDIuaWR9J11gKTsKICAgICAgICAgICAgY2FyZDE/LmNsYXNzTGlzdC5hZGQoJ2NvbWJpbmluZycpOwogICAgICAgICAgICBjYXJkMj8uY2xhc3NMaXN0LmFkZCgnY29tYmluaW5nJyk7CiAgICAgICAgICAgIFNvdW5kTWFuYWdlci5wbGF5Q29tYmluZSgpOwogICAgICAgICAgICBzaG93TG9hZGVyKHRydWUpOwogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb21iaW5hdGlvbihlbDEsIGVsMik7CiAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmlzTmV3KSB7CiAgICAgICAgICAgICAgICBTb3VuZE1hbmFnZXIucGxheURpc2NvdmVyKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc0ZpcnN0RGlzY292ZXJ5ID0gIWRpc2NvdmVyZWRFbGVtZW50cy5zb21lKGQgPT4gZC5uYW1lID09PSByZXN1bHQubmFtZSk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdFbGVtZW50ID0geyBuYW1lOiByZXN1bHQubmFtZSwgZW1vamk6IHJlc3VsdC5lbW9qaSB9OwogICAgICAgICAgICAgICAgaWYgKGlzRmlyc3REaXNjb3ZlcnkpIHsKICAgICAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkRWxlbWVudHMucHVzaCh7IC4uLm5ld0VsZW1lbnQsIHJlY2lwZTogeyBlbGVtZW50MTogZWwxLm5hbWUsIGVsZW1lbnQyOiBlbDIubmFtZSB9IH0pOwogICAgICAgICAgICAgICAgICAgIHNhdmVQcm9ncmVzcygpOwogICAgICAgICAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ3N1Y2Nlc3MnLCB0aXRsZTogJ0ZpcnN0IERpc2NvdmVyeSEnLCB0ZXh0OiBgWW91J3ZlIGNyZWF0ZWQgJHtyZXN1bHQubmFtZX0gJHtyZXN1bHQuZW1vaml9IWAsIGNvbW1lbnRhcnk6IHJlc3VsdC5jb21tZW50YXJ5IH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd0FJUG9wdXAoeyB0eXBlOiAnaW5mbycsIHRpdGxlOiAnTmV3IEVsZW1lbnQhJywgdGV4dDogYFlvdSBtYWRlICR7cmVzdWx0Lm5hbWV9ICR7cmVzdWx0LmVtb2ppfSFgLCBjb21tZW50YXJ5OiByZXN1bHQuY29tbWVudGFyeSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHNwYXduWCA9IChlbDEueCArIGVsMi54KSAvIDIsIHNwYXduWSA9IChlbDEueSArIGVsMi55KSAvIDI7CiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VFbGVtZW50cyA9IHdvcmtzcGFjZUVsZW1lbnRzLmZpbHRlcihlbCA9PiBlbC5pZCAhPT0gZWwxLmlkICYmIGVsLmlkICE9PSBlbDIuaWQpOwogICAgICAgICAgICAgICAgc3Bhd25FbGVtZW50KG5ld0VsZW1lbnQsIHNwYXduWCwgc3Bhd25ZKTsKICAgICAgICAgICAgICAgIGNyZWF0ZVBhcnRpY2xlQnVyc3Qoc3Bhd25YLCBzcGF3blkpOwogICAgICAgICAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJyAmJiByZXN1bHQubmFtZSA9PT0gY2hhbGxlbmdlU3RhdGUudGFyZ2V0Py5uYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVUYWtlbiA9IChEYXRlLm5vdygpIC0gY2hhbGxlbmdlU3RhdGUuc3RhcnRUaW1lKSAvIDEwMDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGllckluZGV4ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoY2hhbGxlbmdlU3RhdGUubGV2ZWwgLSAxKSAvIDIpLCBjaGFsbGVuZ2VUaWVycy5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnb2xkVGltZSA9IDEwICsgdGllckluZGV4ICogNSwgc2lsdmVyVGltZSA9IDIwICsgdGllckluZGV4ICogMTA7CiAgICAgICAgICAgICAgICAgICAgbGV0IHJhbmsgPSAnQnJvbnplIPCfpYknOwogICAgICAgICAgICAgICAgICAgIGlmICh0aW1lVGFrZW4gPCBnb2xkVGltZSkKICAgICAgICAgICAgICAgICAgICAgICAgcmFuayA9ICdHb2xkIPCfpYcnOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRpbWVUYWtlbiA8IHNpbHZlclRpbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmsgPSAnU2lsdmVyIPCfpYgnOwogICAgICAgICAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ3N1Y2Nlc3MnLCB0aXRsZTogYExldmVsICR7Y2hhbGxlbmdlU3RhdGUubGV2ZWx9IENvbXBsZXRlIWAsIHRleHQ6IGBSYW5rOiAke3Jhbmt9IHwgVGltZTogJHt0aW1lVGFrZW4udG9GaXhlZCgxKX1zYCwgY29tbWVudGFyeTogYFlvdSBjcmFmdGVkICR7Y2hhbGxlbmdlU3RhdGUudGFyZ2V0Lm5hbWV9IWAgfSk7CiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oQ0hBTExFTkdFX0xFVkVMX0tFWSwgSlNPTi5zdHJpbmdpZnkoY2hhbGxlbmdlU3RhdGUubGV2ZWwpKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHN0YXJ0TmV4dExldmVsKGNoYWxsZW5nZVN0YXRlLmxldmVsKSwgNDAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBTb3VuZE1hbmFnZXIucGxheUVycm9yKCk7CiAgICAgICAgICAgICAgICBjb25zdCByZWFzb24gPSByZXN1bHQgPyBgQ29tYmluaW5nICR7ZWwxLm5hbWV9IGFuZCAke2VsMi5uYW1lfSByZXN1bHRzIGluICR7cmVzdWx0Lm5hbWV9LiBOb3RoaW5nIG5ldyBjcmVhdGVkLmAgOiAiVGhvc2UgZWxlbWVudHMgZG9uJ3Qgc2VlbSB0byBjb21iaW5lIHdlbGwuIjsKICAgICAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ2Vycm9yJywgdGl0bGU6ICdObyBSZWFjdGlvbicsIHRleHQ6IHJlYXNvbiwgY29tbWVudGFyeTogcmVzdWx0Py5jb21tZW50YXJ5IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpOwogICAgICAgICAgICBjYXJkMT8uY2xhc3NMaXN0LnJlbW92ZSgnY29tYmluaW5nJyk7CiAgICAgICAgICAgIGNhcmQyPy5jbGFzc0xpc3QucmVtb3ZlKCdjb21iaW5pbmcnKTsKICAgICAgICAgICAgdXBkYXRlVUkoKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaGFuZGxlTW91c2VEb3duKGUsIGlkKSB7CiAgICAgICAgICAgIGlmIChnYW1lTW9kZSA9PT0gJ21lbnUnIHx8IGRyYWdnaW5nSW5mby5pZCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHdvcmtzcGFjZUVsZW1lbnRzLmZpbmQoZWwgPT4gZWwuaWQgPT09IGlkKTsKICAgICAgICAgICAgY29uc3QgY2FyZCA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgaWYgKCFlbGVtZW50IHx8ICFjYXJkKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJyk7CiAgICAgICAgICAgIGRyYWdnaW5nSW5mbyA9IHsgaWQsIGVsZW1lbnQ6IGNhcmQsIG9mZnNldFg6IGUuY2xpZW50WCAtIGNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCwgb2Zmc2V0WTogZS5jbGllbnRZIC0gY2FyZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AsIH07CiAgICAgICAgICAgIHdvcmtzcGFjZS5hcHBlbmRDaGlsZChjYXJkKTsKICAgICAgICAgICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBoYW5kbGVNb3VzZU1vdmU7CiAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGhhbmRsZU1vdXNlVXA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZU1vdXNlTW92ZShlKSB7CiAgICAgICAgICAgIGlmICghZHJhZ2dpbmdJbmZvLmlkIHx8ICFkcmFnZ2luZ0luZm8uZWxlbWVudCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgeyBlbGVtZW50LCBvZmZzZXRYLCBvZmZzZXRZIH0gPSBkcmFnZ2luZ0luZm87CiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZVJlY3QgPSB3b3Jrc3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGxldCB4ID0gZS5jbGllbnRYIC0gd29ya3NwYWNlUmVjdC5sZWZ0IC0gb2Zmc2V0WCwgeSA9IGUuY2xpZW50WSAtIHdvcmtzcGFjZVJlY3QudG9wIC0gb2Zmc2V0WTsKICAgICAgICAgICAgeCA9IE1hdGgubWF4KDAsIE1hdGgubWluKHgsIHdvcmtzcGFjZVJlY3Qud2lkdGggLSBlbGVtZW50Lm9mZnNldFdpZHRoKSk7CiAgICAgICAgICAgIHkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih5LCB3b3Jrc3BhY2VSZWN0LmhlaWdodCAtIGVsZW1lbnQub2Zmc2V0SGVpZ2h0KSk7CiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3h9cHhgOwogICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRvcCA9IGAke3l9cHhgOwogICAgICAgICAgICBjb25zdCBkcmFnZ2VkUmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGZvciAoY29uc3Qgb3RoZXJFbCBvZiB3b3Jrc3BhY2VFbGVtZW50cykgewogICAgICAgICAgICAgICAgaWYgKG90aGVyRWwuaWQgPT09IGRyYWdnaW5nSW5mby5pZCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyQ2FyZCA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7b3RoZXJFbC5pZH0nXWApOwogICAgICAgICAgICAgICAgaWYgKCFvdGhlckNhcmQpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBvdGhlclJlY3QgPSBvdGhlckNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZFJlY3QubGVmdCA8IG90aGVyUmVjdC5yaWdodCAmJiBkcmFnZ2VkUmVjdC5yaWdodCA+IG90aGVyUmVjdC5sZWZ0ICYmIGRyYWdnZWRSZWN0LnRvcCA8IG90aGVyUmVjdC5ib3R0b20gJiYgZHJhZ2dlZFJlY3QuYm90dG9tID4gb3RoZXJSZWN0LnRvcCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRyYWdnZWRFbGVtZW50ID0gd29ya3NwYWNlRWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gZHJhZ2dpbmdJbmZvLmlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQueCA9IHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50LnkgPSB5OwogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVNb3VzZVVwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmZvcm1Db21iaW5hdGlvbihkcmFnZ2VkRWxlbWVudCwgb3RoZXJFbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaGFuZGxlTW91c2VVcCgpIHsKICAgICAgICAgICAgaWYgKCFkcmFnZ2luZ0luZm8uaWQgfHwgIWRyYWdnaW5nSW5mby5lbGVtZW50KQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB7IGlkLCBlbGVtZW50IH0gPSBkcmFnZ2luZ0luZm87CiAgICAgICAgICAgIGNvbnN0IGVsSW5TdGF0ZSA9IHdvcmtzcGFjZUVsZW1lbnRzLmZpbmQoZWwgPT4gZWwuaWQgPT09IGlkKTsKICAgICAgICAgICAgaWYgKGVsSW5TdGF0ZSkgewogICAgICAgICAgICAgICAgZWxJblN0YXRlLnggPSBwYXJzZUZsb2F0KGVsZW1lbnQuc3R5bGUubGVmdCk7CiAgICAgICAgICAgICAgICBlbEluU3RhdGUueSA9IHBhcnNlRmxvYXQoZWxlbWVudC5zdHlsZS50b3ApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTsKICAgICAgICAgICAgZHJhZ2dpbmdJbmZvID0geyBpZDogbnVsbCwgZWxlbWVudDogbnVsbCwgb2Zmc2V0WDogMCwgb2Zmc2V0WTogMCB9OwogICAgICAgICAgICBkb2N1bWVudC5vbm1vdXNlbW92ZSA9IG51bGw7CiAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHN0YXJ0TmV4dExldmVsKGN1cnJlbnRMZXZlbCkgewogICAgICAgICAgICBjb25zdCBuZXh0TGV2ZWwgPSBjdXJyZW50TGV2ZWwgKyAxOwogICAgICAgICAgICBjb25zdCB0aWVySW5kZXggPSBNYXRoLm1pbihNYXRoLmZsb29yKChuZXh0TGV2ZWwgLSAxKSAvIDIpLCBjaGFsbGVuZ2VUaWVycy5sZW5ndGggLSAxKTsKICAgICAgICAgICAgY29uc3QgdGllciA9IGNoYWxsZW5nZVRpZXJzW3RpZXJJbmRleF07CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRpZXJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGllci5sZW5ndGgpXTsKICAgICAgICAgICAgY2hhbGxlbmdlU3RhdGUgPSB7IGxldmVsOiBuZXh0TGV2ZWwsIHRhcmdldCwgc3RhcnRUaW1lOiBEYXRlLm5vdygpLCB0aW1lcjogJzAwOjAwJywgaXNBY3RpdmU6IHRydWUgfTsKICAgICAgICAgICAgdGltZXJJbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7IGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gY2hhbGxlbmdlU3RhdGUuc3RhcnRUaW1lKSAvIDEwMDApOyBjb25zdCBtaW5zID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsgY29uc3Qgc2VjcyA9IChzZWNvbmRzICUgNjApLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsgY2hhbGxlbmdlU3RhdGUudGltZXIgPSBgJHttaW5zfToke3NlY3N9YDsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYWxsZW5nZS10aW1lcicpLnRleHRDb250ZW50ID0gY2hhbGxlbmdlU3RhdGUudGltZXI7IH0sIDEwMDApOwogICAgICAgICAgICByZXNldFdvcmtzcGFjZSgpOwogICAgICAgICAgICB1cGRhdGVVSSgpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzdGFydEZyZWVQbGF5KCkgeyBnYW1lTW9kZSA9ICdmcmVlJzsgcmVzZXRXb3Jrc3BhY2UoKTsgdXBkYXRlVUkoKTsgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUNoYWxsZW5nZVN0YXJ0UmVxdWVzdCgpIHsgY29uc3Qgc2F2ZWRMZXZlbCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpOyBpZiAoc2F2ZWRMZXZlbCAmJiBwYXJzZUludChzYXZlZExldmVsLCAxMCkgPiAwKSB7CiAgICAgICAgICAgIGNoYWxsZW5nZVByb21wdC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGhhbmRsZU5ld0NoYWxsZW5nZUdhbWUoKTsKICAgICAgICB9IH0KICAgICAgICBmdW5jdGlvbiBoYW5kbGVDb250aW51ZUNoYWxsZW5nZSgpIHsgY29uc3Qgc2F2ZWRMZXZlbCA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpIHx8ICcwJywgMTApOyBnYW1lTW9kZSA9ICdjaGFsbGVuZ2UnOyBkaXNjb3ZlcmVkRWxlbWVudHMgPSBbLi4uaW5pdGlhbEVsZW1lbnRzXTsgc3RhcnROZXh0TGV2ZWwoc2F2ZWRMZXZlbCk7IGNoYWxsZW5nZVByb21wdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZU5ld0NoYWxsZW5nZUdhbWUoKSB7IGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpOyBnYW1lTW9kZSA9ICdjaGFsbGVuZ2UnOyBkaXNjb3ZlcmVkRWxlbWVudHMgPSBbLi4uaW5pdGlhbEVsZW1lbnRzXTsgc3RhcnROZXh0TGV2ZWwoMCk7IGNoYWxsZW5nZVByb21wdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUVuZEdhbWUoKSB7IGdhbWVNb2RlID0gJ21lbnUnOyB3b3Jrc3BhY2VFbGVtZW50cyA9IFtdOyBpZiAoY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUpIHsKICAgICAgICAgICAgY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsKTsKICAgICAgICB9IHVwZGF0ZVVJKCk7IH0KICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICBsb2FkUHJvZ3Jlc3MoKTsKICAgICAgICAgICAgaWYgKGVuZEdhbWVCdG4pIHsKICAgICAgICAgICAgICAgIGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCA9IGVuZEdhbWVCdG4uaW5uZXJIVE1MOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydC1mcmVlLXBsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgU291bmRNYW5hZ2VyLmluaXQoKTsgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOyBzdGFydEZyZWVQbGF5KCk7IH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IFNvdW5kTWFuYWdlci5pbml0KCk7IFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsgaGFuZGxlQ2hhbGxlbmdlU3RhcnRSZXF1ZXN0KCk7IH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGludWUtY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsgaGFuZGxlQ29udGludWVDaGFsbGVuZ2UoKTsgfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsgaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSgpOyB9KTsKICAgICAgICAgICAgZW5kR2FtZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOyBoYW5kbGVFbmRHYW1lKCk7IH0pOwogICAgICAgICAgICBzZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHJlbmRlclNpZGViYXIpOwogICAgICAgICAgICBjbGVhclNlYXJjaEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgc2VhcmNoSW5wdXQudmFsdWUgPSAnJzsgcmVuZGVyU2lkZWJhcigpOyBTb3VuZE1hbmFnZXIucGxheUNsaWNrKCk7IH0pOwogICAgICAgICAgICB0YWJFbGVtZW50cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgZWxlbWVudHNMaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyByZWNpcGVzTGlzdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgdGFiRWxlbWVudHMuY2xhc3NMaXN0LmFkZCgnYmctY3lhbi01MDAvMjAnLCAndGV4dC1jeWFuLTMwMCcpOyB0YWJSZWNpcGVzLmNsYXNzTGlzdC5yZW1vdmUoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsgU291bmRNYW5hZ2VyLnBsYXlUYWIoKTsgfSk7CiAgICAgICAgICAgIHRhYlJlY2lwZXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGVsZW1lbnRzTGlzdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgcmVjaXBlc0xpc3QuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7IHRhYlJlY2lwZXMuY2xhc3NMaXN0LmFkZCgnYmctY3lhbi01MDAvMjAnLCAndGV4dC1jeWFuLTMwMCcpOyB0YWJFbGVtZW50cy5jbGFzc0xpc3QucmVtb3ZlKCdiZy1jeWFuLTUwMC8yMCcsICd0ZXh0LWN5YW4tMzAwJyk7IFNvdW5kTWFuYWdlci5wbGF5VGFiKCk7IH0pOwogICAgICAgICAgICBpZiAoaW50cm9PdmVybGF5KSB7CiAgICAgICAgICAgICAgICBpbnRyb092ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaW50cm9PdmVybGF5LnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAwLjVzIGVhc2Utb3V0JzsKICAgICAgICAgICAgICAgICAgICBpbnRyb092ZXJsYXkuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICAgICAgICAgICAgICBpbnRyb092ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgaW50cm9PdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyB9LCA1MDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlVUkoKTsKICAgICAgICB9CiAgICAgICAgaW5pdCgpOwogICAgICAgIC8vIC0tLSBFbmQgb2YgRW1iZWRkZWQgQXBwIFNjcmlwdCAtLS0KICAgIH07CiAgICByZXR1cm4gYCgke3NjcmlwdC50b1N0cmluZygpfSkoKWA7Cn0KZnVuY3Rpb24gZG93bmxvYWRHYW1lQXNIdG1sKGFwaUtleSkgewogICAgLy8gVGhpcyBmdW5jdGlvbiBjcmVhdGVzIGEgc2VsZi1jb250YWluZWQgSFRNTCBmaWxlIG9mIHRoZSBnYW1lLgogICAgLy8gMS4gR2V0IHRoZSBnYW1lJ3MgbG9naWMgYXMgYSBzdHJpbmcgYW5kIGluamVjdCB0aGUgdXNlci1wcm92aWRlZCBBUEkga2V5LgogICAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGdldEFwcFNjcmlwdCgpLnJlcGxhY2UoLyclJUFQSV9LRVklJScvZywgYCcke2FwaUtleX0nYCk7CiAgICAvLyAyLiBDbG9uZSB0aGUgY3VycmVudCBkb2N1bWVudCdzIERPTSB0byB1c2UgYXMgYSB0ZW1wbGF0ZS4KICAgIGNvbnN0IG9mZmxpbmVEb2MgPSBkb2N1bWVudC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAvLyAzLiBNb2RpZnkgdGhlIGNsb25lZCBkb2N1bWVudCBmb3Igb2ZmbGluZSB1c2UuCiAgICBjb25zdCB0aXRsZVRhZyA9IG9mZmxpbmVEb2MucXVlcnlTZWxlY3RvcigndGl0bGUnKTsKICAgIGlmICh0aXRsZVRhZykgewogICAgICAgIHRpdGxlVGFnLnRleHRDb250ZW50ID0gJ2dlbmNyYWZ0IChPZmZsaW5lKSc7CiAgICB9CiAgICBvZmZsaW5lRG9jLnF1ZXJ5U2VsZWN0b3IoJ3NjcmlwdFtzcmM9Ii9pbmRleC50c3giXScpPy5yZW1vdmUoKTsKICAgIGNvbnN0IGRvd25sb2FkQnV0dG9uQ29udGFpbmVyID0gb2ZmbGluZURvYy5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtZ2FtZS1idG4nKT8ucGFyZW50RWxlbWVudDsKICAgIGRvd25sb2FkQnV0dG9uQ29udGFpbmVyPy5yZW1vdmUoKTsKICAgIG9mZmxpbmVEb2MuZ2V0RWxlbWVudEJ5SWQoJ2FwaS1rZXktbW9kYWwnKT8ucmVtb3ZlKCk7CiAgICAvLyA0LiBDcmVhdGUgYW5kIGluamVjdCBhIG5ldyBzY3JpcHQgdGFnIHRoYXQgY29udGFpbnMgYWxsIHRoZSBnYW1lIGxvZ2ljLgogICAgY29uc3QgbmV3U2NyaXB0VGFnID0gb2ZmbGluZURvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgIG5ld1NjcmlwdFRhZy50eXBlID0gIm1vZHVsZSI7CiAgICBuZXdTY3JpcHRUYWcudGV4dENvbnRlbnQgPSBgCiAgICAgICAgLy8gRHluYW1pY2FsbHkgaW1wb3J0IHRoZSBHb29nbGUgR2VuQUkgbGlicmFyeSBmcm9tIGEgQ0ROLgogICAgICAgIGltcG9ydCB7IEdvb2dsZUdlbkFJLCBUeXBlIH0gZnJvbSAiaHR0cHM6Ly9lc20uc2gvQGdvb2dsZS9nZW5haSI7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGdhbWUgc2NyaXB0IGV4cGVjdHMgdGhlc2UgdG8gYmUgb24gdGhlIHdpbmRvdyBvYmplY3QuCiAgICAgICAgKHdpbmRvdyBhcyBhbnkpLmdvb2dsZUdlbmFpID0geyBHb29nbGVHZW5BSSwgVHlwZSB9OwogICAgICAgIAogICAgICAgIC8vIEV4ZWN1dGUgdGhlIGVudGlyZSBnYW1lJ3MgbG9naWMgc3RyaW5nLgogICAgICAgIC8vIFVzaW5nIGV2YWwgaXMgbmVjZXNzYXJ5IGhlcmUgdG8gcnVuIHRoZSBzZWxmLWNvbnRhaW5lZCBzY3JpcHQgc3RyaW5nLgogICAgICAgIC8vIEpTT04uc3RyaW5naWZ5IGVuc3VyZXMgdGhlIHN0cmluZyBpcyBzYWZlbHkgZW1iZWRkZWQuCiAgICAgICAgZXZhbCgke0pTT04uc3RyaW5naWZ5KHNjcmlwdENvbnRlbnQpfSk7CiAgICBgOwogICAgb2ZmbGluZURvYy5ib2R5LmFwcGVuZENoaWxkKG5ld1NjcmlwdFRhZyk7CiAgICAvLyA1LiBTZXJpYWxpemUgdGhlIG1vZGlmaWVkIGRvY3VtZW50IHRvIGFuIEhUTUwgc3RyaW5nLgogICAgY29uc3QgZmluYWxIdG1sID0gJzwhRE9DVFlQRSBodG1sPlxuJyArIG9mZmxpbmVEb2MuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDsKICAgIC8vIDYuIENyZWF0ZSBhIEJsb2IgYW5kIHRyaWdnZXIgYSBkb3dubG9hZC4KICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZmluYWxIdG1sXSwgeyB0eXBlOiAndGV4dC9odG1sJyB9KTsKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICBhLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgYS5kb3dubG9hZCA9ICdnZW5jcmFmdC1vZmZsaW5lLmh0bWwnOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgIGEuY2xpY2soKTsKICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7CiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7Cn0KZnVuY3Rpb24gaGFuZGxlRG93bmxvYWRSZXF1ZXN0KCkgewogICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgYXBpS2V5TW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBhcGlLZXlNb2RhbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2F1dG8nOwogICAgYXBpS2V5SW5wdXQuZm9jdXMoKTsKfQovLyAtLS0gSW5pdGlhbGl6YXRpb24gLS0tCmZ1bmN0aW9uIGluaXQoKSB7CiAgICAvLyBTdG9yZSB0aGUgZGVmYXVsdCBidXR0b24gY29udGVudCBvbiBzdGFydHVwCiAgICBpZiAoZW5kR2FtZUJ0bikgewogICAgICAgIGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCA9IGVuZEdhbWVCdG4uaW5uZXJIVE1MOwogICAgfQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0LWZyZWUtcGxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIFNvdW5kTWFuYWdlci5pbml0KCk7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIHN0YXJ0RnJlZVBsYXkoKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0LWNoYWxsZW5nZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIFNvdW5kTWFuYWdlci5pbml0KCk7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZUNoYWxsZW5nZVN0YXJ0UmVxdWVzdCgpOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGludWUtY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZUNvbnRpbnVlQ2hhbGxlbmdlKCk7CiAgICB9KTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZU5ld0NoYWxsZW5nZUdhbWUoKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25sb2FkLWdhbWUtYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRG93bmxvYWRSZXF1ZXN0KTsKICAgIGVuZEdhbWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZUVuZEdhbWUoKTsKICAgIH0pOwogICAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCByZW5kZXJTaWRlYmFyKTsKICAgIGNsZWFyU2VhcmNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIHNlYXJjaElucHV0LnZhbHVlID0gJyc7CiAgICAgICAgY2xlYXJTZWFyY2hCdG4uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgcmVuZGVyU2lkZWJhcigpOwogICAgICAgIFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsKICAgIH0pOwogICAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoKSA9PiB7CiAgICAgICAgY2xlYXJTZWFyY2hCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgc2VhcmNoSW5wdXQudmFsdWUubGVuZ3RoID09PSAwKTsKICAgIH0pOwogICAgdGFiRWxlbWVudHMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZWxlbWVudHNMaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIHJlY2lwZXNMaXN0LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHRhYkVsZW1lbnRzLmNsYXNzTGlzdC5hZGQoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsKICAgICAgICB0YWJSZWNpcGVzLmNsYXNzTGlzdC5yZW1vdmUoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsKICAgICAgICBTb3VuZE1hbmFnZXIucGxheVRhYigpOwogICAgfSk7CiAgICB0YWJSZWNpcGVzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGVsZW1lbnRzTGlzdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICByZWNpcGVzTGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB0YWJSZWNpcGVzLmNsYXNzTGlzdC5hZGQoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsKICAgICAgICB0YWJFbGVtZW50cy5jbGFzc0xpc3QucmVtb3ZlKCdiZy1jeWFuLTUwMC8yMCcsICd0ZXh0LWN5YW4tMzAwJyk7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlUYWIoKTsKICAgIH0pOwogICAgYXBpS2V5U3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsKICAgICAgICBjb25zdCBhcGlLZXkgPSBhcGlLZXlJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgaWYgKGFwaUtleSkgewogICAgICAgICAgICBkb3dubG9hZEdhbWVBc0h0bWwoYXBpS2V5KTsKICAgICAgICAgICAgYXBpS2V5TW9kYWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKICAgICAgICAgICAgYXBpS2V5TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBTb3VuZE1hbmFnZXIucGxheUVycm9yKCk7CiAgICAgICAgICAgIGFwaUtleUlucHV0LmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtc2hha2UnLCAnYm9yZGVyLXJlZC01MDAnKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBhcGlLZXlJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLXNoYWtlJywgJ2JvcmRlci1yZWQtNTAwJyksIDUwMCk7CiAgICAgICAgfQogICAgfSk7CiAgICBhcGlLZXlDYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGFwaUtleU1vZGFsLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7CiAgICAgICAgYXBpS2V5TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9KTsKICAgIGlmIChpbnRyb092ZXJsYXkpIHsKICAgICAgICBpbnRyb092ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGludHJvT3ZlcmxheS5zdHlsZS50cmFuc2l0aW9uID0gJ29wYWNpdHkgMC41cyBlYXNlLW91dCc7CiAgICAgICAgICAgIGludHJvT3ZlcmxheS5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICBpbnRyb092ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGludHJvT3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgfSwgNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIGxvYWRQcm9ncmVzcygpOwogICAgdXBkYXRlVUkoKTsKfQppbml0KCk7Cg==","@":"data:application/javascript;base64,aW1wb3J0IHsgR29vZ2xlR2VuQUksIFR5cGUgfSBmcm9tICJAZ29vZ2xlL2dlbmFpIjsKLy8gLS0tIFNvdW5kIE1hbmFnZXIgLS0tCmNvbnN0IFNvdW5kTWFuYWdlciA9IHsKICAgIGF1ZGlvQ29udGV4dDogbnVsbCwKICAgIGlzSW5pdGlhbGl6ZWQ6IGZhbHNlLAogICAgaW5pdCgpIHsKICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkIHx8IHR5cGVvZiB3aW5kb3cuQXVkaW9Db250ZXh0ID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpOwogICAgICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJXZWIgQXVkaW8gQVBJIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLiIsIGUpOwogICAgICAgIH0KICAgIH0sCiAgICBwbGF5U291bmQodHlwZSwgZnJlcXVlbmN5LCBkdXJhdGlvbiwgdm9sdW1lID0gMC41KSB7CiAgICAgICAgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IG9zY2lsbGF0b3IgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCk7CiAgICAgICAgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7CiAgICAgICAgb3NjaWxsYXRvci5jb25uZWN0KGdhaW5Ob2RlKTsKICAgICAgICBnYWluTm9kZS5jb25uZWN0KHRoaXMuYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTsKICAgICAgICBvc2NpbGxhdG9yLnR5cGUgPSB0eXBlOwogICAgICAgIG9zY2lsbGF0b3IuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKGZyZXF1ZW5jeSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUpOwogICAgICAgIGdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUodm9sdW1lLCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7CiAgICAgICAgZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDAwMSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7CiAgICAgICAgb3NjaWxsYXRvci5zdGFydCh0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7CiAgICAgICAgb3NjaWxsYXRvci5zdG9wKHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lICsgZHVyYXRpb24pOwogICAgfSwKICAgIHBsYXlDbGljaygpIHsKICAgICAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgdGhpcy5pbml0KCk7CiAgICAgICAgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHRoaXMucGxheVNvdW5kKCd0cmlhbmdsZScsIDUwMCwgMC4xLCAwLjMpOwogICAgICAgIHRoaXMucGxheVNvdW5kKCd0cmlhbmdsZScsIDgwMCwgMC4xLCAwLjMpOwogICAgfSwKICAgIHBsYXlUYWIoKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDcwMCwgMC4wOCwgMC4yKTsKICAgIH0sCiAgICBwbGF5Q29tYmluZSgpIHsKICAgICAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHRoaXMucGxheVNvdW5kKCdzYXd0b290aCcsIDIwMCwgMC4yLCAwLjQpOwogICAgICAgIHRoaXMucGxheVNvdW5kKCdzYXd0b290aCcsIDEwMCwgMC4zLCAwLjQpOwogICAgfSwKICAgIHBsYXlEaXNjb3ZlcigpIHsKICAgICAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5hdWRpb0NvbnRleHQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGxheVNvdW5kKCdzaW5lJywgNTIzLjI1LCAwLjEsIDAuNCksIDApOyAvLyBDNQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5wbGF5U291bmQoJ3NpbmUnLCA2NTkuMjUsIDAuMSwgMC40KSwgMTAwKTsgLy8gRTUKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGxheVNvdW5kKCdzaW5lJywgNzgzLjk5LCAwLjEsIDAuNCksIDIwMCk7IC8vIEc1CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDEwNDYuNTAsIDAuMiwgMC41KSwgMzAwKTsgLy8gQzYKICAgIH0sCiAgICBwbGF5RXJyb3IoKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB0aGlzLnBsYXlTb3VuZCgnc3F1YXJlJywgMTUwLCAwLjIsIDAuMyk7CiAgICB9Cn07Ci8vIC0tLSBHZW1pbmkgU2VydmljZSAtLS0KY29uc3QgYWkgPSBuZXcgR29vZ2xlR2VuQUkoeyBhcGlLZXk6IHByb2Nlc3MuZW52LkFQSV9LRVkgfSk7CmNvbnN0IHByZW1hZGVDb21iaW5hdGlvbnMgPSB7CiAgICAvLyBCYXNlIENvbWJpbmF0aW9ucwogICAgJ0Fpcl9FYXJ0aCc6IHsgbmFtZTogJ0R1c3QnLCBlbW9qaTogJ/CfjKzvuI8nIH0sICdBaXJfRmlyZSc6IHsgbmFtZTogJ1Ntb2tlJywgZW1vamk6ICfwn4yr77iPJyB9LCAnQWlyX1dhdGVyJzogeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwKICAgICdFYXJ0aF9GaXJlJzogeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfSwgJ0VhcnRoX1dhdGVyJzogeyBuYW1lOiAnUGxhbnQnLCBlbW9qaTogJ/CfjLEnIH0sICdGaXJlX1dhdGVyJzogeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwKICAgIC8vIFRpZXIgMiBDb21iaW5hdGlvbnMKICAgICdEdXN0X0ZpcmUnOiB7IG5hbWU6ICdHdW5wb3dkZXInLCBlbW9qaTogJ/CfkqMnIH0sICdEdXN0X1dhdGVyJzogeyBuYW1lOiAnTXVkJywgZW1vamk6ICfwn5KpJyB9LCAnRWFydGhfTGF2YSc6IHsgbmFtZTogJ1ZvbGNhbm8nLCBlbW9qaTogJ/CfjIsnIH0sCiAgICAnTGF2YV9XYXRlcic6IHsgbmFtZTogJ1N0b25lJywgZW1vamk6ICfwn6qoJyB9LCAnTGF2YV9BaXInOiB7IG5hbWU6ICdPYnNpZGlhbicsIGVtb2ppOiAn8J+WpCcgfSwgJ1BsYW50X0ZpcmUnOiB7IG5hbWU6ICdBc2gnLCBlbW9qaTogJ+KaqycgfSwKICAgICdQbGFudF9TbW9rZSc6IHsgbmFtZTogJ1RvYmFjY28nLCBlbW9qaTogJ/CfmqwnIH0sICdQbGFudF9TdG9uZSc6IHsgbmFtZTogJ0Zvc3NpbCcsIGVtb2ppOiAn8J+mtCcgfSwgJ1BsYW50X1dhdGVyJzogeyBuYW1lOiAnU3dhbXAnLCBlbW9qaTogJ/CfkIonIH0sCiAgICAnUGxhbnRfQWlyJzogeyBuYW1lOiAnUG9sbGVuJywgZW1vamk6ICfwn4y8JyB9LCAnUGxhbnRfRWFydGgnOiB7IG5hbWU6ICdHcmFzcycsIGVtb2ppOiAn8J+MvicgfSwgJ1JhaW5fRWFydGgnOiB7IG5hbWU6ICdNdWQnLCBlbW9qaTogJ/CfkqknIH0sCiAgICAnUmFpbl9GaXJlJzogeyBuYW1lOiAnUmFpbmJvdycsIGVtb2ppOiAn8J+MiCcgfSwgJ1N0ZWFtX0Fpcic6IHsgbmFtZTogJ0Nsb3VkJywgZW1vamk6ICfimIHvuI8nIH0sICdTdGVhbV9FYXJ0aCc6IHsgbmFtZTogJ0dleXNlcicsIGVtb2ppOiAn4pmo77iPJyB9LAogICAgJ1Ntb2tlX1dhdGVyJzogeyBuYW1lOiAnRm9nJywgZW1vamk6ICfwn4yr77iPJyB9LAogICAgLy8gVGllciAzIENvbWJpbmF0aW9ucwogICAgJ0FzaF9TdG9uZSc6IHsgbmFtZTogJ1N0YXR1ZScsIGVtb2ppOiAn8J+XvycgfSwgJ0Nsb3VkX0ZpcmUnOiB7IG5hbWU6ICdMaWdodG5pbmcnLCBlbW9qaTogJ+KaoScgfSwgJ0Nsb3VkX1dhdGVyJzogeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwKICAgICdHcmFzc19HcmFzcyc6IHsgbmFtZTogJ0xhd24nLCBlbW9qaTogJ/Cfj6EnIH0sICdHcmFzc19FYXJ0aCc6IHsgbmFtZTogJ0ZpZWxkJywgZW1vamk6ICfwn4+e77iPJyB9LCAnTGlnaHRuaW5nX01ldGFsJzogeyBuYW1lOiAnRWxlY3RyaWNpdHknLCBlbW9qaTogJ/CfkqEnIH0sCiAgICAnTGlnaHRuaW5nX0VhcnRoJzogeyBuYW1lOiAnQ3J5c3RhbCcsIGVtb2ppOiAn8J+SjicgfSwgJ011ZF9GaXJlJzogeyBuYW1lOiAnQnJpY2snLCBlbW9qaTogJ/Cfp7EnIH0sICdTdG9uZV9GaXJlJzogeyBuYW1lOiAnTWV0YWwnLCBlbW9qaTogJ/CflKknIH0sCiAgICAnU3RvbmVfV2F0ZXInOiB7IG5hbWU6ICdTYW5kJywgZW1vamk6ICfwn4+W77iPJyB9LCAnU3RvbmVfQWlyJzogeyBuYW1lOiAnU2FuZHN0b3JtJywgZW1vamk6ICfwn4yq77iPJyB9LAogICAgLy8gVGllciA0KwogICAgJ0JyaWNrX0JyaWNrJzogeyBuYW1lOiAnV2FsbCcsIGVtb2ppOiAn8J+nsScgfSwgJ0VsZWN0cmljaXR5X0dsYXNzJzogeyBuYW1lOiAnTGlnaHQgQnVsYicsIGVtb2ppOiAn8J+SoScgfSwgJ01ldGFsX1dhdGVyJzogeyBuYW1lOiAnUnVzdCcsIGVtb2ppOiAn8J+UqScgfSwKICAgICdTYW5kX0ZpcmUnOiB7IG5hbWU6ICdHbGFzcycsIGVtb2ppOiAn8J+lgycgfSwgJ1dhbGxfV2FsbCc6IHsgbmFtZTogJ0hvdXNlJywgZW1vamk6ICfwn4+gJyB9LAogICAgLy8gU2VsZi1jb21iaW5hdGlvbnMgJiBsb2dpY2FsIGV4dGVuc2lvbnMKICAgICdFYXJ0aF9FYXJ0aCc6IHsgbmFtZTogJ0xhbmQnLCBlbW9qaTogJ/Cfj57vuI8nIH0sICdXYXRlcl9XYXRlcic6IHsgbmFtZTogJ1NlYScsIGVtb2ppOiAn8J+MiicgfSwgJ1NlYV9TZWEnOiB7IG5hbWU6ICdPY2VhbicsIGVtb2ppOiAn8J+MiicgfSwKICAgICdPY2Vhbl9FYXJ0aCc6IHsgbmFtZTogJ0lzbGFuZCcsIGVtb2ppOiAn8J+Pne+4jycgfSwgJ1BsYW50X1BsYW50JzogeyBuYW1lOiAnR2FyZGVuJywgZW1vamk6ICfwn6q0JyB9LCAnR2FyZGVuX1BsYW50JzogeyBuYW1lOiAnRm9yZXN0JywgZW1vamk6ICfwn4yzJyB9LAogICAgJ0ZvcmVzdF9GaXJlJzogeyBuYW1lOiAnV2lsZGZpcmUnLCBlbW9qaTogJ/CflKUnIH0sICdTdG9uZV9TdG9uZSc6IHsgbmFtZTogJ01vdW50YWluJywgZW1vamk6ICfim7DvuI8nIH0sICdNb3VudGFpbl9MYXZhJzogeyBuYW1lOiAnRXJ1cHRpb24nLCBlbW9qaTogJ/CfjIsnIH0sCiAgICAvLyBMaWZlICYgSHVtYW4gUGF0aAogICAgJ0VhcnRoX0xpZmUnOiB7IG5hbWU6ICdIdW1hbicsIGVtb2ppOiAn8J+njScgfSwgJ0ZpcmVfTGlmZSc6IHsgbmFtZTogJ1Bob2VuaXgnLCBlbW9qaTogJ/CfkKbigI3wn5SlJyB9LCAnSHVtYW5fUGxhbnQnOiB7IG5hbWU6ICdGYXJtZXInLCBlbW9qaTogJ/CfkajigI3wn4y+JyB9LAogICAgJ0h1bWFuX1N0b25lJzogeyBuYW1lOiAnVG9vbCcsIGVtb2ppOiAn8J+UpycgfSwgJ0h1bWFuX0ZpcmUnOiB7IG5hbWU6ICdDb29rJywgZW1vamk6ICfwn5Go4oCN8J+NsycgfSwgJ0h1bWFuX1dhdGVyJzogeyBuYW1lOiAnU2FpbG9yJywgZW1vamk6ICfwn5Go4oCN4pyI77iPJyB9LAogICAgJ0h1bWFuX0h1bWFuJzogeyBuYW1lOiAnTG92ZScsIGVtb2ppOiAn4p2k77iPJyB9LCAnSHVtYW5fSG91c2UnOiB7IG5hbWU6ICdGYW1pbHknLCBlbW9qaTogJ/CfkajigI3wn5Gp4oCN8J+Rp+KAjfCfkaYnIH0sICdGYXJtZXJfRmllbGQnOiB7IG5hbWU6ICdXaGVhdCcsIGVtb2ppOiAn8J+MvicgfSwKICAgICdUb29sX0ZvcmVzdCc6IHsgbmFtZTogJ1dvb2QnLCBlbW9qaTogJ/CfqrUnIH0sICdUb29sX1dvb2QnOiB7IG5hbWU6ICdXaGVlbCcsIGVtb2ppOiAn8J+bnicgfSwgJ1doZWF0X1N0b25lJzogeyBuYW1lOiAnRmxvdXInLCBlbW9qaTogJ+KaqicgfSwKICAgICdGbG91cl9XYXRlcic6IHsgbmFtZTogJ0RvdWdoJywgZW1vamk6ICfwn42qJyB9LCAnRG91Z2hfRmlyZSc6IHsgbmFtZTogJ0JyZWFkJywgZW1vamk6ICfwn42eJyB9LAp9Owpjb25zdCByZXNwb25zZVNjaGVtYSA9IHsKICAgIHR5cGU6IFR5cGUuT0JKRUNULAogICAgcHJvcGVydGllczogewogICAgICAgIG5hbWU6IHsgdHlwZTogVHlwZS5TVFJJTkcsIGRlc2NyaXB0aW9uOiAiVGhlIG5hbWUgb2YgdGhlIHJlc3VsdGluZyBlbGVtZW50LiBTaG91bGQgYmUgc2ltcGxlLCBvbmUgb3IgdHdvIHdvcmRzLiBJZiB0aGUgY29tYmluYXRpb24gaXMgbm9uc2Vuc2ljYWwgb3IgcmVzdWx0cyBpbiB0aGUgc2FtZSBlbGVtZW50LCB1c2UgJ05vdGhpbmcnIG9yIHRoZSBvcmlnaW5hbCBlbGVtZW50J3MgbmFtZS4iIH0sCiAgICAgICAgZW1vamk6IHsgdHlwZTogVHlwZS5TVFJJTkcsIGRlc2NyaXB0aW9uOiAiQSBzaW5nbGUsIHJlbGV2YW50IGVtb2ppIGZvciB0aGUgcmVzdWx0aW5nIGVsZW1lbnQuIFVzZSAn8J+ktycgZm9yIG5vbnNlbnNpY2FsIGNvbWJpbmF0aW9ucy4iIH0sCiAgICAgICAgaXNOZXdEaXNjb3Zlcnk6IHsgdHlwZTogVHlwZS5CT09MRUFOLCBkZXNjcmlwdGlvbjogIlNldCB0byB0cnVlIGlmIHRoZSBjb21iaW5hdGlvbiBjcmVhdGVzIGEgZ2VudWluZWx5IG5ldyBhbmQgZGlzdGluY3QgZWxlbWVudC4gU2V0IHRvIGZhbHNlIGlmIGl0IHJlc3VsdHMgaW4gJ05vdGhpbmcnLCBvbmUgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnRzLCBvciBzb21ldGhpbmcgdHJpdmlhbC4iIH0sCiAgICAgICAgY29tbWVudGFyeTogeyB0eXBlOiBUeXBlLlNUUklORywgZGVzY3JpcHRpb246ICJBIHF1aXJreSwgc2hvcnQsIGZpcnN0LXBlcnNvbiBjb21tZW50IGZyb20gdGhlIHBlcnNwZWN0aXZlIG9mIHRoZSBuZXcgZWxlbWVudC4gTWF4IDE1IHdvcmRzLiIgfQogICAgfSwKICAgIHJlcXVpcmVkOiBbIm5hbWUiLCAiZW1vamkiLCAiaXNOZXdEaXNjb3ZlcnkiLCAiY29tbWVudGFyeSJdCn07CmFzeW5jIGZ1bmN0aW9uIGdldENvbWJpbmF0aW9uKGVsZW1lbnQxLCBlbGVtZW50MikgewogICAgY29uc3Qga2V5ID0gW2VsZW1lbnQxLm5hbWUsIGVsZW1lbnQyLm5hbWVdLnNvcnQoKS5qb2luKCdfJyk7CiAgICBjb25zdCBwcmVtYWRlUmVzdWx0ID0gcHJlbWFkZUNvbWJpbmF0aW9uc1trZXldOwogICAgaWYgKHByZW1hZGVSZXN1bHQpIHsKICAgICAgICByZXR1cm4geyAuLi5wcmVtYWRlUmVzdWx0LCBpc05ldzogdHJ1ZSwgY29tbWVudGFyeTogJ0EgY2xhc3NpYyBjb21iaW5hdGlvbiEnIH07CiAgICB9CiAgICBpZiAoZWxlbWVudDEubmFtZSA9PT0gZWxlbWVudDIubmFtZSkgewogICAgICAgIHJldHVybiB7IG5hbWU6IGVsZW1lbnQxLm5hbWUsIGVtb2ppOiBlbGVtZW50MS5lbW9qaSwgaXNOZXc6IGZhbHNlLCBjb21tZW50YXJ5OiAnVHdvIG9mIHRoZSBzYW1lIG1ha2Ugbm8gY2hhbmdlLicgfTsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJvbXB0ID0gYFlvdSBhcmUgYW4gQUkgZm9yIGEgY3JlYXRpdmUgYWxjaGVteSBnYW1lLiBXaGF0IGlzIGNyZWF0ZWQgd2hlbiB5b3UgY29tYmluZSAiJHtlbGVtZW50MS5uYW1lfSAke2VsZW1lbnQxLmVtb2ppfSIgYW5kICIke2VsZW1lbnQyLm5hbWV9ICR7ZWxlbWVudDIuZW1vaml9Ij8KICAgIC0gSWYgaXQgY3JlYXRlcyBhIG5ldywgbG9naWNhbCBpdGVtLCBwcm92aWRlIGl0cyBuYW1lLCBlbW9qaSwgYW5kIGEgZnVuIGNvbW1lbnRhcnkgZnJvbSBpdHMgcGVyc3BlY3RpdmUuCiAgICAtIElmIHRoZSBjb21iaW5hdGlvbiBpcyBpbGxvZ2ljYWwsIGltcG9zc2libGUsIG9yIGp1c3QgbWFrZXMgbW9yZSBvZiBvbmUgb2YgdGhlIGlucHV0cyAoZS5nLiwgRmlyZSArIEZpcmUpLCByZXNwb25kIHdpdGggYSByZXN1bHQgd2hlcmUgaXNOZXdEaXNjb3ZlcnkgaXMgZmFsc2UuCiAgICAtIEtlZXAgdGhlIG5hbWVzIHNpbXBsZSAoMS0zIHdvcmRzKS4gLSBCZSBjcmVhdGl2ZSBhbmQgY29uc2lzdGVudC5gOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7CiAgICAgICAgICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaCcsIGNvbnRlbnRzOiBwcm9tcHQsCiAgICAgICAgICAgIGNvbmZpZzogeyByZXNwb25zZU1pbWVUeXBlOiAnYXBwbGljYXRpb24vanNvbicsIHJlc3BvbnNlU2NoZW1hOiByZXNwb25zZVNjaGVtYSwgdGVtcGVyYXR1cmU6IDAuOCB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS50ZXh0LnRyaW0oKSk7CiAgICAgICAgcmV0dXJuIHsgbmFtZTogcmVzdWx0Lm5hbWUsIGVtb2ppOiByZXN1bHQuZW1vamksIGlzTmV3OiByZXN1bHQuaXNOZXdEaXNjb3ZlcnksIGNvbW1lbnRhcnk6IHJlc3VsdC5jb21tZW50YXJ5IH07CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjYWxsaW5nIEdlbWluaSBBUEk6IiwgZXJyb3IpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQp9Ci8vIC0tLSBBcHAgU3RhdGUgJiBDb25zdGFudHMgLS0tCmNvbnN0IGluaXRpYWxFbGVtZW50cyA9IFsKICAgIHsgbmFtZTogJ1dhdGVyJywgZW1vamk6ICfwn5KnJyB9LCB7IG5hbWU6ICdGaXJlJywgZW1vamk6ICfwn5SlJyB9LAogICAgeyBuYW1lOiAnRWFydGgnLCBlbW9qaTogJ/CfjI0nIH0sIHsgbmFtZTogJ0FpcicsIGVtb2ppOiAn8J+SqCcgfSwKXTsKY29uc3QgY2hhbGxlbmdlVGllcnMgPSBbCiAgICBbeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwgeyBuYW1lOiAnRHVzdCcsIGVtb2ppOiAn8J+MrO+4jycgfSwgeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwgeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfV0sCiAgICBbeyBuYW1lOiAnU3RvbmUnLCBlbW9qaTogJ/CfqqgnIH0sIHsgbmFtZTogJ1BsYW50JywgZW1vamk6ICfwn4yxJyB9LCB7IG5hbWU6ICdTbW9rZScsIGVtb2ppOiAn8J+Mq++4jycgfSwgeyBuYW1lOiAnT2JzaWRpYW4nLCBlbW9qaTogJ/CflqQnIH1dLAogICAgW3sgbmFtZTogJ011ZCcsIGVtb2ppOiAn8J+SqScgfSwgeyBuYW1lOiAnQnJpY2snLCBlbW9qaTogJ/Cfp7EnIH0sIHsgbmFtZTogJ0dyYXNzJywgZW1vamk6ICfwn4y+JyB9LCB7IG5hbWU6ICdTYW5kJywgZW1vamk6ICfwn4+W77iPJyB9XSwKICAgIFt7IG5hbWU6ICdNZXRhbCcsIGVtb2ppOiAn8J+UqScgfSwgeyBuYW1lOiAnR2xhc3MnLCBlbW9qaTogJ/CfpYMnIH0sIHsgbmFtZTogJ1dhbGwnLCBlbW9qaTogJ/Cfp7EnIH0sIHsgbmFtZTogJ0xpZ2h0bmluZycsIGVtb2ppOiAn4pqhJyB9XSwKICAgIFt7IG5hbWU6ICdIb3VzZScsIGVtb2ppOiAn8J+PoCcgfSwgeyBuYW1lOiAnRWxlY3RyaWNpdHknLCBlbW9qaTogJ/CfkqEnIH0sIHsgbmFtZTogJ0h1bWFuJywgZW1vamk6ICfwn6eNJyB9LCB7IG5hbWU6ICdQaG9lbml4JywgZW1vamk6ICfwn5Cm4oCN8J+UpScgfV0KXTsKY29uc3QgRElTQ09WRVJFRF9FTEVNRU5UU19LRVkgPSAnZ2VuY3JhZnRfZGlzY292ZXJlZEVsZW1lbnRzJzsKY29uc3QgQ0hBTExFTkdFX0xFVkVMX0tFWSA9ICdnZW5jcmFmdF9jaGFsbGVuZ2VMZXZlbCc7CmxldCBnYW1lTW9kZSA9ICdtZW51JzsgLy8gJ21lbnUnLCAnZnJlZScsICdjaGFsbGVuZ2UnCmxldCB3b3Jrc3BhY2VFbGVtZW50cyA9IFtdOwpsZXQgZGlzY292ZXJlZEVsZW1lbnRzID0gWy4uLmluaXRpYWxFbGVtZW50c107CmxldCBjaGFsbGVuZ2VTdGF0ZSA9IHsgbGV2ZWw6IDAsIHRhcmdldDogbnVsbCwgc3RhcnRUaW1lOiAwLCB0aW1lcjogJzAwOjAwJywgaXNBY3RpdmU6IGZhbHNlIH07CmxldCBuZXh0SWQgPSAwOwpsZXQgdGltZXJJbnRlcnZhbDsKbGV0IGRyYWdnaW5nSW5mbyA9IHsgaWQ6IG51bGwsIGVsZW1lbnQ6IG51bGwsIG9mZnNldFg6IDAsIG9mZnNldFk6IDAgfTsKbGV0IGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCA9IG51bGw7Ci8vIC0tLSBEYXRhIFBlcnNpc3RlbmNlIC0tLQpmdW5jdGlvbiBzYXZlUHJvZ3Jlc3MoKSB7CiAgICBpZiAoZ2FtZU1vZGUgPT09ICdmcmVlJykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKERJU0NPVkVSRURfRUxFTUVOVFNfS0VZLCBKU09OLnN0cmluZ2lmeShkaXNjb3ZlcmVkRWxlbWVudHMpKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIHNhdmUgcHJvZ3Jlc3M6IiwgZSk7CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIGxvYWRQcm9ncmVzcygpIHsKICAgIGNvbnN0IHNhdmVkRGlzY292ZXJpZXMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShESVNDT1ZFUkVEX0VMRU1FTlRTX0tFWSk7CiAgICBpZiAoc2F2ZWREaXNjb3ZlcmllcykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2Uoc2F2ZWREaXNjb3Zlcmllcyk7CiAgICAgICAgICAgIC8vIEJhc2ljIHZhbGlkYXRpb24gdG8gZW5zdXJlIGl0J3MgYSB2YWxpZCBhcnJheSBvZiBkaXNjb3ZlcmllcwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXJzZWQpICYmIHBhcnNlZC5sZW5ndGggPj0gaW5pdGlhbEVsZW1lbnRzLmxlbmd0aCAmJiBwYXJzZWRbMF0ubmFtZSkgewogICAgICAgICAgICAgICAgZGlzY292ZXJlZEVsZW1lbnRzID0gcGFyc2VkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBwYXJzZSBzYXZlZCBkaXNjb3ZlcmllczoiLCBlKTsKICAgICAgICB9CiAgICB9Cn0KLy8gLS0tIERPTSBSZWZlcmVuY2VzIC0tLQpjb25zdCB3b3Jrc3BhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NwYWNlJyk7CmNvbnN0IGdhbWVNZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUtbWVudScpOwpjb25zdCBjaGFsbGVuZ2VQcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXByb21wdCcpOwpjb25zdCBjaGFsbGVuZ2VIVUQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLWh1ZCcpOwpjb25zdCBlbmRHYW1lQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuZC1nYW1lLWJ0bicpOwpjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyk7CmNvbnN0IGFpUG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWktcG9wdXAnKTsKY29uc3QgZGlzY292ZXJ5Q291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzY292ZXJ5LWNvdW50Jyk7CmNvbnN0IGVsZW1lbnRzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbGVtZW50cy1saXN0Jyk7CmNvbnN0IHJlY2lwZXNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtbGlzdCcpOwpjb25zdCBzZWFyY2hJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gtaW5wdXQnKTsKY29uc3QgdGFiRWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLWVsZW1lbnRzJyk7CmNvbnN0IHRhYlJlY2lwZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLXJlY2lwZXMnKTsKY29uc3QgZWxlbWVudHNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VsZW1lbnRzLWVtcHR5LXN0YXRlJyk7CmNvbnN0IHJlY2lwZXNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtZW1wdHktc3RhdGUnKTsKY29uc3QgY2xlYXJTZWFyY2hCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItc2VhcmNoLWJ0bicpOwpjb25zdCBhcGlLZXlNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcGkta2V5LW1vZGFsJyk7CmNvbnN0IGFwaUtleUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaS1rZXktaW5wdXQnKTsKY29uc3QgYXBpS2V5U3VibWl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaS1rZXktc3VibWl0LWJ0bicpOwpjb25zdCBhcGlLZXlDYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBpLWtleS1jYW5jZWwtYnRuJyk7CmNvbnN0IGludHJvT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnRyby1vdmVybGF5Jyk7Ci8vIC0tLSBVSSBVcGRhdGUgRnVuY3Rpb25zIC0tLQpmdW5jdGlvbiB1cGRhdGVVSSgpIHsKICAgIC8vIEdhbWUgTW9kZSB2aXNpYmlsaXR5CiAgICBnYW1lTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBnYW1lTW9kZSAhPT0gJ21lbnUnKTsKICAgIGNoYWxsZW5nZUhVRC5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBnYW1lTW9kZSAhPT0gJ2NoYWxsZW5nZScgfHwgIWNoYWxsZW5nZVN0YXRlLmlzQWN0aXZlKTsKICAgIGVuZEdhbWVCdG4uZGlzYWJsZWQgPSBnYW1lTW9kZSA9PT0gJ21lbnUnOwogICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJykgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFsbGVuZ2UtbGV2ZWwnKS50ZXh0Q29udGVudCA9IGNoYWxsZW5nZVN0YXRlLmxldmVsLnRvU3RyaW5nKCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYWxsZW5nZS10YXJnZXQnKS50ZXh0Q29udGVudCA9IGNoYWxsZW5nZVN0YXRlLnRhcmdldD8ubmFtZSB8fCAnLi4uJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXRpbWVyJykudGV4dENvbnRlbnQgPSBjaGFsbGVuZ2VTdGF0ZS50aW1lcjsKICAgICAgICBlbmRHYW1lQnRuLmlubmVySFRNTCA9ICc8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHB4LTIiPlFVSVQ8L3NwYW4+JzsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGlmIChlbmRHYW1lQnRuRGVmYXVsdENvbnRlbnQpIHsKICAgICAgICAgICAgZW5kR2FtZUJ0bi5pbm5lckhUTUwgPSBlbmRHYW1lQnRuRGVmYXVsdENvbnRlbnQ7CiAgICAgICAgfQogICAgfQogICAgcmVuZGVyU2lkZWJhcigpOwogICAgcmVuZGVyV29ya3NwYWNlKCk7Cn0KZnVuY3Rpb24gcmVuZGVyV29ya3NwYWNlKCkgewogICAgd29ya3NwYWNlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5lbGVtZW50LWNhcmQnKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgIHdvcmtzcGFjZUVsZW1lbnRzLmZvckVhY2goZWwgPT4gewogICAgICAgIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBjYXJkLmNsYXNzTmFtZSA9ICdlbGVtZW50LWNhcmQnOwogICAgICAgIGNhcmQuZGF0YXNldC5pZCA9IFN0cmluZyhlbC5pZCk7CiAgICAgICAgY2FyZC5zdHlsZS5sZWZ0ID0gYCR7ZWwueH1weGA7CiAgICAgICAgY2FyZC5zdHlsZS50b3AgPSBgJHtlbC55fXB4YDsKICAgICAgICBjYXJkLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJ0ZXh0LTR4bCBtci0zIHBvaW50ZXItZXZlbnRzLW5vbmUiPiR7ZWwuZW1vaml9PC9kaXY+PGRpdiBjbGFzcz0idGV4dC1sZyBmb250LWJvbGQgZm9udC1vcmJpdHJvbiBwb2ludGVyLWV2ZW50cy1ub25lIHRydW5jYXRlIj4ke2VsLm5hbWV9PC9kaXY+YDsKICAgICAgICBpZiAoZWwuaXNOZXcpIHsKICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCduZXcnKTsKICAgICAgICAgICAgLy8gUmVtb3ZlIGNsYXNzIGFmdGVyIGFuaW1hdGlvbgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnbmV3JyksIDUwMCk7CiAgICAgICAgfQogICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IGhhbmRsZU1vdXNlRG93bihlLCBlbC5pZCkpOwogICAgICAgIHdvcmtzcGFjZS5hcHBlbmRDaGlsZChjYXJkKTsKICAgIH0pOwp9CmZ1bmN0aW9uIHJlbmRlclNpZGViYXIoKSB7CiAgICBjb25zdCB0ZXJtID0gc2VhcmNoSW5wdXQudmFsdWUudG9Mb3dlckNhc2UoKTsKICAgIC8vIFVwZGF0ZSBjb3VudAogICAgZGlzY292ZXJ5Q291bnQudGV4dENvbnRlbnQgPSBgJHtkaXNjb3ZlcmVkRWxlbWVudHMubGVuZ3RofSBmb3VuZGA7CiAgICAvLyBGaWx0ZXIgYW5kIHJlbmRlciBlbGVtZW50cwogICAgY29uc3QgZmlsdGVyZWRFbGVtZW50cyA9IGRpc2NvdmVyZWRFbGVtZW50cwogICAgICAgIC5maWx0ZXIoZWwgPT4gZWwubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pKQogICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTsKICAgIGVsZW1lbnRzTGlzdC5pbm5lckhUTUwgPSAnJzsKICAgIGlmIChmaWx0ZXJlZEVsZW1lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICBmaWx0ZXJlZEVsZW1lbnRzLmZvckVhY2goZWwgPT4gewogICAgICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICAgICAgYnRuLmNsYXNzTmFtZSA9ICJmbGV4IGl0ZW1zLWNlbnRlciBwLTIgYmctZ3JheS04MDAvNTAgcm91bmRlZC1sZyBob3ZlcjpiZy1jeWFuLTUwMC8yMCBib3JkZXIgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1jeWFuLTUwMCB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSI7CiAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9InRleHQtMnhsIG1yLTIiPiR7ZWwuZW1vaml9PC9zcGFuPjxzcGFuIGNsYXNzPSJ0ZXh0LXdoaXRlIHRleHQtc20gdHJ1bmNhdGUiPiR7ZWwubmFtZX08L3NwYW4+YDsKICAgICAgICAgICAgYnRuLm9uY2xpY2sgPSAoKSA9PiBzcGF3bkVsZW1lbnQoZWwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmYWxzZSk7CiAgICAgICAgICAgIGVsZW1lbnRzTGlzdC5hcHBlbmRDaGlsZChidG4pOwogICAgICAgIH0pOwogICAgfQogICAgZWxlbWVudHNFbXB0eVN0YXRlLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsIGZpbHRlcmVkRWxlbWVudHMubGVuZ3RoID4gMCk7CiAgICAvLyBGaWx0ZXIgYW5kIHJlbmRlciByZWNpcGVzCiAgICBjb25zdCBmaWx0ZXJlZFJlY2lwZXMgPSBkaXNjb3ZlcmVkRWxlbWVudHMKICAgICAgICAuZmlsdGVyKGVsID0+IGVsLnJlY2lwZSAmJiAoZWwubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pIHx8IGVsLnJlY2lwZS5lbGVtZW50MS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pIHx8IGVsLnJlY2lwZS5lbGVtZW50Mi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pKSkKICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7CiAgICByZWNpcGVzTGlzdC5pbm5lckhUTUwgPSAnJzsKICAgIGlmIChmaWx0ZXJlZFJlY2lwZXMubGVuZ3RoID4gMCkgewogICAgICAgIGZpbHRlcmVkUmVjaXBlcy5mb3JFYWNoKGVsID0+IHsKICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSAicC0yIGJnLWdyYXktODAwLzUwIHJvdW5kZWQtbGcgdGV4dC1zbSB0ZXh0LWNlbnRlciI7CiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCI+JHtlbC5yZWNpcGUuZWxlbWVudDF9PC9zcGFuPiArIDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7ZWwucmVjaXBlLmVsZW1lbnQyfTwvc3Bhbj4g4oaSIDxzcGFuIGNsYXNzPSJ0ZXh0LWN5YW4tMzAwIGZvbnQtYm9sZCI+JHtlbC5uYW1lfSAke2VsLmVtb2ppfTwvc3Bhbj5gOwogICAgICAgICAgICByZWNpcGVzTGlzdC5hcHBlbmRDaGlsZChkaXYpOwogICAgICAgIH0pOwogICAgfQogICAgcmVjaXBlc0VtcHR5U3RhdGUuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgZmlsdGVyZWRSZWNpcGVzLmxlbmd0aCA+IDApOwp9CmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykgewogICAgbG9hZGVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFzaG93KTsKfQpmdW5jdGlvbiBzaG93QUlQb3B1cCh7IHR5cGUsIHRpdGxlLCB0ZXh0LCBjb21tZW50YXJ5IH0pIHsKICAgIGNvbnN0IHRoZW1lcyA9IHsKICAgICAgICBzdWNjZXNzOiB7IGJnOiAnYmctZ3JlZW4tOTAwLzgwJywgYm9yZGVyOiAnYm9yZGVyLWdyZWVuLTQwMCcsIGljb246ICd0ZXh0LWdyZWVuLTMwMCcgfSwKICAgICAgICBlcnJvcjogeyBiZzogJ2JnLXJlZC05MDAvODAnLCBib3JkZXI6ICdib3JkZXItcmVkLTQwMCcsIGljb246ICd0ZXh0LXJlZC0zMDAnIH0sCiAgICAgICAgaW5mbzogeyBiZzogJ2JnLWJsdWUtOTAwLzgwJywgYm9yZGVyOiAnYm9yZGVyLWJsdWUtNDAwJywgaWNvbjogJ3RleHQtYmx1ZS0zMDAnIH0KICAgIH07CiAgICBjb25zdCB0aGVtZSA9IHRoZW1lc1t0eXBlXTsKICAgIGFpUG9wdXAuY2xhc3NOYW1lID0gYGZpeGVkIHRvcC01IGxlZnQtMS8yIC10cmFuc2xhdGUteC0xLzIgdy1mdWxsIG1heC13LXNtIHAtNCByb3VuZGVkLWxnIHNoYWRvdy0yeGwgYm9yZGVyLTIgYmFja2Ryb3AtYmx1ci1tZCB6LTUwIGFuaW1hdGUtZmFkZS1pbi1kb3duICR7dGhlbWUuYmd9ICR7dGhlbWUuYm9yZGVyfWA7CiAgICBsZXQgY29tbWVudGFyeUh0bWwgPSBjb21tZW50YXJ5ID8gYDxwIGNsYXNzPSJtdC0yIHRleHQtc20gaXRhbGljIGJvcmRlci1sLTIgcGwtMiAke3RoZW1lLmJvcmRlcn0gJHt0aGVtZS5pY29ufSI+JHtjb21tZW50YXJ5fTwvcD5gIDogJyc7CiAgICBhaVBvcHVwLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLXN0YXJ0Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC1zaHJpbmstMCI+CiAgICAgICAgICAgICAgICA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgY2xhc3M9ImgtNiB3LTYgJHt0aGVtZS5pY29ufSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik01IDN2NE0zIDVoNE02IDE3djRtLTItMmg0bTUtMTZsMi4yODYgNi44NTdMMjEgMTJsLTUuNzE0IDIuMTQzTDEzIDIxbC0yLjI4Ni02Ljg1N0w1IDEybDUuNzE0LTIuMTQzTDEzIDN6IiAvPgogICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtbC0zIHctMCBmbGV4LTEiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGcgZm9udC1ib2xkIGZvbnQtb3JiaXRyb24gdGV4dC13aGl0ZSI+JHt0aXRsZX08L3A+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtMSB0ZXh0LXNtICR7dHlwZSA9PT0gJ3N1Y2Nlc3MnID8gJ3RleHQtZ3JlZW4tMjAwJyA6IHR5cGUgPT09ICdlcnJvcicgPyAndGV4dC1yZWQtMjAwJyA6ICd0ZXh0LWJsdWUtMjAwJ30iPiR7dGV4dH08L3A+CiAgICAgICAgICAgICAgICAke2NvbW1lbnRhcnlIdG1sfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWwtNCBmbGV4LXNocmluay0wIGZsZXgiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY2xvc2UtcG9wdXAtYnRuIiBjbGFzcz0iaW5saW5lLWZsZXggcm91bmRlZC1tZCB0ZXh0LWdyYXktMzAwIGhvdmVyOnRleHQtd2hpdGUiPgogICAgICAgICAgICAgICAgICAgIDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBjbGFzcz0iaC01IHctNSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNiAxOEwxOCA2TTYgNmwxMiAxMiIgLz4KICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBhaVBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLXBvcHVwLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiBhaVBvcHVwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgc2V0VGltZW91dCgoKSA9PiBhaVBvcHVwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpLCA2MDAwKTsKfQpmdW5jdGlvbiBjcmVhdGVQYXJ0aWNsZUJ1cnN0KHgsIHkpIHsKICAgIGNvbnN0IGJ1cnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBidXJzdC5jbGFzc05hbWUgPSAncGFydGljbGUtYnVyc3QnOwogICAgYnVyc3Quc3R5bGUubGVmdCA9IGAke3ggKyA4MH1weGA7IC8vIGNlbnRlciBvbiBjYXJkCiAgICBidXJzdC5zdHlsZS50b3AgPSBgJHt5ICsgNDh9cHhgOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMjsgaSsrKSB7CiAgICAgICAgY29uc3QgcGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBwYXJ0aWNsZS5jbGFzc05hbWUgPSAncGFydGljbGUnOwogICAgICAgIHBhcnRpY2xlLnN0eWxlLnNldFByb3BlcnR5KCctLWknLCBpKTsKICAgICAgICBidXJzdC5hcHBlbmRDaGlsZChwYXJ0aWNsZSk7CiAgICB9CiAgICB3b3Jrc3BhY2UuYXBwZW5kQ2hpbGQoYnVyc3QpOwogICAgc2V0VGltZW91dCgoKSA9PiBidXJzdC5yZW1vdmUoKSwgNjAwKTsKfQovLyAtLS0gR2FtZSBMb2dpYyAtLS0KZnVuY3Rpb24gc3Bhd25FbGVtZW50KGVsZW1lbnQsIHgsIHksIGlzTmV3ID0gdHJ1ZSkgewogICAgY29uc3QgYm91bmRzID0gd29ya3NwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3QgbmV3WCA9IHggPz8gTWF0aC5yYW5kb20oKSAqIChib3VuZHMud2lkdGggLSAyMDApICsgMjA7CiAgICBjb25zdCBuZXdZID0geSA/PyBNYXRoLnJhbmRvbSgpICogKGJvdW5kcy5oZWlnaHQgLSAxNTApICsgMjA7CiAgICB3b3Jrc3BhY2VFbGVtZW50cy5wdXNoKHsgLi4uZWxlbWVudCwgaWQ6IG5leHRJZCsrLCB4OiBuZXdYLCB5OiBuZXdZLCBpc05ldyB9KTsKICAgIHJlbmRlcldvcmtzcGFjZSgpOwp9CmZ1bmN0aW9uIHJlc2V0V29ya3NwYWNlKHNwYXduSW5pdGlhbCA9IHRydWUpIHsKICAgIHdvcmtzcGFjZUVsZW1lbnRzID0gW107CiAgICBpZiAoc3Bhd25Jbml0aWFsKSB7CiAgICAgICAgY29uc3QgYm91bmRzID0gd29ya3NwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IFsKICAgICAgICAgICAgeyB4OiBib3VuZHMud2lkdGggLyAyIC0gMTYwIC0gMjAsIHk6IGJvdW5kcy5oZWlnaHQgLyAyIC0gOTYgLSAyMCB9LCB7IHg6IGJvdW5kcy53aWR0aCAvIDIgKyAyMCwgeTogYm91bmRzLmhlaWdodCAvIDIgLSA5NiAtIDIwIH0sCiAgICAgICAgICAgIHsgeDogYm91bmRzLndpZHRoIC8gMiAtIDE2MCAtIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sIHsgeDogYm91bmRzLndpZHRoIC8gMiArIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sCiAgICAgICAgXTsKICAgICAgICBpbml0aWFsRWxlbWVudHMuZm9yRWFjaCgoZWwsIGkpID0+IHNwYXduRWxlbWVudChlbCwgcG9zaXRpb25zW2ldLngsIHBvc2l0aW9uc1tpXS55LCBmYWxzZSkpOwogICAgfQogICAgcmVuZGVyV29ya3NwYWNlKCk7Cn0KYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUNvbWJpbmF0aW9uKGVsMSwgZWwyKSB7CiAgICBjb25zdCBjYXJkMSA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7ZWwxLmlkfSddYCk7CiAgICBjb25zdCBjYXJkMiA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7ZWwyLmlkfSddYCk7CiAgICBjYXJkMT8uY2xhc3NMaXN0LmFkZCgnY29tYmluaW5nJyk7CiAgICBjYXJkMj8uY2xhc3NMaXN0LmFkZCgnY29tYmluaW5nJyk7CiAgICBTb3VuZE1hbmFnZXIucGxheUNvbWJpbmUoKTsKICAgIHNob3dMb2FkZXIodHJ1ZSk7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb21iaW5hdGlvbihlbDEsIGVsMik7CiAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5pc05ldykgewogICAgICAgIFNvdW5kTWFuYWdlci5wbGF5RGlzY292ZXIoKTsKICAgICAgICBjb25zdCBpc0ZpcnN0RGlzY292ZXJ5ID0gIWRpc2NvdmVyZWRFbGVtZW50cy5zb21lKGQgPT4gZC5uYW1lID09PSByZXN1bHQubmFtZSk7CiAgICAgICAgY29uc3QgbmV3RWxlbWVudCA9IHsgbmFtZTogcmVzdWx0Lm5hbWUsIGVtb2ppOiByZXN1bHQuZW1vamkgfTsKICAgICAgICBpZiAoaXNGaXJzdERpc2NvdmVyeSkgewogICAgICAgICAgICBkaXNjb3ZlcmVkRWxlbWVudHMucHVzaCh7IC4uLm5ld0VsZW1lbnQsIHJlY2lwZTogeyBlbGVtZW50MTogZWwxLm5hbWUsIGVsZW1lbnQyOiBlbDIubmFtZSB9IH0pOwogICAgICAgICAgICBzYXZlUHJvZ3Jlc3MoKTsgLy8gU2F2ZSBhZnRlciBhIG5ldyBkaXNjb3ZlcnkgaW4gZnJlZSBwbGF5IG1vZGUKICAgICAgICAgICAgc2hvd0FJUG9wdXAoeyB0eXBlOiAnc3VjY2VzcycsIHRpdGxlOiAnRmlyc3QgRGlzY292ZXJ5IScsIHRleHQ6IGBZb3UndmUgY3JlYXRlZCAke3Jlc3VsdC5uYW1lfSAke3Jlc3VsdC5lbW9qaX0hYCwgY29tbWVudGFyeTogcmVzdWx0LmNvbW1lbnRhcnkgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzaG93QUlQb3B1cCh7IHR5cGU6ICdpbmZvJywgdGl0bGU6ICdOZXcgRWxlbWVudCEnLCB0ZXh0OiBgWW91IG1hZGUgJHtyZXN1bHQubmFtZX0gJHtyZXN1bHQuZW1vaml9IWAsIGNvbW1lbnRhcnk6IHJlc3VsdC5jb21tZW50YXJ5IH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBzcGF3blggPSAoZWwxLnggKyBlbDIueCkgLyAyOwogICAgICAgIGNvbnN0IHNwYXduWSA9IChlbDEueSArIGVsMi55KSAvIDI7CiAgICAgICAgd29ya3NwYWNlRWxlbWVudHMgPSB3b3Jrc3BhY2VFbGVtZW50cy5maWx0ZXIoZWwgPT4gZWwuaWQgIT09IGVsMS5pZCAmJiBlbC5pZCAhPT0gZWwyLmlkKTsKICAgICAgICBzcGF3bkVsZW1lbnQobmV3RWxlbWVudCwgc3Bhd25YLCBzcGF3blkpOwogICAgICAgIGNyZWF0ZVBhcnRpY2xlQnVyc3Qoc3Bhd25YLCBzcGF3blkpOwogICAgICAgIGlmIChnYW1lTW9kZSA9PT0gJ2NoYWxsZW5nZScgJiYgcmVzdWx0Lm5hbWUgPT09IGNoYWxsZW5nZVN0YXRlLnRhcmdldD8ubmFtZSkgewogICAgICAgICAgICBjaGFsbGVuZ2VTdGF0ZS5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICBjb25zdCB0aW1lVGFrZW4gPSAoRGF0ZS5ub3coKSAtIGNoYWxsZW5nZVN0YXRlLnN0YXJ0VGltZSkgLyAxMDAwOwogICAgICAgICAgICBjb25zdCB0aWVySW5kZXggPSBNYXRoLm1pbihNYXRoLmZsb29yKChjaGFsbGVuZ2VTdGF0ZS5sZXZlbCAtIDEpIC8gMiksIGNoYWxsZW5nZVRpZXJzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICBjb25zdCBnb2xkVGltZSA9IDEwICsgdGllckluZGV4ICogNTsKICAgICAgICAgICAgY29uc3Qgc2lsdmVyVGltZSA9IDIwICsgdGllckluZGV4ICogMTA7CiAgICAgICAgICAgIGxldCByYW5rID0gJ0Jyb256ZSDwn6WJJzsKICAgICAgICAgICAgaWYgKHRpbWVUYWtlbiA8IGdvbGRUaW1lKQogICAgICAgICAgICAgICAgcmFuayA9ICdHb2xkIPCfpYcnOwogICAgICAgICAgICBlbHNlIGlmICh0aW1lVGFrZW4gPCBzaWx2ZXJUaW1lKQogICAgICAgICAgICAgICAgcmFuayA9ICdTaWx2ZXIg8J+liCc7CiAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ3N1Y2Nlc3MnLCB0aXRsZTogYExldmVsICR7Y2hhbGxlbmdlU3RhdGUubGV2ZWx9IENvbXBsZXRlIWAsIHRleHQ6IGBSYW5rOiAke3Jhbmt9IHwgVGltZTogJHt0aW1lVGFrZW4udG9GaXhlZCgxKX1zYCwgY29tbWVudGFyeTogYFlvdSBjcmFmdGVkICR7Y2hhbGxlbmdlU3RhdGUudGFyZ2V0Lm5hbWV9IWAgfSk7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVksIEpTT04uc3RyaW5naWZ5KGNoYWxsZW5nZVN0YXRlLmxldmVsKSk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc3RhcnROZXh0TGV2ZWwoY2hhbGxlbmdlU3RhdGUubGV2ZWwpLCA0MDAwKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBTb3VuZE1hbmFnZXIucGxheUVycm9yKCk7CiAgICAgICAgY29uc3QgcmVhc29uID0gcmVzdWx0ID8gYENvbWJpbmluZyAke2VsMS5uYW1lfSBhbmQgJHtlbDIubmFtZX0gcmVzdWx0cyBpbiAke3Jlc3VsdC5uYW1lfS4gTm90aGluZyBuZXcgY3JlYXRlZC5gIDogIlRob3NlIGVsZW1lbnRzIGRvbid0IHNlZW0gdG8gY29tYmluZSB3ZWxsLiI7CiAgICAgICAgc2hvd0FJUG9wdXAoeyB0eXBlOiAnZXJyb3InLCB0aXRsZTogJ05vIFJlYWN0aW9uJywgdGV4dDogcmVhc29uLCBjb21tZW50YXJ5OiByZXN1bHQ/LmNvbW1lbnRhcnkgfSk7CiAgICB9CiAgICBzaG93TG9hZGVyKGZhbHNlKTsKICAgIGNhcmQxPy5jbGFzc0xpc3QucmVtb3ZlKCdjb21iaW5pbmcnKTsKICAgIGNhcmQyPy5jbGFzc0xpc3QucmVtb3ZlKCdjb21iaW5pbmcnKTsKICAgIHVwZGF0ZVVJKCk7Cn0KLy8gLS0tIEV2ZW50IEhhbmRsZXJzICYgR2FtZSBGbG93IC0tLQpmdW5jdGlvbiBoYW5kbGVNb3VzZURvd24oZSwgaWQpIHsKICAgIGlmIChnYW1lTW9kZSA9PT0gJ21lbnUnIHx8IGRyYWdnaW5nSW5mby5pZCkKICAgICAgICByZXR1cm47CiAgICBjb25zdCBlbGVtZW50ID0gd29ya3NwYWNlRWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gaWQpOwogICAgY29uc3QgY2FyZCA9IGUuY3VycmVudFRhcmdldDsKICAgIGlmICghZWxlbWVudCB8fCAhY2FyZCkKICAgICAgICByZXR1cm47CiAgICBjYXJkLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJyk7CiAgICBkcmFnZ2luZ0luZm8gPSB7CiAgICAgICAgaWQsIGVsZW1lbnQ6IGNhcmQsCiAgICAgICAgb2Zmc2V0WDogZS5jbGllbnRYIC0gY2FyZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0LAogICAgICAgIG9mZnNldFk6IGUuY2xpZW50WSAtIGNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wLAogICAgfTsKICAgIC8vIE1vdmUgdG8gdG9wCiAgICB3b3Jrc3BhY2UuYXBwZW5kQ2hpbGQoY2FyZCk7CiAgICBkb2N1bWVudC5vbm1vdXNlbW92ZSA9IGhhbmRsZU1vdXNlTW92ZTsKICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGhhbmRsZU1vdXNlVXA7Cn0KZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlKGUpIHsKICAgIGlmICghZHJhZ2dpbmdJbmZvLmlkIHx8ICFkcmFnZ2luZ0luZm8uZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBjb25zdCB7IGVsZW1lbnQsIG9mZnNldFgsIG9mZnNldFkgfSA9IGRyYWdnaW5nSW5mbzsKICAgIGNvbnN0IHdvcmtzcGFjZVJlY3QgPSB3b3Jrc3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBsZXQgeCA9IGUuY2xpZW50WCAtIHdvcmtzcGFjZVJlY3QubGVmdCAtIG9mZnNldFg7CiAgICBsZXQgeSA9IGUuY2xpZW50WSAtIHdvcmtzcGFjZVJlY3QudG9wIC0gb2Zmc2V0WTsKICAgIC8vIENsYW1wIHBvc2l0aW9uIHdpdGhpbiB3b3Jrc3BhY2UKICAgIHggPSBNYXRoLm1heCgwLCBNYXRoLm1pbih4LCB3b3Jrc3BhY2VSZWN0LndpZHRoIC0gZWxlbWVudC5vZmZzZXRXaWR0aCkpOwogICAgeSA9IE1hdGgubWF4KDAsIE1hdGgubWluKHksIHdvcmtzcGFjZVJlY3QuaGVpZ2h0IC0gZWxlbWVudC5vZmZzZXRIZWlnaHQpKTsKICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3h9cHhgOwogICAgZWxlbWVudC5zdHlsZS50b3AgPSBgJHt5fXB4YDsKICAgIGNvbnN0IGRyYWdnZWRSZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGZvciAoY29uc3Qgb3RoZXJFbCBvZiB3b3Jrc3BhY2VFbGVtZW50cykgewogICAgICAgIGlmIChvdGhlckVsLmlkID09PSBkcmFnZ2luZ0luZm8uaWQpCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNvbnN0IG90aGVyQ2FyZCA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7b3RoZXJFbC5pZH0nXWApOwogICAgICAgIGlmICghb3RoZXJDYXJkKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICBjb25zdCBvdGhlclJlY3QgPSBvdGhlckNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgaWYgKGRyYWdnZWRSZWN0LmxlZnQgPCBvdGhlclJlY3QucmlnaHQgJiYgZHJhZ2dlZFJlY3QucmlnaHQgPiBvdGhlclJlY3QubGVmdCAmJgogICAgICAgICAgICBkcmFnZ2VkUmVjdC50b3AgPCBvdGhlclJlY3QuYm90dG9tICYmIGRyYWdnZWRSZWN0LmJvdHRvbSA+IG90aGVyUmVjdC50b3ApIHsKICAgICAgICAgICAgY29uc3QgZHJhZ2dlZEVsZW1lbnQgPSB3b3Jrc3BhY2VFbGVtZW50cy5maW5kKGVsID0+IGVsLmlkID09PSBkcmFnZ2luZ0luZm8uaWQpOwogICAgICAgICAgICBpZiAoZHJhZ2dlZEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBwb3NpdGlvbiBmb3Igc3Bhd24gY2FsY3VsYXRpb24KICAgICAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50LnggPSB4OwogICAgICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQueSA9IHk7CiAgICAgICAgICAgICAgICBoYW5kbGVNb3VzZVVwKCk7CiAgICAgICAgICAgICAgICBwZXJmb3JtQ29tYmluYXRpb24oZHJhZ2dlZEVsZW1lbnQsIG90aGVyRWwpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIGhhbmRsZU1vdXNlVXAoKSB7CiAgICBpZiAoIWRyYWdnaW5nSW5mby5pZCB8fCAhZHJhZ2dpbmdJbmZvLmVsZW1lbnQpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgeyBpZCwgZWxlbWVudCB9ID0gZHJhZ2dpbmdJbmZvOwogICAgY29uc3QgZWxJblN0YXRlID0gd29ya3NwYWNlRWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gaWQpOwogICAgaWYgKGVsSW5TdGF0ZSkgewogICAgICAgIGVsSW5TdGF0ZS54ID0gcGFyc2VGbG9hdChlbGVtZW50LnN0eWxlLmxlZnQpOwogICAgICAgIGVsSW5TdGF0ZS55ID0gcGFyc2VGbG9hdChlbGVtZW50LnN0eWxlLnRvcCk7CiAgICB9CiAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nJyk7CiAgICBkcmFnZ2luZ0luZm8gPSB7IGlkOiBudWxsLCBlbGVtZW50OiBudWxsLCBvZmZzZXRYOiAwLCBvZmZzZXRZOiAwIH07CiAgICBkb2N1bWVudC5vbm1vdXNlbW92ZSA9IG51bGw7CiAgICBkb2N1bWVudC5vbm1vdXNldXAgPSBudWxsOwp9CmZ1bmN0aW9uIHN0YXJ0TmV4dExldmVsKGN1cnJlbnRMZXZlbCkgewogICAgY29uc3QgbmV4dExldmVsID0gY3VycmVudExldmVsICsgMTsKICAgIGNvbnN0IHRpZXJJbmRleCA9IE1hdGgubWluKE1hdGguZmxvb3IoKG5leHRMZXZlbCAtIDEpIC8gMiksIGNoYWxsZW5nZVRpZXJzLmxlbmd0aCAtIDEpOwogICAgY29uc3QgdGllciA9IGNoYWxsZW5nZVRpZXJzW3RpZXJJbmRleF07CiAgICBjb25zdCB0YXJnZXQgPSB0aWVyW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRpZXIubGVuZ3RoKV07CiAgICBjaGFsbGVuZ2VTdGF0ZSA9IHsgbGV2ZWw6IG5leHRMZXZlbCwgdGFyZ2V0LCBzdGFydFRpbWU6IERhdGUubm93KCksIHRpbWVyOiAnMDA6MDAnLCBpc0FjdGl2ZTogdHJ1ZSB9OwogICAgdGltZXJJbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IoKERhdGUubm93KCkgLSBjaGFsbGVuZ2VTdGF0ZS5zdGFydFRpbWUpIC8gMTAwMCk7CiAgICAgICAgY29uc3QgbWlucyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDYwKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3Qgc2VjcyA9IChzZWNvbmRzICUgNjApLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICBjaGFsbGVuZ2VTdGF0ZS50aW1lciA9IGAke21pbnN9OiR7c2Vjc31gOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFsbGVuZ2UtdGltZXInKS50ZXh0Q29udGVudCA9IGNoYWxsZW5nZVN0YXRlLnRpbWVyOwogICAgfSwgMTAwMCk7CiAgICByZXNldFdvcmtzcGFjZSgpOwogICAgdXBkYXRlVUkoKTsKfQpmdW5jdGlvbiBzdGFydEZyZWVQbGF5KCkgewogICAgZ2FtZU1vZGUgPSAnZnJlZSc7CiAgICByZXNldFdvcmtzcGFjZSgpOwogICAgdXBkYXRlVUkoKTsKfQpmdW5jdGlvbiBoYW5kbGVDaGFsbGVuZ2VTdGFydFJlcXVlc3QoKSB7CiAgICBjb25zdCBzYXZlZExldmVsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ0hBTExFTkdFX0xFVkVMX0tFWSk7CiAgICBpZiAoc2F2ZWRMZXZlbCAmJiBwYXJzZUludChzYXZlZExldmVsLCAxMCkgPiAwKSB7CiAgICAgICAgY2hhbGxlbmdlUHJvbXB0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSgpOwogICAgfQp9CmZ1bmN0aW9uIGhhbmRsZUNvbnRpbnVlQ2hhbGxlbmdlKCkgewogICAgY29uc3Qgc2F2ZWRMZXZlbCA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpIHx8ICcwJywgMTApOwogICAgZ2FtZU1vZGUgPSAnY2hhbGxlbmdlJzsKICAgIGRpc2NvdmVyZWRFbGVtZW50cyA9IFsuLi5pbml0aWFsRWxlbWVudHNdOwogICAgc3RhcnROZXh0TGV2ZWwoc2F2ZWRMZXZlbCk7CiAgICBjaGFsbGVuZ2VQcm9tcHQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0KZnVuY3Rpb24gaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSgpIHsKICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpOwogICAgZ2FtZU1vZGUgPSAnY2hhbGxlbmdlJzsKICAgIGRpc2NvdmVyZWRFbGVtZW50cyA9IFsuLi5pbml0aWFsRWxlbWVudHNdOwogICAgc3RhcnROZXh0TGV2ZWwoMCk7CiAgICBjaGFsbGVuZ2VQcm9tcHQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0KZnVuY3Rpb24gaGFuZGxlRW5kR2FtZSgpIHsKICAgIGdhbWVNb2RlID0gJ21lbnUnOwogICAgd29ya3NwYWNlRWxlbWVudHMgPSBbXTsKICAgIGlmIChjaGFsbGVuZ2VTdGF0ZS5pc0FjdGl2ZSkgewogICAgICAgIGNoYWxsZW5nZVN0YXRlLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsKTsKICAgIH0KICAgIHVwZGF0ZVVJKCk7Cn0KZnVuY3Rpb24gZ2V0QXBwU2NyaXB0KCkgewogICAgLy8gVGhpcyBmdW5jdGlvbiB3cmFwcyB0aGUgZW50aXJlIGFwcGxpY2F0aW9uIGxvZ2ljIGluIGEgc3RyaW5nLAogICAgLy8gbWFraW5nIGl0IHBvcnRhYmxlIGZvciB0aGUgb2ZmbGluZSBIVE1MIGZpbGUuCiAgICAvLyBOT1RFOiBBbGwgZnVuY3Rpb25zIGFuZCB2YXJpYWJsZXMgbXVzdCBiZSBzZWxmLWNvbnRhaW5lZCB3aXRoaW4gdGhpcyBmdW5jdGlvbidzIHNjb3BlLgogICAgY29uc3Qgc2NyaXB0ID0gKCkgPT4gewogICAgICAgIC8vIC0tLSBTdGFydCBvZiBFbWJlZGRlZCBBcHAgU2NyaXB0IC0tLQogICAgICAgIGNvbnN0IHsgR29vZ2xlR2VuQUksIFR5cGUgfSA9IHdpbmRvdy5nb29nbGVHZW5haTsKICAgICAgICAvLyAtLS0gRW1iZWRkZWQgU291bmQgTWFuYWdlciAtLS0KICAgICAgICBjb25zdCBTb3VuZE1hbmFnZXIgPSB7IGF1ZGlvQ29udGV4dDogbnVsbCwgaXNJbml0aWFsaXplZDogZmFsc2UsIGluaXQoKSB7IGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQgfHwgdHlwZW9mIHdpbmRvdy5BdWRpb0NvbnRleHQgPT09ICd1bmRlZmluZWQnKQogICAgICAgICAgICAgICAgcmV0dXJuOyB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7CiAgICAgICAgICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJXZWIgQXVkaW8gQVBJIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLiIsIGUpOwogICAgICAgICAgICB9IH0sIHBsYXlTb3VuZCh0eXBlLCBmcmVxdWVuY3ksIGR1cmF0aW9uLCB2b2x1bWUgPSAwLjUpIHsgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgICAgIHJldHVybjsgY29uc3Qgb3NjaWxsYXRvciA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZU9zY2lsbGF0b3IoKTsgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7IG9zY2lsbGF0b3IuY29ubmVjdChnYWluTm9kZSk7IGdhaW5Ob2RlLmNvbm5lY3QodGhpcy5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pOyBvc2NpbGxhdG9yLnR5cGUgPSB0eXBlOyBvc2NpbGxhdG9yLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShmcmVxdWVuY3ksIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lKTsgZ2Fpbk5vZGUuZ2Fpbi5zZXRWYWx1ZUF0VGltZSh2b2x1bWUsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lKTsgZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDAwMSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7IG9zY2lsbGF0b3Iuc3RhcnQodGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUpOyBvc2NpbGxhdG9yLnN0b3AodGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7IH0sIHBsYXlDbGljaygpIHsgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgICAgICB0aGlzLmluaXQoKTsgaWYgKCF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgICAgIHJldHVybjsgdGhpcy5wbGF5U291bmQoJ3RyaWFuZ2xlJywgNTAwLCAwLjEsIDAuMyk7IHRoaXMucGxheVNvdW5kKCd0cmlhbmdsZScsIDgwMCwgMC4xLCAwLjMpOyB9LCBwbGF5VGFiKCkgeyBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgICAgIHJldHVybjsgdGhpcy5wbGF5U291bmQoJ3NpbmUnLCA3MDAsIDAuMDgsIDAuMik7IH0sIHBsYXlDb21iaW5lKCkgeyBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkKICAgICAgICAgICAgICAgIHJldHVybjsgdGhpcy5wbGF5U291bmQoJ3Nhd3Rvb3RoJywgMjAwLCAwLjIsIDAuNCk7IHRoaXMucGxheVNvdW5kKCdzYXd0b290aCcsIDEwMCwgMC4zLCAwLjQpOyB9LCBwbGF5RGlzY292ZXIoKSB7IGlmICghdGhpcy5pc0luaXRpYWxpemVkIHx8ICF0aGlzLmF1ZGlvQ29udGV4dCkKICAgICAgICAgICAgICAgIHJldHVybjsgc2V0VGltZW91dCgoKSA9PiB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDUyMy4yNSwgMC4xLCAwLjQpLCAwKTsgc2V0VGltZW91dCgoKSA9PiB0aGlzLnBsYXlTb3VuZCgnc2luZScsIDY1OS4yNSwgMC4xLCAwLjQpLCAxMDApOyBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGxheVNvdW5kKCdzaW5lJywgNzgzLjk5LCAwLjEsIDAuNCksIDIwMCk7IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5wbGF5U291bmQoJ3NpbmUnLCAxMDQ2LjUwLCAwLjIsIDAuNSksIDMwMCk7IH0sIHBsYXlFcnJvcigpIHsgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpCiAgICAgICAgICAgICAgICByZXR1cm47IHRoaXMucGxheVNvdW5kKCdzcXVhcmUnLCAxNTAsIDAuMiwgMC4zKTsgfSB9OwogICAgICAgIGNvbnN0IHByZW1hZGVDb21iaW5hdGlvbnMgPSB7CiAgICAgICAgICAgICdBaXJfRWFydGgnOiB7IG5hbWU6ICdEdXN0JywgZW1vamk6ICfwn4ys77iPJyB9LCAnQWlyX0ZpcmUnOiB7IG5hbWU6ICdTbW9rZScsIGVtb2ppOiAn8J+Mq++4jycgfSwgJ0Fpcl9XYXRlcic6IHsgbmFtZTogJ1JhaW4nLCBlbW9qaTogJ/CfjKfvuI8nIH0sICdFYXJ0aF9GaXJlJzogeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfSwgJ0VhcnRoX1dhdGVyJzogeyBuYW1lOiAnUGxhbnQnLCBlbW9qaTogJ/CfjLEnIH0sICdGaXJlX1dhdGVyJzogeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwgJ0R1c3RfRmlyZSc6IHsgbmFtZTogJ0d1bnBvd2RlcicsIGVtb2ppOiAn8J+SoycgfSwgJ0R1c3RfV2F0ZXInOiB7IG5hbWU6ICdNdWQnLCBlbW9qaTogJ/CfkqknIH0sICdFYXJ0aF9MYXZhJzogeyBuYW1lOiAnVm9sY2FubycsIGVtb2ppOiAn8J+MiycgfSwgJ0xhdmFfV2F0ZXInOiB7IG5hbWU6ICdTdG9uZScsIGVtb2ppOiAn8J+qqCcgfSwgJ0xhdmFfQWlyJzogeyBuYW1lOiAnT2JzaWRpYW4nLCBlbW9qaTogJ/CflqQnIH0sICdQbGFudF9GaXJlJzogeyBuYW1lOiAnQXNoJywgZW1vamk6ICfimqsnIH0sICdQbGFudF9TbW9rZSc6IHsgbmFtZTogJ1RvYmFjY28nLCBlbW9qaTogJ/CfmqwnIH0sICdQbGFudF9TdG9uZSc6IHsgbmFtZTogJ0Zvc3NpbCcsIGVtb2ppOiAn8J+mtCcgfSwgJ1BsYW50X1dhdGVyJzogeyBuYW1lOiAnU3dhbXAnLCBlbW9qaTogJ/CfkIonIH0sICdQbGFudF9BaXInOiB7IG5hbWU6ICdQb2xsZW4nLCBlbW9qaTogJ/CfjLwnIH0sICdQbGFudF9FYXJ0aCc6IHsgbmFtZTogJ0dyYXNzJywgZW1vamk6ICfwn4y+JyB9LCAnUmFpbl9FYXJ0aCc6IHsgbmFtZTogJ011ZCcsIGVtb2ppOiAn8J+SqScgfSwgJ1JhaW5fRmlyZSc6IHsgbmFtZTogJ1JhaW5ib3cnLCBlbW9qaTogJ/CfjIgnIH0sICdTdGVhbV9BaXInOiB7IG5hbWU6ICdDbG91ZCcsIGVtb2ppOiAn4piB77iPJyB9LCAnU3RlYW1fRWFydGgnOiB7IG5hbWU6ICdHZXlzZXInLCBlbW9qaTogJ+KZqO+4jycgfSwgJ1Ntb2tlX1dhdGVyJzogeyBuYW1lOiAnRm9nJywgZW1vamk6ICfwn4yr77iPJyB9LCAnQXNoX1N0b25lJzogeyBuYW1lOiAnU3RhdHVlJywgZW1vamk6ICfwn5e/JyB9LCAnQ2xvdWRfRmlyZSc6IHsgbmFtZTogJ0xpZ2h0bmluZycsIGVtb2ppOiAn4pqhJyB9LCAnQ2xvdWRfV2F0ZXInOiB7IG5hbWU6ICdSYWluJywgZW1vamk6ICfwn4yn77iPJyB9LCAnR3Jhc3NfR3Jhc3MnOiB7IG5hbWU6ICdMYXduJywgZW1vamk6ICfwn4+hJyB9LCAnR3Jhc3NfRWFydGgnOiB7IG5hbWU6ICdGaWVsZCcsIGVtb2ppOiAn8J+Pnu+4jycgfSwgJ0xpZ2h0bmluZ19NZXRhbCc6IHsgbmFtZTogJ0VsZWN0cmljaXR5JywgZW1vamk6ICfwn5KhJyB9LCAnTGlnaHRuaW5nX0VhcnRoJzogeyBuYW1lOiAnQ3J5c3RhbCcsIGVtb2ppOiAn8J+SjicgfSwgJ011ZF9GaXJlJzogeyBuYW1lOiAnQnJpY2snLCBlbW9qaTogJ/Cfp7EnIH0sICdTdG9uZV9GaXJlJzogeyBuYW1lOiAnTWV0YWwnLCBlbW9qaTogJ/CflKknIH0sICdTdG9uZV9XYXRlcic6IHsgbmFtZTogJ1NhbmQnLCBlbW9qaTogJ/Cfj5bvuI8nIH0sICdTdG9uZV9BaXInOiB7IG5hbWU6ICdTYW5kc3Rvcm0nLCBlbW9qaTogJ/CfjKrvuI8nIH0sICdCcmlja19Ccmljayc6IHsgbmFtZTogJ1dhbGwnLCBlbW9qaTogJ/Cfp7EnIH0sICdFbGVjdHJpY2l0eV9HbGFzcyc6IHsgbmFtZTogJ0xpZ2h0IEJ1bGInLCBlbW9qaTogJ/CfkqEnIH0sICdNZXRhbF9XYXRlcic6IHsgbmFtZTogJ1J1c3QnLCBlbW9qaTogJ/CflKknIH0sICdTYW5kX0ZpcmUnOiB7IG5hbWU6ICdHbGFzcycsIGVtb2ppOiAn8J+lgycgfSwgJ1dhbGxfV2FsbCc6IHsgbmFtZTogJ0hvdXNlJywgZW1vamk6ICfwn4+gJyB9LCAnRWFydGhfRWFydGgnOiB7IG5hbWU6ICdMYW5kJywgZW1vamk6ICfwn4+e77iPJyB9LCAnV2F0ZXJfV2F0ZXInOiB7IG5hbWU6ICdTZWEnLCBlbW9qaTogJ/CfjIonIH0sICdTZWFfU2VhJzogeyBuYW1lOiAnT2NlYW4nLCBlbW9qaTogJ/CfjIonIH0sICdPY2Vhbl9FYXJ0aCc6IHsgbmFtZTogJ0lzbGFuZCcsIGVtb2ppOiAn8J+Pne+4jycgfSwgJ1BsYW50X1BsYW50JzogeyBuYW1lOiAnR2FyZGVuJywgZW1vamk6ICfwn6q0JyB9LCAnR2FyZGVuX1BsYW50JzogeyBuYW1lOiAnRm9yZXN0JywgZW1vamk6ICfwn4yzJyB9LCAnRm9yZXN0X0ZpcmUnOiB7IG5hbWU6ICdXaWxkZmlyZScsIGVtb2ppOiAn8J+UpScgfSwgJ1N0b25lX1N0b25lJzogeyBuYW1lOiAnTW91bnRhaW4nLCBlbW9qaTogJ+KbsO+4jycgfSwgJ01vdW50YWluX0xhdmEnOiB7IG5hbWU6ICdFcnVwdGlvbicsIGVtb2ppOiAn8J+MiycgfSwgJ0VhcnRoX0xpZmUnOiB7IG5hbWU6ICdIdW1hbicsIGVtb2ppOiAn8J+njScgfSwgJ0ZpcmVfTGlmZSc6IHsgbmFtZTogJ1Bob2VuaXgnLCBlbW9qaTogJ/CfkKbigI3wn5SlJyB9LCAnSHVtYW5fUGxhbnQnOiB7IG5hbWU6ICdGYXJtZXInLCBlbW9qaTogJ/CfkajigI3wn4y+JyB9LCAnSHVtYW5fU3RvbmUnOiB7IG5hbWU6ICdUb29sJywgZW1vamk6ICfwn5SnJyB9LCAnSHVtYW5fRmlyZSc6IHsgbmFtZTogJ0Nvb2snLCBlbW9qaTogJ/CfkajigI3wn42zJyB9LCAnSHVtYW5fV2F0ZXInOiB7IG5hbWU6ICdTYWlsb3InLCBlbW9qaTogJ/CfkajigI3inIjvuI8nIH0sICdIdW1hbl9IdW1hbic6IHsgbmFtZTogJ0xvdmUnLCBlbW9qaTogJ+KdpO+4jycgfSwgJ0h1bWFuX0hvdXNlJzogeyBuYW1lOiAnRmFtaWx5JywgZW1vamk6ICfwn5Go4oCN8J+RqeKAjfCfkafigI3wn5GmJyB9LCAnRmFybWVyX0ZpZWxkJzogeyBuYW1lOiAnV2hlYXQnLCBlbW9qaTogJ/CfjL4nIH0sICdUb29sX0ZvcmVzdCc6IHsgbmFtZTogJ1dvb2QnLCBlbW9qaTogJ/CfqrUnIH0sICdUb29sX1dvb2QnOiB7IG5hbWU6ICdXaGVlbCcsIGVtb2ppOiAn8J+bnicgfSwgJ1doZWF0X1N0b25lJzogeyBuYW1lOiAnRmxvdXInLCBlbW9qaTogJ+KaqicgfSwgJ0Zsb3VyX1dhdGVyJzogeyBuYW1lOiAnRG91Z2gnLCBlbW9qaTogJ/CfjaonIH0sICdEb3VnaF9GaXJlJzogeyBuYW1lOiAnQnJlYWQnLCBlbW9qaTogJ/CfjZ4nIH0sCiAgICAgICAgfTsKICAgICAgICBjb25zdCByZXNwb25zZVNjaGVtYSA9IHsgdHlwZTogVHlwZS5PQkpFQ1QsIHByb3BlcnRpZXM6IHsgbmFtZTogeyB0eXBlOiBUeXBlLlNUUklORywgZGVzY3JpcHRpb246ICJUaGUgbmFtZSBvZiB0aGUgcmVzdWx0aW5nIGVsZW1lbnQuIFNob3VsZCBiZSBzaW1wbGUsIG9uZSBvciB0d28gd29yZHMuIElmIHRoZSBjb21iaW5hdGlvbiBpcyBub25zZW5zaWNhbCBvciByZXN1bHRzIGluIHRoZSBzYW1lIGVsZW1lbnQsIHVzZSAnTm90aGluZycgb3IgdGhlIG9yaWdpbmFsIGVsZW1lbnQncyBuYW1lLiIgfSwgZW1vamk6IHsgdHlwZTogVHlwZS5TVFJJTkcsIGRlc2NyaXB0aW9uOiAiQSBzaW5nbGUsIHJlbGV2YW50IGVtb2ppIGZvciB0aGUgcmVzdWx0aW5nIGVsZW1lbnQuIFVzZSAn8J+ktycgZm9yIG5vbnNlbnNpY2FsIGNvbWJpbmF0aW9ucy4iIH0sIGlzTmV3RGlzY292ZXJ5OiB7IHR5cGU6IFR5cGUuQk9PTEVBTiwgZGVzY3JpcHRpb246ICJTZXQgdG8gdHJ1ZSBpZiB0aGUgY29tYmluYXRpb24gY3JlYXRlcyBhIGdlbnVpbmVseSBuZXcgYW5kIGRpc3RpbmN0IGVsZW1lbnQuIFNldCB0byBmYWxzZSBpZiBpdCByZXN1bHRzIGluICdOb3RoaW5nJywgb25lIG9mIHRoZSBvcmlnaW5hbCBlbGVtZW50cywgb3Igc29tZXRoaW5nIHRyaXZpYWwuIiB9LCBjb21tZW50YXJ5OiB7IHR5cGU6IFR5cGUuU1RSSU5HLCBkZXNjcmlwdGlvbjogIkEgcXVpcmt5LCBzaG9ydCwgZmlyc3QtcGVyc29uIGNvbW1lbnQgZnJvbSB0aGUgcGVyc3BlY3RpdmUgb2YgdGhlIG5ldyBlbGVtZW50LiBNYXggMTUgd29yZHMuIiB9IH0sIHJlcXVpcmVkOiBbIm5hbWUiLCAiZW1vamkiLCAiaXNOZXdEaXNjb3ZlcnkiLCAiY29tbWVudGFyeSJdIH07CiAgICAgICAgY29uc3QgaW5pdGlhbEVsZW1lbnRzID0gW3sgbmFtZTogJ1dhdGVyJywgZW1vamk6ICfwn5KnJyB9LCB7IG5hbWU6ICdGaXJlJywgZW1vamk6ICfwn5SlJyB9LCB7IG5hbWU6ICdFYXJ0aCcsIGVtb2ppOiAn8J+MjScgfSwgeyBuYW1lOiAnQWlyJywgZW1vamk6ICfwn5KoJyB9XTsKICAgICAgICBjb25zdCBjaGFsbGVuZ2VUaWVycyA9IFtbeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwgeyBuYW1lOiAnRHVzdCcsIGVtb2ppOiAn8J+MrO+4jycgfSwgeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwgeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfV0sIFt7IG5hbWU6ICdTdG9uZScsIGVtb2ppOiAn8J+qqCcgfSwgeyBuYW1lOiAnUGxhbnQnLCBlbW9qaTogJ/CfjLEnIH0sIHsgbmFtZTogJ1Ntb2tlJywgZW1vamk6ICfwn4yr77iPJyB9LCB7IG5hbWU6ICdPYnNpZGlhbicsIGVtb2ppOiAn8J+WpCcgfV0sIFt7IG5hbWU6ICdNdWQnLCBlbW9qaTogJ/CfkqknIH0sIHsgbmFtZTogJ0JyaWNrJywgZW1vamk6ICfwn6exJyB9LCB7IG5hbWU6ICdHcmFzcycsIGVtb2ppOiAn8J+MvicgfSwgeyBuYW1lOiAnU2FuZCcsIGVtb2ppOiAn8J+Plu+4jycgfV0sIFt7IG5hbWU6ICdNZXRhbCcsIGVtb2ppOiAn8J+UqScgfSwgeyBuYW1lOiAnR2xhc3MnLCBlbW9qaTogJ/CfpYMnIH0sIHsgbmFtZTogJ1dhbGwnLCBlbW9qaTogJ/Cfp7EnIH0sIHsgbmFtZTogJ0xpZ2h0bmluZycsIGVtb2ppOiAn4pqhJyB9XSwgW3sgbmFtZTogJ0hvdXNlJywgZW1vamk6ICfwn4+gJyB9LCB7IG5hbWU6ICdFbGVjdHJpY2l0eScsIGVtb2ppOiAn8J+SoScgfSwgeyBuYW1lOiAnSHVtYW4nLCBlbW9qaTogJ/Cfp40nIH0sIHsgbmFtZTogJ1Bob2VuaXgnLCBlbW9qaTogJ/CfkKbigI3wn5SlJyB9XV07CiAgICAgICAgY29uc3QgRElTQ09WRVJFRF9FTEVNRU5UU19LRVkgPSAnZ2VuY3JhZnRfZGlzY292ZXJlZEVsZW1lbnRzJzsKICAgICAgICBjb25zdCBDSEFMTEVOR0VfTEVWRUxfS0VZID0gJ2dlbmNyYWZ0X2NoYWxsZW5nZUxldmVsJzsKICAgICAgICBsZXQgZ2FtZU1vZGUgPSAnbWVudScsIHdvcmtzcGFjZUVsZW1lbnRzID0gW10sIGRpc2NvdmVyZWRFbGVtZW50cyA9IFsuLi5pbml0aWFsRWxlbWVudHNdLCBjaGFsbGVuZ2VTdGF0ZSA9IHsgbGV2ZWw6IDAsIHRhcmdldDogbnVsbCwgc3RhcnRUaW1lOiAwLCB0aW1lcjogJzAwOjAwJywgaXNBY3RpdmU6IGZhbHNlIH07CiAgICAgICAgbGV0IG5leHRJZCA9IDAsIHRpbWVySW50ZXJ2YWwsIGRyYWdnaW5nSW5mbyA9IHsgaWQ6IG51bGwsIGVsZW1lbnQ6IG51bGwsIG9mZnNldFg6IDAsIG9mZnNldFk6IDAgfTsKICAgICAgICBsZXQgZW5kR2FtZUJ0bkRlZmF1bHRDb250ZW50ID0gbnVsbDsKICAgICAgICBjb25zdCBhaSA9IG5ldyBHb29nbGVHZW5BSSh7IGFwaUtleTogJyUlQVBJX0tFWSUlJyB9KTsKICAgICAgICBhc3luYyBmdW5jdGlvbiBnZXRDb21iaW5hdGlvbihlbGVtZW50MSwgZWxlbWVudDIpIHsKICAgICAgICAgICAgY29uc3Qga2V5ID0gW2VsZW1lbnQxLm5hbWUsIGVsZW1lbnQyLm5hbWVdLnNvcnQoKS5qb2luKCdfJyk7CiAgICAgICAgICAgIGlmIChwcmVtYWRlQ29tYmluYXRpb25zW2tleV0pCiAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wcmVtYWRlQ29tYmluYXRpb25zW2tleV0sIGlzTmV3OiB0cnVlLCBjb21tZW50YXJ5OiAnQSBjbGFzc2ljIGNvbWJpbmF0aW9uIScgfTsKICAgICAgICAgICAgaWYgKGVsZW1lbnQxLm5hbWUgPT09IGVsZW1lbnQyLm5hbWUpCiAgICAgICAgICAgICAgICByZXR1cm4geyBuYW1lOiBlbGVtZW50MS5uYW1lLCBlbW9qaTogZWxlbWVudDEuZW1vamksIGlzTmV3OiBmYWxzZSwgY29tbWVudGFyeTogJ1R3byBvZiB0aGUgc2FtZSBtYWtlIG5vIGNoYW5nZS4nIH07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9tcHQgPSBgWW91IGFyZSBhbiBBSSBmb3IgYSBjcmVhdGl2ZSBhbGNoZW15IGdhbWUuIFdoYXQgaXMgY3JlYXRlZCB3aGVuIHlvdSBjb21iaW5lICIke2VsZW1lbnQxLm5hbWV9ICR7ZWxlbWVudDEuZW1vaml9IiBhbmQgIiR7ZWxlbWVudDIubmFtZX0gJHtlbGVtZW50Mi5lbW9qaX0iP1xuLSBJZiBpdCBjcmVhdGVzIGEgbmV3LCBsb2dpY2FsIGl0ZW0sIHByb3ZpZGUgaXRzIG5hbWUsIGVtb2ppLCBhbmQgYSBmdW4gY29tbWVudGFyeSBmcm9tIGl0cyBwZXJzcGVjdGl2ZS5cbi0gSWYgdGhlIGNvbWJpbmF0aW9uIGlzIGlsbG9naWNhbCwgaW1wb3NzaWJsZSwgb3IganVzdCBtYWtlcyBtb3JlIG9mIG9uZSBvZiB0aGUgaW5wdXRzIChlLmcuLCBGaXJlICsgRmlyZSksIHJlc3BvbmQgd2l0aCBhIHJlc3VsdCB3aGVyZSBpc05ld0Rpc2NvdmVyeSBpcyBmYWxzZS5cbi0gS2VlcCB0aGUgbmFtZXMgc2ltcGxlICgxLTMgd29yZHMpLiAtIEJlIGNyZWF0aXZlIGFuZCBjb25zaXN0ZW50LmA7CiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFpLm1vZGVscy5nZW5lcmF0ZUNvbnRlbnQoeyBtb2RlbDogJ2dlbWluaS0yLjUtZmxhc2gnLCBjb250ZW50czogcHJvbXB0LCBjb25maWc6IHsgcmVzcG9uc2VNaW1lVHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLCByZXNwb25zZVNjaGVtYSwgdGVtcGVyYXR1cmU6IDAuOCB9IH0pOwogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS50ZXh0LnRyaW0oKSk7CiAgICAgICAgICAgICAgICByZXR1cm4geyBuYW1lOiByZXN1bHQubmFtZSwgZW1vamk6IHJlc3VsdC5lbW9qaSwgaXNOZXc6IHJlc3VsdC5pc05ld0Rpc2NvdmVyeSwgY29tbWVudGFyeTogcmVzdWx0LmNvbW1lbnRhcnkgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGNhbGxpbmcgR2VtaW5pIEFQSToiLCBlcnJvcik7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzYXZlUHJvZ3Jlc3MoKSB7IGlmIChnYW1lTW9kZSA9PT0gJ2ZyZWUnKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oRElTQ09WRVJFRF9FTEVNRU5UU19LRVksIEpTT04uc3RyaW5naWZ5KGRpc2NvdmVyZWRFbGVtZW50cykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gc2F2ZSBwcm9ncmVzczoiLCBlKTsKICAgICAgICAgICAgfSB9CiAgICAgICAgZnVuY3Rpb24gbG9hZFByb2dyZXNzKCkgewogICAgICAgICAgICBjb25zdCBzYXZlZERpc2NvdmVyaWVzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oRElTQ09WRVJFRF9FTEVNRU5UU19LRVkpOwogICAgICAgICAgICBpZiAoc2F2ZWREaXNjb3ZlcmllcykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHNhdmVkRGlzY292ZXJpZXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcnNlZCkgJiYgcGFyc2VkLmxlbmd0aCA+PSBpbml0aWFsRWxlbWVudHMubGVuZ3RoICYmIHBhcnNlZFswXS5uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkRWxlbWVudHMgPSBwYXJzZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBwYXJzZSBzYXZlZCBkaXNjb3ZlcmllczoiLCBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NwYWNlJyksIGdhbWVNZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUtbWVudScpLCBjaGFsbGVuZ2VQcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXByb21wdCcpLCBjaGFsbGVuZ2VIVUQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLWh1ZCcpLCBlbmRHYW1lQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuZC1nYW1lLWJ0bicpLCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyksIGFpUG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWktcG9wdXAnKSwgZGlzY292ZXJ5Q291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzY292ZXJ5LWNvdW50JyksIGVsZW1lbnRzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbGVtZW50cy1saXN0JyksIHJlY2lwZXNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtbGlzdCcpLCBzZWFyY2hJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gtaW5wdXQnKSwgdGFiRWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLWVsZW1lbnRzJyksIHRhYlJlY2lwZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLXJlY2lwZXMnKSwgZWxlbWVudHNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VsZW1lbnRzLWVtcHR5LXN0YXRlJyksIHJlY2lwZXNFbXB0eVN0YXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXMtZW1wdHktc3RhdGUnKSwgY2xlYXJTZWFyY2hCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItc2VhcmNoLWJ0bicpLCBpbnRyb092ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW50cm8tb3ZlcmxheScpOwogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVVJKCkgewogICAgICAgICAgICBnYW1lTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBnYW1lTW9kZSAhPT0gJ21lbnUnKTsKICAgICAgICAgICAgY2hhbGxlbmdlSFVELmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsIGdhbWVNb2RlICE9PSAnY2hhbGxlbmdlJyB8fCAhY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUpOwogICAgICAgICAgICBlbmRHYW1lQnRuLmRpc2FibGVkID0gZ2FtZU1vZGUgPT09ICdtZW51JzsKICAgICAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJykgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYWxsZW5nZS1sZXZlbCcpLnRleHRDb250ZW50ID0gY2hhbGxlbmdlU3RhdGUubGV2ZWwudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFsbGVuZ2UtdGFyZ2V0JykudGV4dENvbnRlbnQgPSBjaGFsbGVuZ2VTdGF0ZS50YXJnZXQ/Lm5hbWUgfHwgJy4uLic7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbGxlbmdlLXRpbWVyJykudGV4dENvbnRlbnQgPSBjaGFsbGVuZ2VTdGF0ZS50aW1lcjsKICAgICAgICAgICAgICAgIGVuZEdhbWVCdG4uaW5uZXJIVE1MID0gJzxzcGFuIGNsYXNzPSJmb250LWJvbGQgcHgtMiI+UVVJVDwvc3Bhbj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCkgewogICAgICAgICAgICAgICAgICAgIGVuZEdhbWVCdG4uaW5uZXJIVE1MID0gZW5kR2FtZUJ0bkRlZmF1bHRDb250ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbmRlclNpZGViYXIoKTsKICAgICAgICAgICAgcmVuZGVyV29ya3NwYWNlKCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlbmRlcldvcmtzcGFjZSgpIHsKICAgICAgICAgICAgd29ya3NwYWNlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5lbGVtZW50LWNhcmQnKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgICAgICAgICAgd29ya3NwYWNlRWxlbWVudHMuZm9yRWFjaChlbCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBjYXJkLmNsYXNzTmFtZSA9ICdlbGVtZW50LWNhcmQnOwogICAgICAgICAgICAgICAgY2FyZC5kYXRhc2V0LmlkID0gU3RyaW5nKGVsLmlkKTsKICAgICAgICAgICAgICAgIGNhcmQuc3R5bGUubGVmdCA9IGAke2VsLnh9cHhgOwogICAgICAgICAgICAgICAgY2FyZC5zdHlsZS50b3AgPSBgJHtlbC55fXB4YDsKICAgICAgICAgICAgICAgIGNhcmQuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9InRleHQtNHhsIG1yLTMgcG9pbnRlci1ldmVudHMtbm9uZSI+JHtlbC5lbW9qaX08L2Rpdj48ZGl2IGNsYXNzPSJ0ZXh0LWxnIGZvbnQtYm9sZCBmb250LW9yYml0cm9uIHBvaW50ZXItZXZlbnRzLW5vbmUgdHJ1bmNhdGUiPiR7ZWwubmFtZX08L2Rpdj5gOwogICAgICAgICAgICAgICAgaWYgKGVsLmlzTmV3KSB7CiAgICAgICAgICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCduZXcnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnbmV3JyksIDUwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiBoYW5kbGVNb3VzZURvd24oZSwgZWwuaWQpKTsKICAgICAgICAgICAgICAgIHdvcmtzcGFjZS5hcHBlbmRDaGlsZChjYXJkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlbmRlclNpZGViYXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHRlcm0gPSBzZWFyY2hJbnB1dC52YWx1ZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBkaXNjb3ZlcnlDb3VudC50ZXh0Q29udGVudCA9IGAke2Rpc2NvdmVyZWRFbGVtZW50cy5sZW5ndGh9IGZvdW5kYDsKICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRFbGVtZW50cyA9IGRpc2NvdmVyZWRFbGVtZW50cy5maWx0ZXIoZWwgPT4gZWwubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pKS5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTsKICAgICAgICAgICAgZWxlbWVudHNMaXN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBpZiAoZmlsdGVyZWRFbGVtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJlZEVsZW1lbnRzLmZvckVhY2goZWwgPT4geyBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsgYnRuLmNsYXNzTmFtZSA9ICJmbGV4IGl0ZW1zLWNlbnRlciBwLTIgYmctZ3JheS04MDAvNTAgcm91bmRlZC1sZyBob3ZlcjpiZy1jeWFuLTUwMC8yMCBib3JkZXIgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1jeWFuLTUwMCB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSI7IGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9InRleHQtMnhsIG1yLTIiPiR7ZWwuZW1vaml9PC9zcGFuPjxzcGFuIGNsYXNzPSJ0ZXh0LXdoaXRlIHRleHQtc20gdHJ1bmNhdGUiPiR7ZWwubmFtZX08L3NwYW4+YDsgYnRuLm9uY2xpY2sgPSAoKSA9PiBzcGF3bkVsZW1lbnQoZWwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmYWxzZSk7IGVsZW1lbnRzTGlzdC5hcHBlbmRDaGlsZChidG4pOyB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbGVtZW50c0VtcHR5U3RhdGUuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgZmlsdGVyZWRFbGVtZW50cy5sZW5ndGggPiAwKTsKICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRSZWNpcGVzID0gZGlzY292ZXJlZEVsZW1lbnRzLmZpbHRlcihlbCA9PiBlbC5yZWNpcGUgJiYgKGVsLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fCBlbC5yZWNpcGUuZWxlbWVudDEudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fCBlbC5yZWNpcGUuZWxlbWVudDIudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSkpLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpOwogICAgICAgICAgICByZWNpcGVzTGlzdC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgaWYgKGZpbHRlcmVkUmVjaXBlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJlZFJlY2lwZXMuZm9yRWFjaChlbCA9PiB7IGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyBkaXYuY2xhc3NOYW1lID0gInAtMiBiZy1ncmF5LTgwMC81MCByb3VuZGVkLWxnIHRleHQtc20gdGV4dC1jZW50ZXIiOyBkaXYuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7ZWwucmVjaXBlLmVsZW1lbnQxfTwvc3Bhbj4gKyA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIj4ke2VsLnJlY2lwZS5lbGVtZW50Mn08L3NwYW4+IOKGkiA8c3BhbiBjbGFzcz0idGV4dC1jeWFuLTMwMCBmb250LWJvbGQiPiR7ZWwubmFtZX0gJHtlbC5lbW9qaX08L3NwYW4+YDsgcmVjaXBlc0xpc3QuYXBwZW5kQ2hpbGQoZGl2KTsgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVjaXBlc0VtcHR5U3RhdGUuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgZmlsdGVyZWRSZWNpcGVzLmxlbmd0aCA+IDApOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzaG93TG9hZGVyKHNob3cpIHsgbG9hZGVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFzaG93KTsgfQogICAgICAgIGZ1bmN0aW9uIHNob3dBSVBvcHVwKHsgdHlwZSwgdGl0bGUsIHRleHQsIGNvbW1lbnRhcnkgfSkgewogICAgICAgICAgICBjb25zdCB0aGVtZXMgPSB7IHN1Y2Nlc3M6IHsgYmc6ICdiZy1ncmVlbi05MDAvODAnLCBib3JkZXI6ICdib3JkZXItZ3JlZW4tNDAwJywgaWNvbjogJ3RleHQtZ3JlZW4tMzAwJyB9LCBlcnJvcjogeyBiZzogJ2JnLXJlZC05MDAvODAnLCBib3JkZXI6ICdib3JkZXItcmVkLTQwMCcsIGljb246ICd0ZXh0LXJlZC0zMDAnIH0sIGluZm86IHsgYmc6ICdiZy1ibHVlLTkwMC84MCcsIGJvcmRlcjogJ2JvcmRlci1ibHVlLTQwMCcsIGljb246ICd0ZXh0LWJsdWUtMzAwJyB9IH07CiAgICAgICAgICAgIGNvbnN0IHRoZW1lID0gdGhlbWVzW3R5cGVdOwogICAgICAgICAgICBhaVBvcHVwLmNsYXNzTmFtZSA9IGBmaXhlZCB0b3AtNSBsZWZ0LTEvMiAtdHJhbnNsYXRlLXgtMS8yIHctZnVsbCBtYXgtdy1zbSBwLTQgcm91bmRlZC1sZyBzaGFkb3ctMnhsIGJvcmRlci0yIGJhY2tkcm9wLWJsdXItbWQgei01MCBhbmltYXRlLWZhZGUtaW4tZG93biAke3RoZW1lLmJnfSAke3RoZW1lLmJvcmRlcn1gOwogICAgICAgICAgICBsZXQgY29tbWVudGFyeUh0bWwgPSBjb21tZW50YXJ5ID8gYDxwIGNsYXNzPSJtdC0yIHRleHQtc20gaXRhbGljIGJvcmRlci1sLTIgcGwtMiAke3RoZW1lLmJvcmRlcn0gJHt0aGVtZS5pY29ufSI+JHtjb21tZW50YXJ5fTwvcD5gIDogJyc7CiAgICAgICAgICAgIGFpUG9wdXAuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtc3RhcnQiPjxkaXYgY2xhc3M9ImZsZXgtc2hyaW5rLTAiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBjbGFzcz0iaC02IHctNiAke3RoZW1lLmljb259IiBmaWxsPSJub25lIiB2aWV3Qm94PSIwIDAgMjQgMjQiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiPjxwYXRoIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTUgM3Y0TTMgNWg0TTYgMTd2NG0tMi0yaDRtNS0xNmwyLjI4NiA2Ljg1N0wyMSAxMmwtNS43MTQgMi4xNDNMMTMgMjFsLTIuMjg2LTYuODU3TDUgMTJsNS43MTQtMi4xNDNMMTMgM3oiIC8+PC9zdmc+PC9kaXY+PGRpdiBjbGFzcz0ibWwtMyB3LTAgZmxleC0xIj48cCBjbGFzcz0idGV4dC1sZyBmb250LWJvbGQgZm9udC1vcmJpdHJvbiB0ZXh0LXdoaXRlIj4ke3RpdGxlfTwvcD48cCBjbGFzcz0ibXQtMSB0ZXh0LXNtICR7dHlwZSA9PT0gJ3N1Y2Nlc3MnID8gJ3RleHQtZ3JlZW4tMjAwJyA6IHR5cGUgPT09ICdlcnJvcicgPyAndGV4dC1yZWQtMjAwJyA6ICd0ZXh0LWJsdWUtMjAwJ30iPiR7dGV4dH08L3A+JHtjb21tZW50YXJ5SHRtbH08L2Rpdj48ZGl2IGNsYXNzPSJtbC00IGZsZXgtc2hyaW5rLTAgZmxleCI+PGJ1dHRvbiBpZD0iY2xvc2UtcG9wdXAtYnRuIiBjbGFzcz0iaW5saW5lLWZsZXggcm91bmRlZC1tZCB0ZXh0LWdyYXktMzAwIGhvdmVyOnRleHQtd2hpdGUiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBjbGFzcz0iaC01IHctNSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIj48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik02IDE4TDE4IDZNNiA2bDEyIDEyIiAvPjwvc3ZnPjwvYnV0dG9uPjwvZGl2PjwvZGl2PmA7CiAgICAgICAgICAgIGFpUG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1wb3B1cC1idG4nKS5vbmNsaWNrID0gKCkgPT4gYWlQb3B1cC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBhaVBvcHVwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpLCA2MDAwKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlUGFydGljbGVCdXJzdCh4LCB5KSB7IGNvbnN0IGJ1cnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IGJ1cnN0LmNsYXNzTmFtZSA9ICdwYXJ0aWNsZS1idXJzdCc7IGJ1cnN0LnN0eWxlLmxlZnQgPSBgJHt4ICsgODB9cHhgOyBidXJzdC5zdHlsZS50b3AgPSBgJHt5ICsgNDh9cHhgOyBmb3IgKGxldCBpID0gMDsgaSA8IDEyOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgcGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgcGFydGljbGUuY2xhc3NOYW1lID0gJ3BhcnRpY2xlJzsKICAgICAgICAgICAgcGFydGljbGUuc3R5bGUuc2V0UHJvcGVydHkoJy0taScsIFN0cmluZyhpKSk7CiAgICAgICAgICAgIGJ1cnN0LmFwcGVuZENoaWxkKHBhcnRpY2xlKTsKICAgICAgICB9IHdvcmtzcGFjZS5hcHBlbmRDaGlsZChidXJzdCk7IHNldFRpbWVvdXQoKCkgPT4gYnVyc3QucmVtb3ZlKCksIDYwMCk7IH0KICAgICAgICBmdW5jdGlvbiBzcGF3bkVsZW1lbnQoZWxlbWVudCwgeCwgeSwgaXNOZXcgPSB0cnVlKSB7IGNvbnN0IGJvdW5kcyA9IHdvcmtzcGFjZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgY29uc3QgbmV3WCA9IHggPz8gTWF0aC5yYW5kb20oKSAqIChib3VuZHMud2lkdGggLSAyMDApICsgMjA7IGNvbnN0IG5ld1kgPSB5ID8/IE1hdGgucmFuZG9tKCkgKiAoYm91bmRzLmhlaWdodCAtIDE1MCkgKyAyMDsgd29ya3NwYWNlRWxlbWVudHMucHVzaCh7IC4uLmVsZW1lbnQsIGlkOiBuZXh0SWQrKywgeDogbmV3WCwgeTogbmV3WSwgaXNOZXcgfSk7IHJlbmRlcldvcmtzcGFjZSgpOyB9CiAgICAgICAgZnVuY3Rpb24gcmVzZXRXb3Jrc3BhY2Uoc3Bhd25Jbml0aWFsID0gdHJ1ZSkgewogICAgICAgICAgICB3b3Jrc3BhY2VFbGVtZW50cyA9IFtdOwogICAgICAgICAgICBpZiAoc3Bhd25Jbml0aWFsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBib3VuZHMgPSB3b3Jrc3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBbeyB4OiBib3VuZHMud2lkdGggLyAyIC0gMTYwIC0gMjAsIHk6IGJvdW5kcy5oZWlnaHQgLyAyIC0gOTYgLSAyMCB9LCB7IHg6IGJvdW5kcy53aWR0aCAvIDIgKyAyMCwgeTogYm91bmRzLmhlaWdodCAvIDIgLSA5NiAtIDIwIH0sIHsgeDogYm91bmRzLndpZHRoIC8gMiAtIDE2MCAtIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sIHsgeDogYm91bmRzLndpZHRoIC8gMiArIDIwLCB5OiBib3VuZHMuaGVpZ2h0IC8gMiArIDIwIH0sXTsKICAgICAgICAgICAgICAgIGluaXRpYWxFbGVtZW50cy5mb3JFYWNoKChlbCwgaSkgPT4gc3Bhd25FbGVtZW50KGVsLCBwb3NpdGlvbnNbaV0ueCwgcG9zaXRpb25zW2ldLnksIGZhbHNlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyV29ya3NwYWNlKCk7CiAgICAgICAgfQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1Db21iaW5hdGlvbihlbDEsIGVsMikgewogICAgICAgICAgICBjb25zdCBjYXJkMSA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7ZWwxLmlkfSddYCksIGNhcmQyID0gd29ya3NwYWNlLnF1ZXJ5U2VsZWN0b3IoYC5lbGVtZW50LWNhcmRbZGF0YS1pZD0nJHtlbDIuaWR9J11gKTsKICAgICAgICAgICAgY2FyZDE/LmNsYXNzTGlzdC5hZGQoJ2NvbWJpbmluZycpOwogICAgICAgICAgICBjYXJkMj8uY2xhc3NMaXN0LmFkZCgnY29tYmluaW5nJyk7CiAgICAgICAgICAgIFNvdW5kTWFuYWdlci5wbGF5Q29tYmluZSgpOwogICAgICAgICAgICBzaG93TG9hZGVyKHRydWUpOwogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb21iaW5hdGlvbihlbDEsIGVsMik7CiAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmlzTmV3KSB7CiAgICAgICAgICAgICAgICBTb3VuZE1hbmFnZXIucGxheURpc2NvdmVyKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc0ZpcnN0RGlzY292ZXJ5ID0gIWRpc2NvdmVyZWRFbGVtZW50cy5zb21lKGQgPT4gZC5uYW1lID09PSByZXN1bHQubmFtZSk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdFbGVtZW50ID0geyBuYW1lOiByZXN1bHQubmFtZSwgZW1vamk6IHJlc3VsdC5lbW9qaSB9OwogICAgICAgICAgICAgICAgaWYgKGlzRmlyc3REaXNjb3ZlcnkpIHsKICAgICAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkRWxlbWVudHMucHVzaCh7IC4uLm5ld0VsZW1lbnQsIHJlY2lwZTogeyBlbGVtZW50MTogZWwxLm5hbWUsIGVsZW1lbnQyOiBlbDIubmFtZSB9IH0pOwogICAgICAgICAgICAgICAgICAgIHNhdmVQcm9ncmVzcygpOwogICAgICAgICAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ3N1Y2Nlc3MnLCB0aXRsZTogJ0ZpcnN0IERpc2NvdmVyeSEnLCB0ZXh0OiBgWW91J3ZlIGNyZWF0ZWQgJHtyZXN1bHQubmFtZX0gJHtyZXN1bHQuZW1vaml9IWAsIGNvbW1lbnRhcnk6IHJlc3VsdC5jb21tZW50YXJ5IH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd0FJUG9wdXAoeyB0eXBlOiAnaW5mbycsIHRpdGxlOiAnTmV3IEVsZW1lbnQhJywgdGV4dDogYFlvdSBtYWRlICR7cmVzdWx0Lm5hbWV9ICR7cmVzdWx0LmVtb2ppfSFgLCBjb21tZW50YXJ5OiByZXN1bHQuY29tbWVudGFyeSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHNwYXduWCA9IChlbDEueCArIGVsMi54KSAvIDIsIHNwYXduWSA9IChlbDEueSArIGVsMi55KSAvIDI7CiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VFbGVtZW50cyA9IHdvcmtzcGFjZUVsZW1lbnRzLmZpbHRlcihlbCA9PiBlbC5pZCAhPT0gZWwxLmlkICYmIGVsLmlkICE9PSBlbDIuaWQpOwogICAgICAgICAgICAgICAgc3Bhd25FbGVtZW50KG5ld0VsZW1lbnQsIHNwYXduWCwgc3Bhd25ZKTsKICAgICAgICAgICAgICAgIGNyZWF0ZVBhcnRpY2xlQnVyc3Qoc3Bhd25YLCBzcGF3blkpOwogICAgICAgICAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJyAmJiByZXN1bHQubmFtZSA9PT0gY2hhbGxlbmdlU3RhdGUudGFyZ2V0Py5uYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVUYWtlbiA9IChEYXRlLm5vdygpIC0gY2hhbGxlbmdlU3RhdGUuc3RhcnRUaW1lKSAvIDEwMDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGllckluZGV4ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoY2hhbGxlbmdlU3RhdGUubGV2ZWwgLSAxKSAvIDIpLCBjaGFsbGVuZ2VUaWVycy5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnb2xkVGltZSA9IDEwICsgdGllckluZGV4ICogNSwgc2lsdmVyVGltZSA9IDIwICsgdGllckluZGV4ICogMTA7CiAgICAgICAgICAgICAgICAgICAgbGV0IHJhbmsgPSAnQnJvbnplIPCfpYknOwogICAgICAgICAgICAgICAgICAgIGlmICh0aW1lVGFrZW4gPCBnb2xkVGltZSkKICAgICAgICAgICAgICAgICAgICAgICAgcmFuayA9ICdHb2xkIPCfpYcnOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRpbWVUYWtlbiA8IHNpbHZlclRpbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmsgPSAnU2lsdmVyIPCfpYgnOwogICAgICAgICAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ3N1Y2Nlc3MnLCB0aXRsZTogYExldmVsICR7Y2hhbGxlbmdlU3RhdGUubGV2ZWx9IENvbXBsZXRlIWAsIHRleHQ6IGBSYW5rOiAke3Jhbmt9IHwgVGltZTogJHt0aW1lVGFrZW4udG9GaXhlZCgxKX1zYCwgY29tbWVudGFyeTogYFlvdSBjcmFmdGVkICR7Y2hhbGxlbmdlU3RhdGUudGFyZ2V0Lm5hbWV9IWAgfSk7CiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oQ0hBTExFTkdFX0xFVkVMX0tFWSwgSlNPTi5zdHJpbmdpZnkoY2hhbGxlbmdlU3RhdGUubGV2ZWwpKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHN0YXJ0TmV4dExldmVsKGNoYWxsZW5nZVN0YXRlLmxldmVsKSwgNDAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBTb3VuZE1hbmFnZXIucGxheUVycm9yKCk7CiAgICAgICAgICAgICAgICBjb25zdCByZWFzb24gPSByZXN1bHQgPyBgQ29tYmluaW5nICR7ZWwxLm5hbWV9IGFuZCAke2VsMi5uYW1lfSByZXN1bHRzIGluICR7cmVzdWx0Lm5hbWV9LiBOb3RoaW5nIG5ldyBjcmVhdGVkLmAgOiAiVGhvc2UgZWxlbWVudHMgZG9uJ3Qgc2VlbSB0byBjb21iaW5lIHdlbGwuIjsKICAgICAgICAgICAgICAgIHNob3dBSVBvcHVwKHsgdHlwZTogJ2Vycm9yJywgdGl0bGU6ICdObyBSZWFjdGlvbicsIHRleHQ6IHJlYXNvbiwgY29tbWVudGFyeTogcmVzdWx0Py5jb21tZW50YXJ5IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpOwogICAgICAgICAgICBjYXJkMT8uY2xhc3NMaXN0LnJlbW92ZSgnY29tYmluaW5nJyk7CiAgICAgICAgICAgIGNhcmQyPy5jbGFzc0xpc3QucmVtb3ZlKCdjb21iaW5pbmcnKTsKICAgICAgICAgICAgdXBkYXRlVUkoKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaGFuZGxlTW91c2VEb3duKGUsIGlkKSB7CiAgICAgICAgICAgIGlmIChnYW1lTW9kZSA9PT0gJ21lbnUnIHx8IGRyYWdnaW5nSW5mby5pZCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHdvcmtzcGFjZUVsZW1lbnRzLmZpbmQoZWwgPT4gZWwuaWQgPT09IGlkKTsKICAgICAgICAgICAgY29uc3QgY2FyZCA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgaWYgKCFlbGVtZW50IHx8ICFjYXJkKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJyk7CiAgICAgICAgICAgIGRyYWdnaW5nSW5mbyA9IHsgaWQsIGVsZW1lbnQ6IGNhcmQsIG9mZnNldFg6IGUuY2xpZW50WCAtIGNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCwgb2Zmc2V0WTogZS5jbGllbnRZIC0gY2FyZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AsIH07CiAgICAgICAgICAgIHdvcmtzcGFjZS5hcHBlbmRDaGlsZChjYXJkKTsKICAgICAgICAgICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBoYW5kbGVNb3VzZU1vdmU7CiAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGhhbmRsZU1vdXNlVXA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZU1vdXNlTW92ZShlKSB7CiAgICAgICAgICAgIGlmICghZHJhZ2dpbmdJbmZvLmlkIHx8ICFkcmFnZ2luZ0luZm8uZWxlbWVudCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgeyBlbGVtZW50LCBvZmZzZXRYLCBvZmZzZXRZIH0gPSBkcmFnZ2luZ0luZm87CiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZVJlY3QgPSB3b3Jrc3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGxldCB4ID0gZS5jbGllbnRYIC0gd29ya3NwYWNlUmVjdC5sZWZ0IC0gb2Zmc2V0WCwgeSA9IGUuY2xpZW50WSAtIHdvcmtzcGFjZVJlY3QudG9wIC0gb2Zmc2V0WTsKICAgICAgICAgICAgeCA9IE1hdGgubWF4KDAsIE1hdGgubWluKHgsIHdvcmtzcGFjZVJlY3Qud2lkdGggLSBlbGVtZW50Lm9mZnNldFdpZHRoKSk7CiAgICAgICAgICAgIHkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih5LCB3b3Jrc3BhY2VSZWN0LmhlaWdodCAtIGVsZW1lbnQub2Zmc2V0SGVpZ2h0KSk7CiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3h9cHhgOwogICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRvcCA9IGAke3l9cHhgOwogICAgICAgICAgICBjb25zdCBkcmFnZ2VkUmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGZvciAoY29uc3Qgb3RoZXJFbCBvZiB3b3Jrc3BhY2VFbGVtZW50cykgewogICAgICAgICAgICAgICAgaWYgKG90aGVyRWwuaWQgPT09IGRyYWdnaW5nSW5mby5pZCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyQ2FyZCA9IHdvcmtzcGFjZS5xdWVyeVNlbGVjdG9yKGAuZWxlbWVudC1jYXJkW2RhdGEtaWQ9JyR7b3RoZXJFbC5pZH0nXWApOwogICAgICAgICAgICAgICAgaWYgKCFvdGhlckNhcmQpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBvdGhlclJlY3QgPSBvdGhlckNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZFJlY3QubGVmdCA8IG90aGVyUmVjdC5yaWdodCAmJiBkcmFnZ2VkUmVjdC5yaWdodCA+IG90aGVyUmVjdC5sZWZ0ICYmIGRyYWdnZWRSZWN0LnRvcCA8IG90aGVyUmVjdC5ib3R0b20gJiYgZHJhZ2dlZFJlY3QuYm90dG9tID4gb3RoZXJSZWN0LnRvcCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRyYWdnZWRFbGVtZW50ID0gd29ya3NwYWNlRWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gZHJhZ2dpbmdJbmZvLmlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQueCA9IHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50LnkgPSB5OwogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVNb3VzZVVwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmZvcm1Db21iaW5hdGlvbihkcmFnZ2VkRWxlbWVudCwgb3RoZXJFbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaGFuZGxlTW91c2VVcCgpIHsKICAgICAgICAgICAgaWYgKCFkcmFnZ2luZ0luZm8uaWQgfHwgIWRyYWdnaW5nSW5mby5lbGVtZW50KQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB7IGlkLCBlbGVtZW50IH0gPSBkcmFnZ2luZ0luZm87CiAgICAgICAgICAgIGNvbnN0IGVsSW5TdGF0ZSA9IHdvcmtzcGFjZUVsZW1lbnRzLmZpbmQoZWwgPT4gZWwuaWQgPT09IGlkKTsKICAgICAgICAgICAgaWYgKGVsSW5TdGF0ZSkgewogICAgICAgICAgICAgICAgZWxJblN0YXRlLnggPSBwYXJzZUZsb2F0KGVsZW1lbnQuc3R5bGUubGVmdCk7CiAgICAgICAgICAgICAgICBlbEluU3RhdGUueSA9IHBhcnNlRmxvYXQoZWxlbWVudC5zdHlsZS50b3ApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTsKICAgICAgICAgICAgZHJhZ2dpbmdJbmZvID0geyBpZDogbnVsbCwgZWxlbWVudDogbnVsbCwgb2Zmc2V0WDogMCwgb2Zmc2V0WTogMCB9OwogICAgICAgICAgICBkb2N1bWVudC5vbm1vdXNlbW92ZSA9IG51bGw7CiAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHN0YXJ0TmV4dExldmVsKGN1cnJlbnRMZXZlbCkgewogICAgICAgICAgICBjb25zdCBuZXh0TGV2ZWwgPSBjdXJyZW50TGV2ZWwgKyAxOwogICAgICAgICAgICBjb25zdCB0aWVySW5kZXggPSBNYXRoLm1pbihNYXRoLmZsb29yKChuZXh0TGV2ZWwgLSAxKSAvIDIpLCBjaGFsbGVuZ2VUaWVycy5sZW5ndGggLSAxKTsKICAgICAgICAgICAgY29uc3QgdGllciA9IGNoYWxsZW5nZVRpZXJzW3RpZXJJbmRleF07CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRpZXJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGllci5sZW5ndGgpXTsKICAgICAgICAgICAgY2hhbGxlbmdlU3RhdGUgPSB7IGxldmVsOiBuZXh0TGV2ZWwsIHRhcmdldCwgc3RhcnRUaW1lOiBEYXRlLm5vdygpLCB0aW1lcjogJzAwOjAwJywgaXNBY3RpdmU6IHRydWUgfTsKICAgICAgICAgICAgdGltZXJJbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7IGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gY2hhbGxlbmdlU3RhdGUuc3RhcnRUaW1lKSAvIDEwMDApOyBjb25zdCBtaW5zID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsgY29uc3Qgc2VjcyA9IChzZWNvbmRzICUgNjApLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsgY2hhbGxlbmdlU3RhdGUudGltZXIgPSBgJHttaW5zfToke3NlY3N9YDsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYWxsZW5nZS10aW1lcicpLnRleHRDb250ZW50ID0gY2hhbGxlbmdlU3RhdGUudGltZXI7IH0sIDEwMDApOwogICAgICAgICAgICByZXNldFdvcmtzcGFjZSgpOwogICAgICAgICAgICB1cGRhdGVVSSgpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzdGFydEZyZWVQbGF5KCkgeyBnYW1lTW9kZSA9ICdmcmVlJzsgcmVzZXRXb3Jrc3BhY2UoKTsgdXBkYXRlVUkoKTsgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUNoYWxsZW5nZVN0YXJ0UmVxdWVzdCgpIHsgY29uc3Qgc2F2ZWRMZXZlbCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpOyBpZiAoc2F2ZWRMZXZlbCAmJiBwYXJzZUludChzYXZlZExldmVsLCAxMCkgPiAwKSB7CiAgICAgICAgICAgIGNoYWxsZW5nZVByb21wdC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGhhbmRsZU5ld0NoYWxsZW5nZUdhbWUoKTsKICAgICAgICB9IH0KICAgICAgICBmdW5jdGlvbiBoYW5kbGVDb250aW51ZUNoYWxsZW5nZSgpIHsgY29uc3Qgc2F2ZWRMZXZlbCA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpIHx8ICcwJywgMTApOyBnYW1lTW9kZSA9ICdjaGFsbGVuZ2UnOyBkaXNjb3ZlcmVkRWxlbWVudHMgPSBbLi4uaW5pdGlhbEVsZW1lbnRzXTsgc3RhcnROZXh0TGV2ZWwoc2F2ZWRMZXZlbCk7IGNoYWxsZW5nZVByb21wdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZU5ld0NoYWxsZW5nZUdhbWUoKSB7IGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENIQUxMRU5HRV9MRVZFTF9LRVkpOyBnYW1lTW9kZSA9ICdjaGFsbGVuZ2UnOyBkaXNjb3ZlcmVkRWxlbWVudHMgPSBbLi4uaW5pdGlhbEVsZW1lbnRzXTsgc3RhcnROZXh0TGV2ZWwoMCk7IGNoYWxsZW5nZVByb21wdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUVuZEdhbWUoKSB7IGdhbWVNb2RlID0gJ21lbnUnOyB3b3Jrc3BhY2VFbGVtZW50cyA9IFtdOyBpZiAoY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUpIHsKICAgICAgICAgICAgY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsKTsKICAgICAgICB9IHVwZGF0ZVVJKCk7IH0KICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICBsb2FkUHJvZ3Jlc3MoKTsKICAgICAgICAgICAgaWYgKGVuZEdhbWVCdG4pIHsKICAgICAgICAgICAgICAgIGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCA9IGVuZEdhbWVCdG4uaW5uZXJIVE1MOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydC1mcmVlLXBsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgU291bmRNYW5hZ2VyLmluaXQoKTsgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOyBzdGFydEZyZWVQbGF5KCk7IH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IFNvdW5kTWFuYWdlci5pbml0KCk7IFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsgaGFuZGxlQ2hhbGxlbmdlU3RhcnRSZXF1ZXN0KCk7IH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGludWUtY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsgaGFuZGxlQ29udGludWVDaGFsbGVuZ2UoKTsgfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsgaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSgpOyB9KTsKICAgICAgICAgICAgZW5kR2FtZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOyBoYW5kbGVFbmRHYW1lKCk7IH0pOwogICAgICAgICAgICBzZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHJlbmRlclNpZGViYXIpOwogICAgICAgICAgICBjbGVhclNlYXJjaEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgc2VhcmNoSW5wdXQudmFsdWUgPSAnJzsgcmVuZGVyU2lkZWJhcigpOyBTb3VuZE1hbmFnZXIucGxheUNsaWNrKCk7IH0pOwogICAgICAgICAgICB0YWJFbGVtZW50cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgZWxlbWVudHNMaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyByZWNpcGVzTGlzdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgdGFiRWxlbWVudHMuY2xhc3NMaXN0LmFkZCgnYmctY3lhbi01MDAvMjAnLCAndGV4dC1jeWFuLTMwMCcpOyB0YWJSZWNpcGVzLmNsYXNzTGlzdC5yZW1vdmUoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsgU291bmRNYW5hZ2VyLnBsYXlUYWIoKTsgfSk7CiAgICAgICAgICAgIHRhYlJlY2lwZXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGVsZW1lbnRzTGlzdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgcmVjaXBlc0xpc3QuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7IHRhYlJlY2lwZXMuY2xhc3NMaXN0LmFkZCgnYmctY3lhbi01MDAvMjAnLCAndGV4dC1jeWFuLTMwMCcpOyB0YWJFbGVtZW50cy5jbGFzc0xpc3QucmVtb3ZlKCdiZy1jeWFuLTUwMC8yMCcsICd0ZXh0LWN5YW4tMzAwJyk7IFNvdW5kTWFuYWdlci5wbGF5VGFiKCk7IH0pOwogICAgICAgICAgICBpZiAoaW50cm9PdmVybGF5KSB7CiAgICAgICAgICAgICAgICBpbnRyb092ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaW50cm9PdmVybGF5LnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAwLjVzIGVhc2Utb3V0JzsKICAgICAgICAgICAgICAgICAgICBpbnRyb092ZXJsYXkuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICAgICAgICAgICAgICBpbnRyb092ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgaW50cm9PdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyB9LCA1MDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlVUkoKTsKICAgICAgICB9CiAgICAgICAgaW5pdCgpOwogICAgICAgIC8vIC0tLSBFbmQgb2YgRW1iZWRkZWQgQXBwIFNjcmlwdCAtLS0KICAgIH07CiAgICByZXR1cm4gYCgke3NjcmlwdC50b1N0cmluZygpfSkoKWA7Cn0KZnVuY3Rpb24gZG93bmxvYWRHYW1lQXNIdG1sKGFwaUtleSkgewogICAgLy8gVGhpcyBmdW5jdGlvbiBjcmVhdGVzIGEgc2VsZi1jb250YWluZWQgSFRNTCBmaWxlIG9mIHRoZSBnYW1lLgogICAgLy8gMS4gR2V0IHRoZSBnYW1lJ3MgbG9naWMgYXMgYSBzdHJpbmcgYW5kIGluamVjdCB0aGUgdXNlci1wcm92aWRlZCBBUEkga2V5LgogICAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGdldEFwcFNjcmlwdCgpLnJlcGxhY2UoLyclJUFQSV9LRVklJScvZywgYCcke2FwaUtleX0nYCk7CiAgICAvLyAyLiBDbG9uZSB0aGUgY3VycmVudCBkb2N1bWVudCdzIERPTSB0byB1c2UgYXMgYSB0ZW1wbGF0ZS4KICAgIGNvbnN0IG9mZmxpbmVEb2MgPSBkb2N1bWVudC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAvLyAzLiBNb2RpZnkgdGhlIGNsb25lZCBkb2N1bWVudCBmb3Igb2ZmbGluZSB1c2UuCiAgICBjb25zdCB0aXRsZVRhZyA9IG9mZmxpbmVEb2MucXVlcnlTZWxlY3RvcigndGl0bGUnKTsKICAgIGlmICh0aXRsZVRhZykgewogICAgICAgIHRpdGxlVGFnLnRleHRDb250ZW50ID0gJ2dlbmNyYWZ0IChPZmZsaW5lKSc7CiAgICB9CiAgICBvZmZsaW5lRG9jLnF1ZXJ5U2VsZWN0b3IoJ3NjcmlwdFtzcmM9Ii9pbmRleC50c3giXScpPy5yZW1vdmUoKTsKICAgIGNvbnN0IGRvd25sb2FkQnV0dG9uQ29udGFpbmVyID0gb2ZmbGluZURvYy5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtZ2FtZS1idG4nKT8ucGFyZW50RWxlbWVudDsKICAgIGRvd25sb2FkQnV0dG9uQ29udGFpbmVyPy5yZW1vdmUoKTsKICAgIG9mZmxpbmVEb2MuZ2V0RWxlbWVudEJ5SWQoJ2FwaS1rZXktbW9kYWwnKT8ucmVtb3ZlKCk7CiAgICAvLyA0LiBDcmVhdGUgYW5kIGluamVjdCBhIG5ldyBzY3JpcHQgdGFnIHRoYXQgY29udGFpbnMgYWxsIHRoZSBnYW1lIGxvZ2ljLgogICAgY29uc3QgbmV3U2NyaXB0VGFnID0gb2ZmbGluZURvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgIG5ld1NjcmlwdFRhZy50eXBlID0gIm1vZHVsZSI7CiAgICBuZXdTY3JpcHRUYWcudGV4dENvbnRlbnQgPSBgCiAgICAgICAgLy8gRHluYW1pY2FsbHkgaW1wb3J0IHRoZSBHb29nbGUgR2VuQUkgbGlicmFyeSBmcm9tIGEgQ0ROLgogICAgICAgIGltcG9ydCB7IEdvb2dsZUdlbkFJLCBUeXBlIH0gZnJvbSAiaHR0cHM6Ly9lc20uc2gvQGdvb2dsZS9nZW5haSI7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGdhbWUgc2NyaXB0IGV4cGVjdHMgdGhlc2UgdG8gYmUgb24gdGhlIHdpbmRvdyBvYmplY3QuCiAgICAgICAgKHdpbmRvdyBhcyBhbnkpLmdvb2dsZUdlbmFpID0geyBHb29nbGVHZW5BSSwgVHlwZSB9OwogICAgICAgIAogICAgICAgIC8vIEV4ZWN1dGUgdGhlIGVudGlyZSBnYW1lJ3MgbG9naWMgc3RyaW5nLgogICAgICAgIC8vIFVzaW5nIGV2YWwgaXMgbmVjZXNzYXJ5IGhlcmUgdG8gcnVuIHRoZSBzZWxmLWNvbnRhaW5lZCBzY3JpcHQgc3RyaW5nLgogICAgICAgIC8vIEpTT04uc3RyaW5naWZ5IGVuc3VyZXMgdGhlIHN0cmluZyBpcyBzYWZlbHkgZW1iZWRkZWQuCiAgICAgICAgZXZhbCgke0pTT04uc3RyaW5naWZ5KHNjcmlwdENvbnRlbnQpfSk7CiAgICBgOwogICAgb2ZmbGluZURvYy5ib2R5LmFwcGVuZENoaWxkKG5ld1NjcmlwdFRhZyk7CiAgICAvLyA1LiBTZXJpYWxpemUgdGhlIG1vZGlmaWVkIGRvY3VtZW50IHRvIGFuIEhUTUwgc3RyaW5nLgogICAgY29uc3QgZmluYWxIdG1sID0gJzwhRE9DVFlQRSBodG1sPlxuJyArIG9mZmxpbmVEb2MuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDsKICAgIC8vIDYuIENyZWF0ZSBhIEJsb2IgYW5kIHRyaWdnZXIgYSBkb3dubG9hZC4KICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZmluYWxIdG1sXSwgeyB0eXBlOiAndGV4dC9odG1sJyB9KTsKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICBhLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgYS5kb3dubG9hZCA9ICdnZW5jcmFmdC1vZmZsaW5lLmh0bWwnOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgIGEuY2xpY2soKTsKICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7CiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7Cn0KZnVuY3Rpb24gaGFuZGxlRG93bmxvYWRSZXF1ZXN0KCkgewogICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgYXBpS2V5TW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBhcGlLZXlNb2RhbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2F1dG8nOwogICAgYXBpS2V5SW5wdXQuZm9jdXMoKTsKfQovLyAtLS0gSW5pdGlhbGl6YXRpb24gLS0tCmZ1bmN0aW9uIGluaXQoKSB7CiAgICAvLyBTdG9yZSB0aGUgZGVmYXVsdCBidXR0b24gY29udGVudCBvbiBzdGFydHVwCiAgICBpZiAoZW5kR2FtZUJ0bikgewogICAgICAgIGVuZEdhbWVCdG5EZWZhdWx0Q29udGVudCA9IGVuZEdhbWVCdG4uaW5uZXJIVE1MOwogICAgfQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0LWZyZWUtcGxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIFNvdW5kTWFuYWdlci5pbml0KCk7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIHN0YXJ0RnJlZVBsYXkoKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0LWNoYWxsZW5nZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIFNvdW5kTWFuYWdlci5pbml0KCk7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZUNoYWxsZW5nZVN0YXJ0UmVxdWVzdCgpOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGludWUtY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZUNvbnRpbnVlQ2hhbGxlbmdlKCk7CiAgICB9KTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctY2hhbGxlbmdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZU5ld0NoYWxsZW5nZUdhbWUoKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25sb2FkLWdhbWUtYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRG93bmxvYWRSZXF1ZXN0KTsKICAgIGVuZEdhbWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGhhbmRsZUVuZEdhbWUoKTsKICAgIH0pOwogICAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCByZW5kZXJTaWRlYmFyKTsKICAgIGNsZWFyU2VhcmNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIHNlYXJjaElucHV0LnZhbHVlID0gJyc7CiAgICAgICAgY2xlYXJTZWFyY2hCdG4uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgcmVuZGVyU2lkZWJhcigpOwogICAgICAgIFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsKICAgIH0pOwogICAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoKSA9PiB7CiAgICAgICAgY2xlYXJTZWFyY2hCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgc2VhcmNoSW5wdXQudmFsdWUubGVuZ3RoID09PSAwKTsKICAgIH0pOwogICAgdGFiRWxlbWVudHMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZWxlbWVudHNMaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIHJlY2lwZXNMaXN0LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHRhYkVsZW1lbnRzLmNsYXNzTGlzdC5hZGQoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsKICAgICAgICB0YWJSZWNpcGVzLmNsYXNzTGlzdC5yZW1vdmUoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsKICAgICAgICBTb3VuZE1hbmFnZXIucGxheVRhYigpOwogICAgfSk7CiAgICB0YWJSZWNpcGVzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGVsZW1lbnRzTGlzdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICByZWNpcGVzTGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB0YWJSZWNpcGVzLmNsYXNzTGlzdC5hZGQoJ2JnLWN5YW4tNTAwLzIwJywgJ3RleHQtY3lhbi0zMDAnKTsKICAgICAgICB0YWJFbGVtZW50cy5jbGFzc0xpc3QucmVtb3ZlKCdiZy1jeWFuLTUwMC8yMCcsICd0ZXh0LWN5YW4tMzAwJyk7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlUYWIoKTsKICAgIH0pOwogICAgYXBpS2V5U3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIFNvdW5kTWFuYWdlci5wbGF5Q2xpY2soKTsKICAgICAgICBjb25zdCBhcGlLZXkgPSBhcGlLZXlJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgaWYgKGFwaUtleSkgewogICAgICAgICAgICBkb3dubG9hZEdhbWVBc0h0bWwoYXBpS2V5KTsKICAgICAgICAgICAgYXBpS2V5TW9kYWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKICAgICAgICAgICAgYXBpS2V5TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBTb3VuZE1hbmFnZXIucGxheUVycm9yKCk7CiAgICAgICAgICAgIGFwaUtleUlucHV0LmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtc2hha2UnLCAnYm9yZGVyLXJlZC01MDAnKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBhcGlLZXlJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLXNoYWtlJywgJ2JvcmRlci1yZWQtNTAwJyksIDUwMCk7CiAgICAgICAgfQogICAgfSk7CiAgICBhcGlLZXlDYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgU291bmRNYW5hZ2VyLnBsYXlDbGljaygpOwogICAgICAgIGFwaUtleU1vZGFsLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7CiAgICAgICAgYXBpS2V5TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9KTsKICAgIGlmIChpbnRyb092ZXJsYXkpIHsKICAgICAgICBpbnRyb092ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGludHJvT3ZlcmxheS5zdHlsZS50cmFuc2l0aW9uID0gJ29wYWNpdHkgMC41cyBlYXNlLW91dCc7CiAgICAgICAgICAgIGludHJvT3ZlcmxheS5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICBpbnRyb092ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGludHJvT3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgfSwgNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIGxvYWRQcm9ncmVzcygpOwogICAgdXBkYXRlVUkoKTsKfQppbml0KCk7Cg==","@/types":"data:application/javascript;base64,ZXhwb3J0IHt9Owo=","@/services/geminiService":"data:application/javascript;base64,aW1wb3J0IHsgR29vZ2xlR2VuQUksIFR5cGUgfSBmcm9tICJAZ29vZ2xlL2dlbmFpIjsKLy8gVGhlIEFQSSBrZXkgaXMgc291cmNlZCBmcm9tIHByb2Nlc3MuZW52LkFQSV9LRVksIHdoaWNoIGlzIGFzc3VtZWQgdG8gYmUgc2V0IGluIHRoZSBleGVjdXRpb24gZW52aXJvbm1lbnQuCmNvbnN0IGFpID0gbmV3IEdvb2dsZUdlbkFJKHsgYXBpS2V5OiBwcm9jZXNzLmVudi5BUElfS0VZIH0pOwpjb25zdCBwcmVtYWRlQ29tYmluYXRpb25zID0gewogICAgLy8gQmFzZSBDb21iaW5hdGlvbnMKICAgICdBaXJfRWFydGgnOiB7IG5hbWU6ICdEdXN0JywgZW1vamk6ICfwn4ys77iPJyB9LAogICAgJ0Fpcl9GaXJlJzogeyBuYW1lOiAnU21va2UnLCBlbW9qaTogJ/CfjKvvuI8nIH0sCiAgICAnQWlyX1dhdGVyJzogeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwKICAgICdFYXJ0aF9GaXJlJzogeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfSwKICAgICdFYXJ0aF9XYXRlcic6IHsgbmFtZTogJ1BsYW50JywgZW1vamk6ICfwn4yxJyB9LAogICAgJ0ZpcmVfV2F0ZXInOiB7IG5hbWU6ICdTdGVhbScsIGVtb2ppOiAn4pmo77iPJyB9LAogICAgLy8gVGllciAyIENvbWJpbmF0aW9ucwogICAgJ0R1c3RfRmlyZSc6IHsgbmFtZTogJ0d1bnBvd2RlcicsIGVtb2ppOiAn8J+SoycgfSwKICAgICdEdXN0X1dhdGVyJzogeyBuYW1lOiAnTXVkJywgZW1vamk6ICfwn5KpJyB9LAogICAgJ0VhcnRoX0xhdmEnOiB7IG5hbWU6ICdWb2xjYW5vJywgZW1vamk6ICfwn4yLJyB9LAogICAgJ0xhdmFfV2F0ZXInOiB7IG5hbWU6ICdTdG9uZScsIGVtb2ppOiAn8J+qqCcgfSwKICAgICdMYXZhX0Fpcic6IHsgbmFtZTogJ09ic2lkaWFuJywgZW1vamk6ICfwn5akJyB9LAogICAgJ1BsYW50X0ZpcmUnOiB7IG5hbWU6ICdBc2gnLCBlbW9qaTogJ+KaqycgfSwKICAgICdQbGFudF9TbW9rZSc6IHsgbmFtZTogJ1RvYmFjY28nLCBlbW9qaTogJ/CfmqwnIH0sCiAgICAnUGxhbnRfU3RvbmUnOiB7IG5hbWU6ICdGb3NzaWwnLCBlbW9qaTogJ/CfprQnIH0sCiAgICAnUGxhbnRfV2F0ZXInOiB7IG5hbWU6ICdTd2FtcCcsIGVtb2ppOiAn8J+QiicgfSwKICAgICdQbGFudF9BaXInOiB7IG5hbWU6ICdQb2xsZW4nLCBlbW9qaTogJ/CfjLwnIH0sCiAgICAnUGxhbnRfRWFydGgnOiB7IG5hbWU6ICdHcmFzcycsIGVtb2ppOiAn8J+MvicgfSwKICAgICdSYWluX0VhcnRoJzogeyBuYW1lOiAnTXVkJywgZW1vamk6ICfwn5KpJyB9LAogICAgJ1JhaW5fRmlyZSc6IHsgbmFtZTogJ1JhaW5ib3cnLCBlbW9qaTogJ/CfjIgnIH0sCiAgICAnU3RlYW1fQWlyJzogeyBuYW1lOiAnQ2xvdWQnLCBlbW9qaTogJ+KYge+4jycgfSwKICAgICdTdGVhbV9FYXJ0aCc6IHsgbmFtZTogJ0dleXNlcicsIGVtb2ppOiAn4pmo77iPJyB9LAogICAgJ1Ntb2tlX1dhdGVyJzogeyBuYW1lOiAnRm9nJywgZW1vamk6ICfwn4yr77iPJyB9LAogICAgLy8gVGllciAzIENvbWJpbmF0aW9ucwogICAgJ0FzaF9TdG9uZSc6IHsgbmFtZTogJ1N0YXR1ZScsIGVtb2ppOiAn8J+XvycgfSwKICAgICdDbG91ZF9GaXJlJzogeyBuYW1lOiAnTGlnaHRuaW5nJywgZW1vamk6ICfimqEnIH0sCiAgICAnQ2xvdWRfV2F0ZXInOiB7IG5hbWU6ICdSYWluJywgZW1vamk6ICfwn4yn77iPJyB9LAogICAgJ0dyYXNzX0dyYXNzJzogeyBuYW1lOiAnTGF3bicsIGVtb2ppOiAn8J+PoScgfSwKICAgICdHcmFzc19FYXJ0aCc6IHsgbmFtZTogJ0ZpZWxkJywgZW1vamk6ICfwn4+e77iPJyB9LAogICAgJ0xpZ2h0bmluZ19NZXRhbCc6IHsgbmFtZTogJ0VsZWN0cmljaXR5JywgZW1vamk6ICfwn5KhJyB9LAogICAgJ0xpZ2h0bmluZ19FYXJ0aCc6IHsgbmFtZTogJ0NyeXN0YWwnLCBlbW9qaTogJ/Cfko4nIH0sCiAgICAnTXVkX0ZpcmUnOiB7IG5hbWU6ICdCcmljaycsIGVtb2ppOiAn8J+nsScgfSwKICAgICdTdG9uZV9GaXJlJzogeyBuYW1lOiAnTWV0YWwnLCBlbW9qaTogJ/CflKknIH0sCiAgICAnU3RvbmVfV2F0ZXInOiB7IG5hbWU6ICdTYW5kJywgZW1vamk6ICfwn4+W77iPJyB9LAogICAgJ1N0b25lX0Fpcic6IHsgbmFtZTogJ1NhbmRzdG9ybScsIGVtb2ppOiAn8J+Mqu+4jycgfSwKICAgIC8vIFRpZXIgNCsKICAgICdCcmlja19Ccmljayc6IHsgbmFtZTogJ1dhbGwnLCBlbW9qaTogJ/Cfp7EnIH0sCiAgICAnRWxlY3RyaWNpdHlfR2xhc3MnOiB7IG5hbWU6ICdMaWdodCBCdWxiJywgZW1vamk6ICfwn5KhJyB9LAogICAgJ01ldGFsX1dhdGVyJzogeyBuYW1lOiAnUnVzdCcsIGVtb2ppOiAn8J+UqScgfSwKICAgICdTYW5kX0ZpcmUnOiB7IG5hbWU6ICdHbGFzcycsIGVtb2ppOiAn8J+lgycgfSwKICAgICdXYWxsX1dhbGwnOiB7IG5hbWU6ICdIb3VzZScsIGVtb2ppOiAn8J+PoCcgfSwKICAgIC8vIFNlbGYtY29tYmluYXRpb25zICYgbG9naWNhbCBleHRlbnNpb25zCiAgICAnRWFydGhfRWFydGgnOiB7IG5hbWU6ICdMYW5kJywgZW1vamk6ICfwn4+e77iPJyB9LAogICAgJ1dhdGVyX1dhdGVyJzogeyBuYW1lOiAnU2VhJywgZW1vamk6ICfwn4yKJyB9LAogICAgJ1NlYV9TZWEnOiB7IG5hbWU6ICdPY2VhbicsIGVtb2ppOiAn8J+MiicgfSwKICAgICdPY2Vhbl9FYXJ0aCc6IHsgbmFtZTogJ0lzbGFuZCcsIGVtb2ppOiAn8J+Pne+4jycgfSwKICAgICdQbGFudF9QbGFudCc6IHsgbmFtZTogJ0dhcmRlbicsIGVtb2ppOiAn8J+qtCcgfSwKICAgICdHYXJkZW5fUGxhbnQnOiB7IG5hbWU6ICdGb3Jlc3QnLCBlbW9qaTogJ/CfjLMnIH0sCiAgICAnRm9yZXN0X0ZpcmUnOiB7IG5hbWU6ICdXaWxkZmlyZScsIGVtb2ppOiAn8J+UpScgfSwKICAgICdTdG9uZV9TdG9uZSc6IHsgbmFtZTogJ01vdW50YWluJywgZW1vamk6ICfim7DvuI8nIH0sCiAgICAnTW91bnRhaW5fTGF2YSc6IHsgbmFtZTogJ0VydXB0aW9uJywgZW1vamk6ICfwn4yLJyB9LAogICAgLy8gTGlmZSAmIEh1bWFuIFBhdGggKHJlcXVpcmVzICdMaWZlJyBmcm9tIEFJLCBlLmcuIE11ZCArIExpZ2h0bmluZykKICAgICdFYXJ0aF9MaWZlJzogeyBuYW1lOiAnSHVtYW4nLCBlbW9qaTogJ/Cfp40nIH0sCiAgICAnRmlyZV9MaWZlJzogeyBuYW1lOiAnUGhvZW5peCcsIGVtb2ppOiAn8J+QpuKAjfCflKUnIH0sCiAgICAnSHVtYW5fUGxhbnQnOiB7IG5hbWU6ICdGYXJtZXInLCBlbW9qaTogJ/CfkajigI3wn4y+JyB9LAogICAgJ0h1bWFuX1N0b25lJzogeyBuYW1lOiAnVG9vbCcsIGVtb2ppOiAn8J+UpycgfSwKICAgICdIdW1hbl9GaXJlJzogeyBuYW1lOiAnQ29vaycsIGVtb2ppOiAn8J+RqOKAjfCfjbMnIH0sCiAgICAnSHVtYW5fV2F0ZXInOiB7IG5hbWU6ICdTYWlsb3InLCBlbW9qaTogJ/CfkajigI3inIjvuI8nIH0sCiAgICAnSHVtYW5fSHVtYW4nOiB7IG5hbWU6ICdMb3ZlJywgZW1vamk6ICfinaTvuI8nIH0sCiAgICAnSHVtYW5fSG91c2UnOiB7IG5hbWU6ICdGYW1pbHknLCBlbW9qaTogJ/CfkajigI3wn5Gp4oCN8J+Rp+KAjfCfkaYnIH0sCiAgICAnRmFybWVyX0ZpZWxkJzogeyBuYW1lOiAnV2hlYXQnLCBlbW9qaTogJ/CfjL4nIH0sCiAgICAnVG9vbF9Gb3Jlc3QnOiB7IG5hbWU6ICdXb29kJywgZW1vamk6ICfwn6q1JyB9LAogICAgJ1Rvb2xfV29vZCc6IHsgbmFtZTogJ1doZWVsJywgZW1vamk6ICfwn5ueJyB9LAogICAgJ1doZWF0X1N0b25lJzogeyBuYW1lOiAnRmxvdXInLCBlbW9qaTogJ+KaqicgfSwKICAgICdGbG91cl9XYXRlcic6IHsgbmFtZTogJ0RvdWdoJywgZW1vamk6ICfwn42qJyB9LAogICAgJ0RvdWdoX0ZpcmUnOiB7IG5hbWU6ICdCcmVhZCcsIGVtb2ppOiAn8J+NnicgfSwKfTsKY29uc3QgcmVzcG9uc2VTY2hlbWEgPSB7CiAgICB0eXBlOiBUeXBlLk9CSkVDVCwKICAgIHByb3BlcnRpZXM6IHsKICAgICAgICBuYW1lOiB7CiAgICAgICAgICAgIHR5cGU6IFR5cGUuU1RSSU5HLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogIlRoZSBuYW1lIG9mIHRoZSByZXN1bHRpbmcgZWxlbWVudC4gU2hvdWxkIGJlIHNpbXBsZSwgb25lIG9yIHR3byB3b3Jkcy4gSWYgdGhlIGNvbWJpbmF0aW9uIGlzIG5vbnNlbnNpY2FsIG9yIHJlc3VsdHMgaW4gdGhlIHNhbWUgZWxlbWVudCwgdXNlICdOb3RoaW5nJyBvciB0aGUgb3JpZ2luYWwgZWxlbWVudCdzIG5hbWUuIgogICAgICAgIH0sCiAgICAgICAgZW1vamk6IHsKICAgICAgICAgICAgdHlwZTogVHlwZS5TVFJJTkcsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiQSBzaW5nbGUsIHJlbGV2YW50IGVtb2ppIGZvciB0aGUgcmVzdWx0aW5nIGVsZW1lbnQuIFVzZSAn8J+ktycgZm9yIG5vbnNlbnNpY2FsIGNvbWJpbmF0aW9ucy4iCiAgICAgICAgfSwKICAgICAgICBpc05ld0Rpc2NvdmVyeTogewogICAgICAgICAgICB0eXBlOiBUeXBlLkJPT0xFQU4sCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiU2V0IHRvIHRydWUgaWYgdGhlIGNvbWJpbmF0aW9uIGNyZWF0ZXMgYSBnZW51aW5lbHkgbmV3IGFuZCBkaXN0aW5jdCBlbGVtZW50LiBTZXQgdG8gZmFsc2UgaWYgaXQgcmVzdWx0cyBpbiAnTm90aGluZycsIG9uZSBvZiB0aGUgb3JpZ2luYWwgZWxlbWVudHMsIG9yIHNvbWV0aGluZyB0cml2aWFsLiIKICAgICAgICB9LAogICAgICAgIGNvbW1lbnRhcnk6IHsKICAgICAgICAgICAgdHlwZTogVHlwZS5TVFJJTkcsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiQSBxdWlya3ksIHNob3J0LCBmaXJzdC1wZXJzb24gY29tbWVudCBmcm9tIHRoZSBwZXJzcGVjdGl2ZSBvZiB0aGUgbmV3IGVsZW1lbnQuIE1heCAxNSB3b3Jkcy4iCiAgICAgICAgfQogICAgfSwKICAgIHJlcXVpcmVkOiBbIm5hbWUiLCAiZW1vamkiLCAiaXNOZXdEaXNjb3ZlcnkiLCAiY29tbWVudGFyeSJdCn07CmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb21iaW5lRWxlbWVudHMoZWxlbWVudDEsIGVsZW1lbnQyKSB7CiAgICBjb25zdCBrZXkgPSBbZWxlbWVudDEubmFtZSwgZWxlbWVudDIubmFtZV0uc29ydCgpLmpvaW4oJ18nKTsKICAgIGNvbnN0IHByZW1hZGVSZXN1bHQgPSBwcmVtYWRlQ29tYmluYXRpb25zW2tleV07CiAgICBpZiAocHJlbWFkZVJlc3VsdCkgewogICAgICAgIHJldHVybiB7IC4uLnByZW1hZGVSZXN1bHQsIGlzTmV3OiB0cnVlLCBjb21tZW50YXJ5OiAnQSBjbGFzc2ljIGNvbWJpbmF0aW9uIScgfTsKICAgIH0KICAgIC8vIEZvciBub24tcHJlbWFkZSBjb21iaW5hdGlvbnMsIGlmIGVsZW1lbnRzIGFyZSB0aGUgc2FtZSwgZG9uJ3QgY2FsbCB0aGUgQVBJIGFzIGl0J3Mgbm90IGEgbmV3IGRpc2NvdmVyeS4KICAgIGlmIChlbGVtZW50MS5uYW1lID09PSBlbGVtZW50Mi5uYW1lKSB7CiAgICAgICAgcmV0dXJuIHsgbmFtZTogZWxlbWVudDEubmFtZSwgZW1vamk6IGVsZW1lbnQxLmVtb2ppLCBpc05ldzogZmFsc2UgfTsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJvbXB0ID0gYFlvdSBhcmUgYW4gQUkgZm9yIGEgY3JlYXRpdmUgYWxjaGVteSBnYW1lLgogICAgV2hhdCBpcyBjcmVhdGVkIHdoZW4geW91IGNvbWJpbmUgIiR7ZWxlbWVudDEubmFtZX0gJHtlbGVtZW50MS5lbW9qaX0iIGFuZCAiJHtlbGVtZW50Mi5uYW1lfSAke2VsZW1lbnQyLmVtb2ppfSI/CiAgICAtIElmIGl0IGNyZWF0ZXMgYSBuZXcsIGxvZ2ljYWwgaXRlbSwgcHJvdmlkZSBpdHMgbmFtZSwgZW1vamksIGFuZCBhIGZ1biBjb21tZW50YXJ5IGZyb20gaXRzIHBlcnNwZWN0aXZlLgogICAgLSBJZiB0aGUgY29tYmluYXRpb24gaXMgaWxsb2dpY2FsLCBpbXBvc3NpYmxlLCBvciBqdXN0IG1ha2VzIG1vcmUgb2Ygb25lIG9mIHRoZSBpbnB1dHMgKGUuZy4sIEZpcmUgKyBGaXJlKSwgcmVzcG9uZCB3aXRoIGEgcmVzdWx0IHdoZXJlIGlzTmV3RGlzY292ZXJ5IGlzIGZhbHNlLgogICAgLSBLZWVwIHRoZSBuYW1lcyBzaW1wbGUgKDEtMyB3b3JkcykuCiAgICAtIEJlIGNyZWF0aXZlIGFuZCBjb25zaXN0ZW50LmA7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHsKICAgICAgICAgICAgbW9kZWw6ICdnZW1pbmktMi41LWZsYXNoJywKICAgICAgICAgICAgY29udGVudHM6IHByb21wdCwKICAgICAgICAgICAgY29uZmlnOiB7CiAgICAgICAgICAgICAgICByZXNwb25zZU1pbWVUeXBlOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICByZXNwb25zZVNjaGVtYTogcmVzcG9uc2VTY2hlbWEsCiAgICAgICAgICAgICAgICB0ZW1wZXJhdHVyZTogMC44LAogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QganNvblN0cmluZyA9IHJlc3BvbnNlLnRleHQudHJpbSgpOwogICAgICAgIGlmICghanNvblN0cmluZykgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJHZW1pbmkgQVBJIHJldHVybmVkIGFuIGVtcHR5IHJlc3BvbnNlIHRleHQuIik7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKGpzb25TdHJpbmcpOwogICAgICAgIGlmIChyZXN1bHQuaXNOZXdEaXNjb3ZlcnkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgbmFtZTogcmVzdWx0Lm5hbWUsIGVtb2ppOiByZXN1bHQuZW1vamksIGlzTmV3OiB0cnVlLCBjb21tZW50YXJ5OiByZXN1bHQuY29tbWVudGFyeSB9OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSAiTm90aGluZyIgcmVzdWx0IGJ1dCBmbGFnIGl0IGFzIG5vdCBuZXcKICAgICAgICAgICAgcmV0dXJuIHsgbmFtZTogcmVzdWx0Lm5hbWUsIGVtb2ppOiByZXN1bHQuZW1vamksIGlzTmV3OiBmYWxzZSwgY29tbWVudGFyeTogcmVzdWx0LmNvbW1lbnRhcnkgfTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjYWxsaW5nIEdlbWluaSBBUEk6IiwgZXJyb3IpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQp9Cg==","@/components/icons":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3ggfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmV4cG9ydCBjb25zdCBUcmFzaEljb24gPSAoeyBjbGFzc05hbWUgfSkgPT4gKF9qc3goInN2ZyIsIHsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsIGNsYXNzTmFtZTogY2xhc3NOYW1lLCBmaWxsOiAibm9uZSIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogMiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTE5IDdsLS44NjcgMTIuMTQyQTIgMiAwIDAxMTYuMTM4IDIxSDcuODYyYTIgMiAwIDAxLTEuOTk1LTEuODU4TDUgN201IDR2Nm00LTZ2Nm0xLTEwVjRhMSAxIDAgMDAtMS0xaC00YTEgMSAwIDAwLTEgMXYzTTQgN2gxNiIgfSkgfSkpOwpleHBvcnQgY29uc3QgU3BhcmtsZXNJY29uID0gKHsgY2xhc3NOYW1lIH0pID0+IChfanN4KCJzdmciLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCBjbGFzc05hbWU6IGNsYXNzTmFtZSwgZmlsbDogIm5vbmUiLCB2aWV3Qm94OiAiMCAwIDI0IDI0Iiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6IDIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgZDogIk01IDN2NE0zIDVoNE02IDE3djRtLTItMmg0bTUtMTZsMi4yODYgNi44NTdMMjEgMTJsLTUuNzE0IDIuMTQzTDEzIDIxbC0yLjI4Ni02Ljg1N0w1IDEybDUuNzE0LTIuMTQzTDEzIDN6IiB9KSB9KSk7CmV4cG9ydCBjb25zdCBTZWFyY2hJY29uID0gKHsgY2xhc3NOYW1lIH0pID0+IChfanN4KCJzdmciLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCBjbGFzc05hbWU6IGNsYXNzTmFtZSwgZmlsbDogIm5vbmUiLCB2aWV3Qm94OiAiMCAwIDI0IDI0Iiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTIxIDIxbC02LTZtMi01YTcgNyAwIDExLTE0IDAgNyA3IDAgMDExNCAweiIgfSkgfSkpOwpleHBvcnQgY29uc3QgQ2xvc2VJY29uID0gKHsgY2xhc3NOYW1lIH0pID0+IChfanN4KCJzdmciLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCBjbGFzc05hbWU6IGNsYXNzTmFtZSwgZmlsbDogIm5vbmUiLCB2aWV3Qm94OiAiMCAwIDI0IDI0Iiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTYgMThMMTggNk02IDZsMTIgMTIiIH0pIH0pKTsK","@/components/ElementCard":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmNvbnN0IEVsZW1lbnRDYXJkID0gKHsgZWxlbWVudCwgb25Nb3VzZURvd24sIGlzRHJhZ2dpbmcsIGlzQ29tYmluaW5nIH0pID0+IHsKICAgIGNvbnN0IGNhcmRDbGFzc2VzID0gYAogICAgYWJzb2x1dGUgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcC0zIHctNDAgaC0yNCByb3VuZGVkLTJ4bCAKICAgIHNlbGVjdC1ub25lIGN1cnNvci1ncmFiIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTIwMCBlYXNlLW91dAogICAgYmctZ3JheS05MDAvNzAgYmFja2Ryb3AtYmx1ci1zbSBib3JkZXItMiAKICAgIHRleHQtd2hpdGUgc2hhZG93LWxnCiAgICAke2lzRHJhZ2dpbmcgPyAnYm9yZGVyLWN5YW4tMzAwIHNoYWRvdy1jeWFuLTMwMC80MCBzY2FsZS0xMTAgei0zMCBjdXJzb3ItZ3JhYmJpbmcnIDogJ2JvcmRlci1jeWFuLTUwMC81MCBzaGFkb3ctY3lhbi01MDAvMjAnfQogICAgJHtpc0NvbWJpbmluZyA/ICdvcGFjaXR5LTUwIGFuaW1hdGUtcHVsc2UnIDogJ29wYWNpdHktMTAwJ30KICAgICR7ZWxlbWVudC5pc05ldyA/ICdhbmltYXRlLXNjYWxlLWluJyA6ICcnfQogIGA7CiAgICByZXR1cm4gKF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogY2FyZENsYXNzZXMsIHN0eWxlOiB7IGxlZnQ6IGVsZW1lbnQueCwgdG9wOiBlbGVtZW50LnksIGFuaW1hdGlvbjogZWxlbWVudC5pc05ldyA/ICdzY2FsZUluIDAuNXMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpIGZvcndhcmRzJyA6ICdub25lJyB9LCBvbk1vdXNlRG93bjogKGUpID0+IG9uTW91c2VEb3duKGUsIGVsZW1lbnQuaWQpLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC00eGwgbXItMyBwb2ludGVyLWV2ZW50cy1ub25lIiwgY2hpbGRyZW46IGVsZW1lbnQuZW1vamkgfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC1sZyBmb250LWJvbGQgZm9udC1vcmJpdHJvbiBwb2ludGVyLWV2ZW50cy1ub25lIHRydW5jYXRlIiwgY2hpbGRyZW46IGVsZW1lbnQubmFtZSB9KV0gfSkpOwp9OwpleHBvcnQgZGVmYXVsdCBFbGVtZW50Q2FyZDsK","@/components/Sidebar":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMsIEZyYWdtZW50IGFzIF9GcmFnbWVudCB9IGZyb20gInJlYWN0L2pzeC1ydW50aW1lIjsKaW1wb3J0IHsgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7CmltcG9ydCB7IFNlYXJjaEljb24sIENsb3NlSWNvbiB9IGZyb20gJ0AvY29tcG9uZW50cy9pY29ucyc7CmNvbnN0IFNpZGViYXIgPSAoeyBkaXNjb3ZlcmVkRWxlbWVudHMsIG9uRWxlbWVudENsaWNrIH0pID0+IHsKICAgIGNvbnN0IFtzZWFyY2hUZXJtLCBzZXRTZWFyY2hUZXJtXSA9IHVzZVN0YXRlKCcnKTsKICAgIGNvbnN0IFthY3RpdmVUYWIsIHNldEFjdGl2ZVRhYl0gPSB1c2VTdGF0ZSgnZWxlbWVudHMnKTsKICAgIGNvbnN0IGZpbHRlcmVkRWxlbWVudHMgPSBkaXNjb3ZlcmVkRWxlbWVudHMKICAgICAgICAuZmlsdGVyKGVsID0+IGVsLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpKQogICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTsKICAgIGNvbnN0IGZpbHRlcmVkUmVjaXBlcyA9IGRpc2NvdmVyZWRFbGVtZW50cwogICAgICAgIC5maWx0ZXIoZWwgPT4gZWwucmVjaXBlICYmIChlbC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKSB8fAogICAgICAgIGVsLnJlY2lwZS5lbGVtZW50MS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKSkgfHwKICAgICAgICBlbC5yZWNpcGUuZWxlbWVudDIudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpKSkKICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7CiAgICBjb25zdCBUYWJCdXR0b24gPSAoeyB0YWIsIGxhYmVsIH0pID0+IChfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IHNldEFjdGl2ZVRhYih0YWIpLCBjbGFzc05hbWU6IGBmbGV4LTEgcC0yIHRleHQtc20gZm9udC1ib2xkIHVwcGVyY2FzZSB0cmFja2luZy13aWRlciB0cmFuc2l0aW9uLWNvbG9ycyAke2FjdGl2ZVRhYiA9PT0gdGFiID8gJ2JnLWN5YW4tNTAwLzIwIHRleHQtY3lhbi0zMDAnIDogJ3RleHQtZ3JheS00MDAgaG92ZXI6YmctZ3JheS03MDAvNTAnfWAsIGNoaWxkcmVuOiBsYWJlbCB9KSk7CiAgICByZXR1cm4gKF9qc3hzKCJhc2lkZSIsIHsgY2xhc3NOYW1lOiAidy1mdWxsIG1kOnctODAgaC1bMzV2aF0gbWQ6aC1mdWxsIGJnLWJsYWNrLzUwIGJhY2tkcm9wLWJsdXItbGcgYm9yZGVyLWwtMiBib3JkZXItY3lhbi00MDAvMjAgZmxleCBmbGV4LWNvbCIsIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAicC00IGJvcmRlci1iLTIgYm9yZGVyLWN5YW4tNDAwLzIwIiwgY2hpbGRyZW46IFtfanN4KCJoMiIsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIHRleHQtY3lhbi0zMDAgZm9udC1vcmJpdHJvbiIsIGNoaWxkcmVuOiAiRGlzY292ZXJpZXMiIH0pLCBfanN4cygicCIsIHsgY2xhc3NOYW1lOiAidGV4dC1jZW50ZXIgdGV4dC1zbSB0ZXh0LWN5YW4tMTAwLzcwIiwgY2hpbGRyZW46IFtkaXNjb3ZlcmVkRWxlbWVudHMubGVuZ3RoLCAiIGZvdW5kIl0gfSldIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGJvcmRlci1iLTIgYm9yZGVyLWN5YW4tNDAwLzIwIiwgY2hpbGRyZW46IFtfanN4KFRhYkJ1dHRvbiwgeyB0YWI6ICJlbGVtZW50cyIsIGxhYmVsOiAiRWxlbWVudHMiIH0pLCBfanN4KFRhYkJ1dHRvbiwgeyB0YWI6ICJyZWNpcGVzIiwgbGFiZWw6ICJSZWNpcGVzIiB9KV0gfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAicC0yIGJvcmRlci1iLTIgYm9yZGVyLWN5YW4tNDAwLzIwIHN0aWNreSB0b3AtMCBiZy1ncmF5LTkwMC81MCB6LTEwIiwgY2hpbGRyZW46IF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInJlbGF0aXZlIiwgY2hpbGRyZW46IFtfanN4KFNlYXJjaEljb24sIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgbGVmdC0zIHRvcC0xLzIgLXRyYW5zbGF0ZS15LTEvMiB3LTUgaC01IHRleHQtZ3JheS00MDAiIH0pLCBfanN4KCJpbnB1dCIsIHsgdHlwZTogInRleHQiLCBwbGFjZWhvbGRlcjogIlNlYXJjaC4uLiIsIHZhbHVlOiBzZWFyY2hUZXJtLCBvbkNoYW5nZTogKGUpID0+IHNldFNlYXJjaFRlcm0oZS50YXJnZXQudmFsdWUpLCBjbGFzc05hbWU6ICJ3LWZ1bGwgYmctZ3JheS04MDAgYm9yZGVyLTIgYm9yZGVyLWdyYXktNjAwIHJvdW5kZWQtbGcgcGwtMTAgcHItMTAgcHktMiB0ZXh0LXdoaXRlIGZvY3VzOm91dGxpbmUtbm9uZSBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1jeWFuLTQwMCBmb2N1czpib3JkZXItY3lhbi00MDAgdHJhbnNpdGlvbiIgfSksIHNlYXJjaFRlcm0gJiYgKF9qc3goImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gc2V0U2VhcmNoVGVybSgnJyksIGNsYXNzTmFtZTogImFic29sdXRlIHJpZ2h0LTMgdG9wLTEvMiAtdHJhbnNsYXRlLXktMS8yIHRleHQtZ3JheS00MDAgaG92ZXI6dGV4dC13aGl0ZSIsIGNoaWxkcmVuOiBfanN4KENsb3NlSWNvbiwgeyBjbGFzc05hbWU6ICJ3LTUgaC01IiB9KSB9KSldIH0pIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4LWdyb3cgb3ZlcmZsb3cteS1hdXRvIHAtMiIsIGNoaWxkcmVuOiBbYWN0aXZlVGFiID09PSAnZWxlbWVudHMnICYmIChfanN4KF9GcmFnbWVudCwgeyBjaGlsZHJlbjogZmlsdGVyZWRFbGVtZW50cy5sZW5ndGggPiAwID8gKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZ3JpZCBncmlkLWNvbHMtMiBnYXAtMiIsIGNoaWxkcmVuOiBmaWx0ZXJlZEVsZW1lbnRzLm1hcCgoZWwsIGluZGV4KSA9PiAoX2pzeHMoImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gb25FbGVtZW50Q2xpY2soZWwpLCBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLWNlbnRlciBwLTIgYmctZ3JheS04MDAvNTAgcm91bmRlZC1sZyBob3ZlcjpiZy1jeWFuLTUwMC8yMCBib3JkZXIgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1jeWFuLTUwMCB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSIsIGNoaWxkcmVuOiBbX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgbXItMiIsIGNoaWxkcmVuOiBlbC5lbW9qaSB9KSwgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC13aGl0ZSB0ZXh0LXNtIHRydW5jYXRlIiwgY2hpbGRyZW46IGVsLm5hbWUgfSldIH0sIGAke2VsLm5hbWV9LSR7aW5kZXh9YCkpKSB9KSkgOiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNDAwIG10LTggcHgtNCIsIGNoaWxkcmVuOiBfanN4KCJwIiwgeyBjaGlsZHJlbjogIk5vIGVsZW1lbnRzIGZvdW5kLiBEcmFnIGVsZW1lbnRzIGZyb20gdGhlIHdvcmtzcGFjZSB0byBzdGFydCBjb21iaW5pbmchIiB9KSB9KSkgfSkpLCBhY3RpdmVUYWIgPT09ICdyZWNpcGVzJyAmJiAoX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAic3BhY2UteS0yIiwgY2hpbGRyZW46IFtmaWx0ZXJlZFJlY2lwZXMubWFwKChlbCwgaW5kZXgpID0+IGVsLnJlY2lwZSAmJiAoX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAicC0yIGJnLWdyYXktODAwLzUwIHJvdW5kZWQtbGcgdGV4dC1zbSB0ZXh0LWNlbnRlciIsIGNoaWxkcmVuOiBbX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIiwgY2hpbGRyZW46IGVsLnJlY2lwZS5lbGVtZW50MSB9KSwgIiArICIsIF9qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogImZvbnQtYm9sZCIsIGNoaWxkcmVuOiBlbC5yZWNpcGUuZWxlbWVudDIgfSksICIgXHUyMTkyICIsIF9qc3hzKCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWN5YW4tMzAwIGZvbnQtYm9sZCIsIGNoaWxkcmVuOiBbZWwubmFtZSwgIiAiLCBlbC5lbW9qaV0gfSldIH0sIGAke2VsLm5hbWV9LXJlY2lwZS0ke2luZGV4fWApKSksIGZpbHRlcmVkUmVjaXBlcy5sZW5ndGggPT09IDAgJiYgKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC1jZW50ZXIgdGV4dC1ncmF5LTQwMCBtdC04IHB4LTQiLCBjaGlsZHJlbjogX2pzeCgicCIsIHsgY2hpbGRyZW46ICJObyByZWNpcGVzIGZvdW5kLiBDb21iaW5lIGVsZW1lbnRzIHRvIGRpc2NvdmVyIHRoZW0hIiB9KSB9KSldIH0pKV0gfSldIH0pKTsKfTsKZXhwb3J0IGRlZmF1bHQgU2lkZWJhcjsK","@/components/AIPopup":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCB7IHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgU3BhcmtsZXNJY29uLCBDbG9zZUljb24gfSBmcm9tICdAL2NvbXBvbmVudHMvaWNvbnMnOwpjb25zdCBBSVBvcHVwID0gKHsgbWVzc2FnZSwgb25DbG9zZSB9KSA9PiB7CiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIGlmIChtZXNzYWdlKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBvbkNsb3NlKCk7CiAgICAgICAgICAgIH0sIDYwMDApOyAvLyBJbmNyZWFzZWQgZHVyYXRpb24gZm9yIGNvbW1lbnRhcnkKICAgICAgICAgICAgcmV0dXJuICgpID0+IGNsZWFyVGltZW91dCh0aW1lcik7CiAgICAgICAgfQogICAgfSwgW21lc3NhZ2UsIG9uQ2xvc2VdKTsKICAgIGlmICghbWVzc2FnZSkKICAgICAgICByZXR1cm4gbnVsbDsKICAgIGNvbnN0IGNvbG9ycyA9IHsKICAgICAgICBzdWNjZXNzOiB7CiAgICAgICAgICAgIGJnOiAnYmctZ3JlZW4tOTAwLzgwJywKICAgICAgICAgICAgYm9yZGVyOiAnYm9yZGVyLWdyZWVuLTQwMCcsCiAgICAgICAgICAgIHRleHQ6ICd0ZXh0LWdyZWVuLTIwMCcsCiAgICAgICAgICAgIGljb246ICd0ZXh0LWdyZWVuLTMwMCcsCiAgICAgICAgICAgIHRpdGxlOiAndGV4dC13aGl0ZScKICAgICAgICB9LAogICAgICAgIGVycm9yOiB7CiAgICAgICAgICAgIGJnOiAnYmctcmVkLTkwMC84MCcsCiAgICAgICAgICAgIGJvcmRlcjogJ2JvcmRlci1yZWQtNDAwJywKICAgICAgICAgICAgdGV4dDogJ3RleHQtcmVkLTIwMCcsCiAgICAgICAgICAgIGljb246ICd0ZXh0LXJlZC0zMDAnLAogICAgICAgICAgICB0aXRsZTogJ3RleHQtd2hpdGUnCiAgICAgICAgfSwKICAgICAgICBpbmZvOiB7CiAgICAgICAgICAgIGJnOiAnYmctYmx1ZS05MDAvODAnLAogICAgICAgICAgICBib3JkZXI6ICdib3JkZXItYmx1ZS00MDAnLAogICAgICAgICAgICB0ZXh0OiAndGV4dC1ibHVlLTIwMCcsCiAgICAgICAgICAgIGljb246ICd0ZXh0LWJsdWUtMzAwJywKICAgICAgICAgICAgdGl0bGU6ICd0ZXh0LXdoaXRlJwogICAgICAgIH0KICAgIH07CiAgICBjb25zdCB0aGVtZSA9IGNvbG9yc1ttZXNzYWdlLnR5cGVdOwogICAgcmV0dXJuIChfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogYGZpeGVkIHRvcC01IGxlZnQtMS8yIC10cmFuc2xhdGUteC0xLzIgdy1mdWxsIG1heC13LXNtIHAtNCByb3VuZGVkLWxnIHNoYWRvdy0yeGwgYm9yZGVyLTIgYmFja2Ryb3AtYmx1ci1tZCB6LTUwIGFuaW1hdGUtZmFkZS1pbi1kb3duICR7dGhlbWUuYmd9ICR7dGhlbWUuYm9yZGVyfWAsIGNoaWxkcmVuOiBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IiwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXgtc2hyaW5rLTAiLCBjaGlsZHJlbjogX2pzeChTcGFya2xlc0ljb24sIHsgY2xhc3NOYW1lOiBgaC02IHctNiAke3RoZW1lLmljb259YCB9KSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAibWwtMyB3LTAgZmxleC0xIiwgY2hpbGRyZW46IFtfanN4KCJwIiwgeyBjbGFzc05hbWU6IGB0ZXh0LWxnIGZvbnQtYm9sZCBmb250LW9yYml0cm9uICR7dGhlbWUudGl0bGV9YCwgY2hpbGRyZW46IG1lc3NhZ2UudGl0bGUgfSksIF9qc3goInAiLCB7IGNsYXNzTmFtZTogYG10LTEgdGV4dC1zbSAke3RoZW1lLnRleHR9YCwgY2hpbGRyZW46IG1lc3NhZ2UudGV4dCB9KSwgbWVzc2FnZS5jb21tZW50YXJ5ICYmIChfanN4cygicCIsIHsgY2xhc3NOYW1lOiBgbXQtMiB0ZXh0LXNtIGl0YWxpYyBib3JkZXItbC0yIHBsLTIgJHt0aGVtZS5ib3JkZXJ9ICR7dGhlbWUudGV4dH1gLCBjaGlsZHJlbjogWyJcIiIsIG1lc3NhZ2UuY29tbWVudGFyeSwgIlwiIl0gfSkpXSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJtbC00IGZsZXgtc2hyaW5rLTAgZmxleCIsIGNoaWxkcmVuOiBfanN4cygiYnV0dG9uIiwgeyBvbkNsaWNrOiBvbkNsb3NlLCBjbGFzc05hbWU6ICJpbmxpbmUtZmxleCByb3VuZGVkLW1kIHRleHQtZ3JheS0zMDAgaG92ZXI6dGV4dC13aGl0ZSBmb2N1czpvdXRsaW5lLW5vbmUgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctb2Zmc2V0LTIgZm9jdXM6cmluZy1jeWFuLTUwMCIsIGNoaWxkcmVuOiBbX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAic3Itb25seSIsIGNoaWxkcmVuOiAiQ2xvc2UiIH0pLCBfanN4KENsb3NlSWNvbiwgeyBjbGFzc05hbWU6ICJoLTUgdy01IiB9KV0gfSkgfSldIH0pIH0pKTsKfTsKZXhwb3J0IGRlZmF1bHQgQUlQb3B1cDsK","@/components/Loader":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmNvbnN0IExvYWRlciA9ICgpID0+IHsKICAgIHJldHVybiAoX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZml4ZWQgaW5zZXQtMCBiZy1ibGFjay83MCBiYWNrZHJvcC1ibHVyLXNtIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHotNTAiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAidy0xNiBoLTE2IGJvcmRlci00IGJvcmRlci1jeWFuLTQwMCBib3JkZXItdC10cmFuc3BhcmVudCByb3VuZGVkLWZ1bGwgYW5pbWF0ZS1zcGluIiB9KSwgX2pzeCgicCIsIHsgY2xhc3NOYW1lOiAibXQtNCB0ZXh0LXhsIHRleHQtd2hpdGUgZm9udC1vcmJpdHJvbiB0cmFja2luZy13aWRlc3QgYW5pbWF0ZS1wdWxzZSIsIGNoaWxkcmVuOiAiQ29tYmluaW5nLi4uIiB9KV0gfSkpOwp9OwpleHBvcnQgZGVmYXVsdCBMb2FkZXI7Cg==","@/App":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCB7IHVzZVN0YXRlLCB1c2VSZWYsIHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7CmltcG9ydCBFbGVtZW50Q2FyZCBmcm9tICdAL2NvbXBvbmVudHMvRWxlbWVudENhcmQnOwppbXBvcnQgU2lkZWJhciBmcm9tICdAL2NvbXBvbmVudHMvU2lkZWJhcic7CmltcG9ydCBMb2FkZXIgZnJvbSAnQC9jb21wb25lbnRzL0xvYWRlcic7CmltcG9ydCBBSVBvcHVwIGZyb20gJ0AvY29tcG9uZW50cy9BSVBvcHVwJzsKaW1wb3J0IHsgY29tYmluZUVsZW1lbnRzIH0gZnJvbSAnQC9zZXJ2aWNlcy9nZW1pbmlTZXJ2aWNlJzsKaW1wb3J0IHsgVHJhc2hJY29uLCBTcGFya2xlc0ljb24gfSBmcm9tICdAL2NvbXBvbmVudHMvaWNvbnMnOwpjb25zdCBpbml0aWFsRWxlbWVudHMgPSBbCiAgICB7IG5hbWU6ICdXYXRlcicsIGVtb2ppOiAn8J+SpycgfSwKICAgIHsgbmFtZTogJ0ZpcmUnLCBlbW9qaTogJ/CflKUnIH0sCiAgICB7IG5hbWU6ICdFYXJ0aCcsIGVtb2ppOiAn8J+MjScgfSwKICAgIHsgbmFtZTogJ0FpcicsIGVtb2ppOiAn8J+SqCcgfSwKXTsKY29uc3QgY2hhbGxlbmdlVGllcnMgPSBbCiAgICAvLyBUaWVyIDEgKExldmVscyAxLTIpIC0gQmFzaWMgY29tYmluYXRpb25zCiAgICBbeyBuYW1lOiAnU3RlYW0nLCBlbW9qaTogJ+KZqO+4jycgfSwgeyBuYW1lOiAnRHVzdCcsIGVtb2ppOiAn8J+MrO+4jycgfSwgeyBuYW1lOiAnUmFpbicsIGVtb2ppOiAn8J+Mp++4jycgfSwgeyBuYW1lOiAnTGF2YScsIGVtb2ppOiAn8J+MiycgfV0sCiAgICAvLyBUaWVyIDIgKExldmVscyAzLTUpIC0gUmVxdWlyZXMgb25lIG9mIHRoZSBhYm92ZQogICAgW3sgbmFtZTogJ1N0b25lJywgZW1vamk6ICfwn6qoJyB9LCB7IG5hbWU6ICdQbGFudCcsIGVtb2ppOiAn8J+MsScgfSwgeyBuYW1lOiAnU21va2UnLCBlbW9qaTogJ/CfjKvvuI8nIH0sIHsgbmFtZTogJ09ic2lkaWFuJywgZW1vamk6ICfwn5akJyB9XSwKICAgIC8vIFRpZXIgMyAoTGV2ZWxzIDYtOCkgLSBSZXF1aXJlcyB0d28tc3RlcCBjb21iaW5hdGlvbnMKICAgIFt7IG5hbWU6ICdNdWQnLCBlbW9qaTogJ/CfkqknIH0sIHsgbmFtZTogJ0JyaWNrJywgZW1vamk6ICfwn6exJyB9LCB7IG5hbWU6ICdHcmFzcycsIGVtb2ppOiAn8J+MvicgfSwgeyBuYW1lOiAnU2FuZCcsIGVtb2ppOiAn8J+Plu+4jycgfV0sCiAgICAvLyBUaWVyIDQgKExldmVscyA5LTEyKSAtIE1vcmUgY29tcGxleCBpdGVtcwogICAgW3sgbmFtZTogJ01ldGFsJywgZW1vamk6ICfwn5SpJyB9LCB7IG5hbWU6ICdHbGFzcycsIGVtb2ppOiAn8J+lgycgfSwgeyBuYW1lOiAnV2FsbCcsIGVtb2ppOiAn8J+nsScgfSwgeyBuYW1lOiAnTGlnaHRuaW5nJywgZW1vamk6ICfimqEnIH1dLAogICAgLy8gVGllciA1IChMZXZlbHMgMTMrKSAtIEFkdmFuY2VkIGNvbmNlcHRzCiAgICBbeyBuYW1lOiAnSG91c2UnLCBlbW9qaTogJ/Cfj6AnIH0sIHsgbmFtZTogJ0VsZWN0cmljaXR5JywgZW1vamk6ICfwn5KhJyB9LCB7IG5hbWU6ICdIdW1hbicsIGVtb2ppOiAn8J+njScgfSwgeyBuYW1lOiAnUGhvZW5peCcsIGVtb2ppOiAn8J+QpuKAjfCflKUnIH1dCl07CmNvbnN0IERJU0NPVkVSRURfRUxFTUVOVFNfS0VZID0gJ2dlbmNyYWZ0X2Rpc2NvdmVyZWRFbGVtZW50cyc7CmNvbnN0IENIQUxMRU5HRV9MRVZFTF9LRVkgPSAnZ2VuY3JhZnRfY2hhbGxlbmdlTGV2ZWwnOwpjb25zdCBBcHAgPSAoKSA9PiB7CiAgICBjb25zdCBbZ2FtZU1vZGUsIHNldEdhbWVNb2RlXSA9IHVzZVN0YXRlKCdtZW51Jyk7CiAgICBjb25zdCBbd29ya3NwYWNlRWxlbWVudHMsIHNldFdvcmtzcGFjZUVsZW1lbnRzXSA9IHVzZVN0YXRlKFtdKTsKICAgIGNvbnN0IFtkaXNjb3ZlcmVkRWxlbWVudHMsIHNldERpc2NvdmVyZWRFbGVtZW50c10gPSB1c2VTdGF0ZSgoKSA9PiBpbml0aWFsRWxlbWVudHMpOwogICAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgIGNvbnN0IFtwb3B1cE1lc3NhZ2UsIHNldFBvcHVwTWVzc2FnZV0gPSB1c2VTdGF0ZShudWxsKTsKICAgIGNvbnN0IFtjb21iaW5pbmdFbGVtZW50SWRzLCBzZXRDb21iaW5pbmdFbGVtZW50SWRzXSA9IHVzZVN0YXRlKFtdKTsKICAgIGNvbnN0IFtzaG93Q2hhbGxlbmdlUHJvbXB0LCBzZXRTaG93Q2hhbGxlbmdlUHJvbXB0XSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgIGNvbnN0IFtjaGFsbGVuZ2VTdGF0ZSwgc2V0Q2hhbGxlbmdlU3RhdGVdID0gdXNlU3RhdGUoeyBsZXZlbDogMCwgdGFyZ2V0OiBudWxsLCBzdGFydFRpbWU6IDAsIHRpbWVyOiAnMDA6MDAnLCBpc0FjdGl2ZTogZmFsc2UgfSk7CiAgICBjb25zdCBbcGFydGljbGVCdXJzdCwgc2V0UGFydGljbGVCdXJzdF0gPSB1c2VTdGF0ZShudWxsKTsKICAgIGNvbnN0IGRyYWdnaW5nSW5mbyA9IHVzZVJlZih7IGlkOiBudWxsLCBvZmZzZXRYOiAwLCBvZmZzZXRZOiAwIH0pOwogICAgY29uc3QgbmV4dElkID0gdXNlUmVmKDApOwogICAgY29uc3Qgd29ya3NwYWNlUmVmID0gdXNlUmVmKG51bGwpOwogICAgY29uc3QgdGltZXJJbnRlcnZhbFJlZiA9IHVzZVJlZihudWxsKTsKICAgIC8vIExvYWQgcHJvZ3Jlc3MgZnJvbSBsb2NhbFN0b3JhZ2Ugb24gaW5pdGlhbCBtb3VudAogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICBjb25zdCBzYXZlZERpc2NvdmVyaWVzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oRElTQ09WRVJFRF9FTEVNRU5UU19LRVkpOwogICAgICAgIGlmIChzYXZlZERpc2NvdmVyaWVzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHNhdmVkRGlzY292ZXJpZXMpOwogICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyc2VkKSAmJiBwYXJzZWQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHNldERpc2NvdmVyZWRFbGVtZW50cyhwYXJzZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gcGFyc2Ugc2F2ZWQgZGlzY292ZXJpZXMiLCBlKTsKICAgICAgICAgICAgICAgIHNldERpc2NvdmVyZWRFbGVtZW50cyhpbml0aWFsRWxlbWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwgW10pOwogICAgLy8gU2F2ZSBkaXNjb3ZlcmVkIGVsZW1lbnRzIHRvIGxvY2FsU3RvcmFnZQogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAvLyBXZSBvbmx5IHNhdmUgaW4gZnJlZSBwbGF5IG1vZGUgdG8gbm90IGludGVyZmVyZSB3aXRoIGNoYWxsZW5nZSBtb2RlJ3MgY2xlYW4gc2xhdGUuCiAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnZnJlZScgJiYgZGlzY292ZXJlZEVsZW1lbnRzLmxlbmd0aCA+IGluaXRpYWxFbGVtZW50cy5sZW5ndGgpIHsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oRElTQ09WRVJFRF9FTEVNRU5UU19LRVksIEpTT04uc3RyaW5naWZ5KGRpc2NvdmVyZWRFbGVtZW50cykpOwogICAgICAgIH0KICAgIH0sIFtkaXNjb3ZlcmVkRWxlbWVudHMsIGdhbWVNb2RlXSk7CiAgICAvLyBTYXZlIGNoYWxsZW5nZSBsZXZlbCB0byBsb2NhbFN0b3JhZ2UKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJyAmJiBjaGFsbGVuZ2VTdGF0ZS5sZXZlbCA+IDAgJiYgY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIFNhdmUgbGV2ZWwgd2hlbiBhIGNoYWxsZW5nZSBpcyBjb21wbGV0ZWQgYnV0IHRoZSBuZXh0IG9uZSBoYXNuJ3Qgc3RhcnRlZAogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShDSEFMTEVOR0VfTEVWRUxfS0VZLCBKU09OLnN0cmluZ2lmeShjaGFsbGVuZ2VTdGF0ZS5sZXZlbCkpOwogICAgICAgIH0KICAgIH0sIFtjaGFsbGVuZ2VTdGF0ZS5sZXZlbCwgY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUsIGdhbWVNb2RlXSk7CiAgICBjb25zdCBzcGF3bkVsZW1lbnQgPSB1c2VDYWxsYmFjaygoZWxlbWVudCwgeCwgeSwgaXNOZXcgPSB0cnVlKSA9PiB7CiAgICAgICAgY29uc3Qgd29ya3NwYWNlQm91bmRzID0gd29ya3NwYWNlUmVmLmN1cnJlbnQ/LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIGNvbnN0IG5ld1ggPSB4ID8/ICh3b3Jrc3BhY2VCb3VuZHMgPyBNYXRoLnJhbmRvbSgpICogKHdvcmtzcGFjZUJvdW5kcy53aWR0aCAtIDIwMCkgKyAyMCA6IDIwMCk7CiAgICAgICAgY29uc3QgbmV3WSA9IHkgPz8gKHdvcmtzcGFjZUJvdW5kcyA/IE1hdGgucmFuZG9tKCkgKiAod29ya3NwYWNlQm91bmRzLmhlaWdodCAtIDE1MCkgKyAyMCA6IDIwMCk7CiAgICAgICAgc2V0V29ya3NwYWNlRWxlbWVudHMocHJldiA9PiBbCiAgICAgICAgICAgIC4uLnByZXYsCiAgICAgICAgICAgIHsgLi4uZWxlbWVudCwgaWQ6IG5leHRJZC5jdXJyZW50KyssIHg6IG5ld1gsIHk6IG5ld1ksIGlzTmV3IH0sCiAgICAgICAgXSk7CiAgICB9LCBbXSk7CiAgICBjb25zdCByZXNldFdvcmtzcGFjZSA9IHVzZUNhbGxiYWNrKChzcGF3bkluaXRpYWwgPSB0cnVlKSA9PiB7CiAgICAgICAgc2V0V29ya3NwYWNlRWxlbWVudHMoW10pOwogICAgICAgIGlmIChzcGF3bkluaXRpYWwgJiYgd29ya3NwYWNlUmVmLmN1cnJlbnQpIHsKICAgICAgICAgICAgY29uc3QgYm91bmRzID0gd29ya3NwYWNlUmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGNvbnN0IGNlbnRlclggPSBib3VuZHMud2lkdGggLyAyOwogICAgICAgICAgICBjb25zdCBjZW50ZXJZID0gYm91bmRzLmhlaWdodCAvIDI7CiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRXaWR0aCA9IDE2MDsKICAgICAgICAgICAgY29uc3QgZWxlbWVudEhlaWdodCA9IDk2OwogICAgICAgICAgICBjb25zdCBnYXAgPSA0MDsKICAgICAgICAgICAgY29uc3QgcG9zaXRpb25zID0gWwogICAgICAgICAgICAgICAgeyB4OiBjZW50ZXJYIC0gZWxlbWVudFdpZHRoIC0gZ2FwIC8gMiwgeTogY2VudGVyWSAtIGVsZW1lbnRIZWlnaHQgLSBnYXAgLyAyIH0sCiAgICAgICAgICAgICAgICB7IHg6IGNlbnRlclggKyBnYXAgLyAyLCB5OiBjZW50ZXJZIC0gZWxlbWVudEhlaWdodCAtIGdhcCAvIDIgfSwKICAgICAgICAgICAgICAgIHsgeDogY2VudGVyWCAtIGVsZW1lbnRXaWR0aCAtIGdhcCAvIDIsIHk6IGNlbnRlclkgKyBnYXAgLyAyIH0sCiAgICAgICAgICAgICAgICB7IHg6IGNlbnRlclggKyBnYXAgLyAyLCB5OiBjZW50ZXJZICsgZ2FwIC8gMiB9LAogICAgICAgICAgICBdOwogICAgICAgICAgICBpbml0aWFsRWxlbWVudHMuZm9yRWFjaCgoZWwsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocG9zaXRpb25zW2luZGV4XSkgewogICAgICAgICAgICAgICAgICAgIHNwYXduRWxlbWVudChlbCwgcG9zaXRpb25zW2luZGV4XS54LCBwb3NpdGlvbnNbaW5kZXhdLnksIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSwgW3NwYXduRWxlbWVudF0pOwogICAgY29uc3Qgc3RhcnROZXh0TGV2ZWwgPSB1c2VDYWxsYmFjaygoY3VycmVudExldmVsKSA9PiB7CiAgICAgICAgY29uc3QgbmV4dExldmVsID0gY3VycmVudExldmVsICsgMTsKICAgICAgICAvLyBEZXRlcm1pbmUgdGllciBiYXNlZCBvbiBsZXZlbCwgZW5zdXJpbmcgaXQgZG9lc24ndCBleGNlZWQgYXZhaWxhYmxlIHRpZXJzCiAgICAgICAgY29uc3QgdGllckluZGV4ID0gTWF0aC5taW4oTWF0aC5mbG9vcigobmV4dExldmVsIC0gMSkgLyAyKSwgY2hhbGxlbmdlVGllcnMubGVuZ3RoIC0gMSk7CiAgICAgICAgY29uc3QgdGllciA9IGNoYWxsZW5nZVRpZXJzW3RpZXJJbmRleF07CiAgICAgICAgLy8gU2VsZWN0IGEgcmFuZG9tIGVsZW1lbnQgZnJvbSB0aGUgY3VycmVudCB0aWVyCiAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGllcltNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aWVyLmxlbmd0aCldOwogICAgICAgIHNldENoYWxsZW5nZVN0YXRlKHsKICAgICAgICAgICAgbGV2ZWw6IG5leHRMZXZlbCwKICAgICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgICBzdGFydFRpbWU6IERhdGUubm93KCksCiAgICAgICAgICAgIHRpbWVyOiAnMDA6MDAnLAogICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHJlc2V0V29ya3NwYWNlKCk7CiAgICB9LCBbcmVzZXRXb3Jrc3BhY2VdKTsKICAgIGNvbnN0IHN0YXJ0RnJlZVBsYXkgPSAoKSA9PiB7CiAgICAgICAgc2V0R2FtZU1vZGUoJ2ZyZWUnKTsKICAgICAgICByZXNldFdvcmtzcGFjZSgpOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZUNoYWxsZW5nZVN0YXJ0UmVxdWVzdCA9ICgpID0+IHsKICAgICAgICBjb25zdCBzYXZlZExldmVsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ0hBTExFTkdFX0xFVkVMX0tFWSk7CiAgICAgICAgaWYgKHNhdmVkTGV2ZWwgJiYgcGFyc2VJbnQoc2F2ZWRMZXZlbCwgMTApID4gMCkgewogICAgICAgICAgICBzZXRTaG93Q2hhbGxlbmdlUHJvbXB0KHRydWUpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSgpOwogICAgICAgIH0KICAgIH07CiAgICBjb25zdCBoYW5kbGVDb250aW51ZUNoYWxsZW5nZSA9ICgpID0+IHsKICAgICAgICBjb25zdCBzYXZlZExldmVsID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oQ0hBTExFTkdFX0xFVkVMX0tFWSkgfHwgJzAnLCAxMCk7CiAgICAgICAgc2V0R2FtZU1vZGUoJ2NoYWxsZW5nZScpOwogICAgICAgIC8vIEltcG9ydGFudDogUmVzZXQgZGlzY292ZXJpZXMgdG8gaW5pdGlhbCBmb3IgYSBmYWlyIGNoYWxsZW5nZSBzdGFydAogICAgICAgIHNldERpc2NvdmVyZWRFbGVtZW50cyhpbml0aWFsRWxlbWVudHMpOwogICAgICAgIHN0YXJ0TmV4dExldmVsKHNhdmVkTGV2ZWwpOyAvLyBDb250aW51ZSBmcm9tIHRoZSBuZXh0IGxldmVsCiAgICAgICAgc2V0U2hvd0NoYWxsZW5nZVByb21wdChmYWxzZSk7CiAgICB9OwogICAgY29uc3QgaGFuZGxlTmV3Q2hhbGxlbmdlR2FtZSA9ICgpID0+IHsKICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShDSEFMTEVOR0VfTEVWRUxfS0VZKTsKICAgICAgICBzZXRHYW1lTW9kZSgnY2hhbGxlbmdlJyk7CiAgICAgICAgc2V0RGlzY292ZXJlZEVsZW1lbnRzKGluaXRpYWxFbGVtZW50cyk7CiAgICAgICAgc3RhcnROZXh0TGV2ZWwoMCk7IC8vIFN0YXJ0IGZyb20gbGV2ZWwgMQogICAgICAgIHNldFNob3dDaGFsbGVuZ2VQcm9tcHQoZmFsc2UpOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZUVuZEdhbWUgPSAoKSA9PiB7CiAgICAgICAgc2V0R2FtZU1vZGUoJ21lbnUnKTsKICAgICAgICBzZXRXb3Jrc3BhY2VFbGVtZW50cyhbXSk7CiAgICAgICAgaWYgKGNoYWxsZW5nZVN0YXRlLmlzQWN0aXZlKSB7CiAgICAgICAgICAgIHNldENoYWxsZW5nZVN0YXRlKHMgPT4gKHsgLi4ucywgaXNBY3RpdmU6IGZhbHNlLCBsZXZlbDogMCB9KSk7CiAgICAgICAgfQogICAgfTsKICAgIGNvbnN0IHBlcmZvcm1Db21iaW5hdGlvbiA9IHVzZUNhbGxiYWNrKGFzeW5jIChlbGVtZW50MSwgZWxlbWVudDIpID0+IHsKICAgICAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7CiAgICAgICAgc2V0Q29tYmluaW5nRWxlbWVudElkcyhbZWxlbWVudDEuaWQsIGVsZW1lbnQyLmlkXSk7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tYmluZUVsZW1lbnRzKGVsZW1lbnQxLCBlbGVtZW50Mik7CiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuaXNOZXcpIHsKICAgICAgICAgICAgY29uc3QgaXNGaXJzdERpc2NvdmVyeSA9ICFkaXNjb3ZlcmVkRWxlbWVudHMuc29tZShkID0+IGQubmFtZSA9PT0gcmVzdWx0Lm5hbWUpOwogICAgICAgICAgICBjb25zdCBuZXdFbGVtZW50ID0geyBuYW1lOiByZXN1bHQubmFtZSwgZW1vamk6IHJlc3VsdC5lbW9qaSB9OwogICAgICAgICAgICBpZiAoaXNGaXJzdERpc2NvdmVyeSkgewogICAgICAgICAgICAgICAgc2V0RGlzY292ZXJlZEVsZW1lbnRzKHByZXYgPT4gWy4uLnByZXYsIHsgLi4ubmV3RWxlbWVudCwgcmVjaXBlOiB7IGVsZW1lbnQxOiBlbGVtZW50MS5uYW1lLCBlbGVtZW50MjogZWxlbWVudDIubmFtZSB9IH1dKTsKICAgICAgICAgICAgICAgIHNldFBvcHVwTWVzc2FnZSh7IHR5cGU6ICdzdWNjZXNzJywgdGl0bGU6ICdGaXJzdCBEaXNjb3ZlcnkhJywgdGV4dDogYFlvdSd2ZSBjcmVhdGVkICR7cmVzdWx0Lm5hbWV9ICR7cmVzdWx0LmVtb2ppfSFgLCBjb21tZW50YXJ5OiByZXN1bHQuY29tbWVudGFyeSB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHNldFBvcHVwTWVzc2FnZSh7IHR5cGU6ICdpbmZvJywgdGl0bGU6ICdOZXcgRWxlbWVudCEnLCB0ZXh0OiBgWW91IG1hZGUgJHtyZXN1bHQubmFtZX0gJHtyZXN1bHQuZW1vaml9IWAsIGNvbW1lbnRhcnk6IHJlc3VsdC5jb21tZW50YXJ5IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHNwYXduWCA9IChlbGVtZW50MS54ICsgZWxlbWVudDIueCkgLyAyOwogICAgICAgICAgICBjb25zdCBzcGF3blkgPSAoZWxlbWVudDEueSArIGVsZW1lbnQyLnkpIC8gMjsKICAgICAgICAgICAgc3Bhd25FbGVtZW50KG5ld0VsZW1lbnQsIHNwYXduWCwgc3Bhd25ZKTsKICAgICAgICAgICAgc2V0UGFydGljbGVCdXJzdCh7IHg6IHNwYXduWCArIDgwLCB5OiBzcGF3blkgKyA0OCwga2V5OiBEYXRlLm5vdygpIH0pOwogICAgICAgICAgICBzZXRXb3Jrc3BhY2VFbGVtZW50cyhwcmV2ID0+IHByZXYuZmlsdGVyKGVsID0+IGVsLmlkICE9PSBlbGVtZW50MS5pZCAmJiBlbC5pZCAhPT0gZWxlbWVudDIuaWQpKTsKICAgICAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnY2hhbGxlbmdlJyAmJiByZXN1bHQubmFtZSA9PT0gY2hhbGxlbmdlU3RhdGUudGFyZ2V0Py5uYW1lKSB7CiAgICAgICAgICAgICAgICBzZXRDaGFsbGVuZ2VTdGF0ZShzID0+ICh7IC4uLnMsIGlzQWN0aXZlOiBmYWxzZSB9KSk7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lVGFrZW4gPSAoRGF0ZS5ub3coKSAtIGNoYWxsZW5nZVN0YXRlLnN0YXJ0VGltZSkgLyAxMDAwOwogICAgICAgICAgICAgICAgLy8gVGllci1iYXNlZCB0aW1lIGdvYWxzIGZvciByYW5rcwogICAgICAgICAgICAgICAgY29uc3QgdGllckluZGV4ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoY2hhbGxlbmdlU3RhdGUubGV2ZWwgLSAxKSAvIDIpLCBjaGFsbGVuZ2VUaWVycy5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICAgIGNvbnN0IGdvbGRUaW1lID0gMTAgKyB0aWVySW5kZXggKiA1OyAvLyBlLmcuIFRpZXIgMTogMTVzLCBUaWVyIDI6IDIwcwogICAgICAgICAgICAgICAgY29uc3Qgc2lsdmVyVGltZSA9IDIwICsgdGllckluZGV4ICogMTA7IC8vIGUuZy4gVGllciAxOiAzMHMsIFRpZXIgMjogNDBzCiAgICAgICAgICAgICAgICBsZXQgcmFuayA9ICdCcm9uemUg8J+liSc7CiAgICAgICAgICAgICAgICBpZiAodGltZVRha2VuIDwgZ29sZFRpbWUpCiAgICAgICAgICAgICAgICAgICAgcmFuayA9ICdHb2xkIPCfpYcnOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodGltZVRha2VuIDwgc2lsdmVyVGltZSkKICAgICAgICAgICAgICAgICAgICByYW5rID0gJ1NpbHZlciDwn6WIJzsKICAgICAgICAgICAgICAgIHNldFBvcHVwTWVzc2FnZSh7IHR5cGU6ICdzdWNjZXNzJywgdGl0bGU6IGBMZXZlbCAke2NoYWxsZW5nZVN0YXRlLmxldmVsfSBDb21wbGV0ZSFgLCB0ZXh0OiBgUmFuazogJHtyYW5rfSB8IFRpbWU6ICR7dGltZVRha2VuLnRvRml4ZWQoMSl9c2AgfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHN0YXJ0TmV4dExldmVsKGNoYWxsZW5nZVN0YXRlLmxldmVsKSwgNDAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IHJlc3VsdCA/IGBDb21iaW5pbmcgJHtlbGVtZW50MS5uYW1lfSBhbmQgJHtlbGVtZW50Mi5uYW1lfSByZXN1bHRzIGluICR7cmVzdWx0Lm5hbWV9LiBOb3RoaW5nIG5ldyBjcmVhdGVkLmAgOiAiVGhvc2UgZWxlbWVudHMgZG9uJ3Qgc2VlbSB0byBjb21iaW5lIHdlbGwuIjsKICAgICAgICAgICAgc2V0UG9wdXBNZXNzYWdlKHsgdHlwZTogJ2Vycm9yJywgdGl0bGU6ICdObyBSZWFjdGlvbicsIHRleHQ6IHJlYXNvbiB9KTsKICAgICAgICB9CiAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTsKICAgICAgICBzZXRDb21iaW5pbmdFbGVtZW50SWRzKFtdKTsKICAgIH0sIFtkaXNjb3ZlcmVkRWxlbWVudHMsIGdhbWVNb2RlLCBjaGFsbGVuZ2VTdGF0ZSwgc3Bhd25FbGVtZW50LCBzdGFydE5leHRMZXZlbF0pOwogICAgY29uc3QgaGFuZGxlTW91c2VEb3duID0gdXNlQ2FsbGJhY2soKGUsIGlkKSA9PiB7CiAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnbWVudScpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCBlbGVtZW50ID0gd29ya3NwYWNlRWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gaWQpOwogICAgICAgIGlmIChlbGVtZW50ICYmIHdvcmtzcGFjZVJlZi5jdXJyZW50KSB7CiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZVJlY3QgPSB3b3Jrc3BhY2VSZWYuY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgY29uc3QgcmVjdCA9IGUuY3VycmVudFRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgZHJhZ2dpbmdJbmZvLmN1cnJlbnQgPSB7CiAgICAgICAgICAgICAgICBpZCwKICAgICAgICAgICAgICAgIG9mZnNldFg6IGUuY2xpZW50WCAtIHJlY3QubGVmdCwKICAgICAgICAgICAgICAgIG9mZnNldFk6IGUuY2xpZW50WSAtIHJlY3QudG9wLAogICAgICAgICAgICB9OwogICAgICAgICAgICBzZXRXb3Jrc3BhY2VFbGVtZW50cyhwcmV2ID0+IFsuLi5wcmV2LmZpbHRlcihlbCA9PiBlbC5pZCAhPT0gaWQpLCBlbGVtZW50XSk7CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZU1vdXNlTW92ZSA9IChtb3ZlRXZlbnQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChkcmFnZ2luZ0luZm8uY3VycmVudC5pZCA9PT0gbnVsbCB8fCAhd29ya3NwYWNlUmVmLmN1cnJlbnQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgeCA9IG1vdmVFdmVudC5jbGllbnRYIC0gd29ya3NwYWNlUmVjdC5sZWZ0IC0gZHJhZ2dpbmdJbmZvLmN1cnJlbnQub2Zmc2V0WDsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBtb3ZlRXZlbnQuY2xpZW50WSAtIHdvcmtzcGFjZVJlY3QudG9wIC0gZHJhZ2dpbmdJbmZvLmN1cnJlbnQub2Zmc2V0WTsKICAgICAgICAgICAgICAgIHNldFdvcmtzcGFjZUVsZW1lbnRzKHByZXYgPT4gcHJldi5tYXAoZWwgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChlbC5pZCAhPT0gZHJhZ2dpbmdJbmZvLmN1cnJlbnQuaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkcmFnZ2VkUmVjdCA9IHsgeCwgeSwgd2lkdGg6IDE2MCwgaGVpZ2h0OiA5NiB9OwogICAgICAgICAgICAgICAgICAgIGxldCBzaG91bGRDb21iaW5lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBvdGhlckVsIG9mIHByZXYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyRWwuaWQgPT09IGRyYWdnaW5nSW5mby5jdXJyZW50LmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsUmVjdCA9IHsgeDogb3RoZXJFbC54LCB5OiBvdGhlckVsLnksIHdpZHRoOiAxNjAsIGhlaWdodDogOTYgfTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRyYWdnZWRSZWN0LnggPCBlbFJlY3QueCArIGVsUmVjdC53aWR0aCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dlZFJlY3QueCArIGRyYWdnZWRSZWN0LndpZHRoID4gZWxSZWN0LnggJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnZWRSZWN0LnkgPCBlbFJlY3QueSArIGVsUmVjdC5oZWlnaHQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnZWRSZWN0LnkgKyBkcmFnZ2VkUmVjdC5oZWlnaHQgPiBlbFJlY3QueSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkQ29tYmluZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJmb3JtQ29tYmluYXRpb24oeyAuLi5lbCwgeCwgeSB9LCBvdGhlckVsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRDb21iaW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIHRoZSByZW1vdmFsIG9mIHRoZSBlbGVtZW50IGluIHBlcmZvcm1Db21iaW5hdGlvbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5lbCwgeCwgeSB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5lbCwgeCwgeSB9OwogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBoYW5kbGVNb3VzZVVwID0gKCkgPT4gewogICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgaGFuZGxlTW91c2VNb3ZlKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBoYW5kbGVNb3VzZVVwKTsKICAgICAgICAgICAgICAgIGRyYWdnaW5nSW5mby5jdXJyZW50LmlkID0gbnVsbDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgaGFuZGxlTW91c2VNb3ZlKTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGhhbmRsZU1vdXNlVXApOwogICAgICAgIH0KICAgIH0sIFt3b3Jrc3BhY2VFbGVtZW50cywgZ2FtZU1vZGUsIHBlcmZvcm1Db21iaW5hdGlvbl0pOwogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICBpZiAoY2hhbGxlbmdlU3RhdGUuaXNBY3RpdmUpIHsKICAgICAgICAgICAgdGltZXJJbnRlcnZhbFJlZi5jdXJyZW50ID0gd2luZG93LnNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gY2hhbGxlbmdlU3RhdGUuc3RhcnRUaW1lKSAvIDEwMDApOwogICAgICAgICAgICAgICAgY29uc3QgbWlucyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDYwKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgICAgICAgICBjb25zdCBzZWNzID0gKHNlY29uZHMgJSA2MCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgICAgICAgc2V0Q2hhbGxlbmdlU3RhdGUocyA9PiAoeyAuLi5zLCB0aW1lcjogYCR7bWluc306JHtzZWNzfWAgfSkpOwogICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAodGltZXJJbnRlcnZhbFJlZi5jdXJyZW50KSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXJJbnRlcnZhbFJlZi5jdXJyZW50KTsKICAgICAgICAgICAgdGltZXJJbnRlcnZhbFJlZi5jdXJyZW50ID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgaWYgKHRpbWVySW50ZXJ2YWxSZWYuY3VycmVudCkgewogICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsUmVmLmN1cnJlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0sIFtjaGFsbGVuZ2VTdGF0ZS5pc0FjdGl2ZSwgY2hhbGxlbmdlU3RhdGUuc3RhcnRUaW1lXSk7CiAgICBjb25zdCBHYW1lTWVudSA9ICgpID0+IChfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGluc2V0LTAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcG9pbnRlci1ldmVudHMtbm9uZSIsIGNoaWxkcmVuOiBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWNlbnRlciBwLTggYmctYmxhY2svNTAgcm91bmRlZC14bCBwb2ludGVyLWV2ZW50cy1hdXRvIiwgY2hpbGRyZW46IFtfanN4KCJoMSIsIHsgY2xhc3NOYW1lOiAidGV4dC00eGwgZm9udC1ib2xkIGZvbnQtb3JiaXRyb24gdGV4dC1jeWFuLTMwMCIsIGNoaWxkcmVuOiAiZ2VuY3JhZnQiIH0pLCBfanN4KCJwIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWdyYXktNDAwIG10LTIgbWItNiIsIGNoaWxkcmVuOiAiQ2hvb3NlIHlvdXIgZ2FtZSBtb2RlLiIgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1jZW50ZXIgc3BhY2UteC00IiwgY2hpbGRyZW46IFtfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IHN0YXJ0RnJlZVBsYXksIGNsYXNzTmFtZTogInB4LTYgcHktMyBiZy1jeWFuLTYwMC84MCBiYWNrZHJvcC1ibHVyLXNtIGJvcmRlci0yIGJvcmRlci1jeWFuLTUwMC81MCByb3VuZGVkLWxnIHRleHQtd2hpdGUgaG92ZXI6YmctY3lhbi01MDAgaG92ZXI6Ym9yZGVyLWN5YW4tNDAwIHRyYW5zaXRpb24gdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBzaGFkb3ctbGcgZm9udC1vcmJpdHJvbiIsIGNoaWxkcmVuOiAiRnJlZSBQbGF5IiB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVDaGFsbGVuZ2VTdGFydFJlcXVlc3QsIGNsYXNzTmFtZTogInB4LTYgcHktMyBiZy1wdXJwbGUtNjAwLzgwIGJhY2tkcm9wLWJsdXItc20gYm9yZGVyLTIgYm9yZGVyLXB1cnBsZS01MDAvNTAgcm91bmRlZC1sZyB0ZXh0LXdoaXRlIGhvdmVyOmJnLXB1cnBsZS01MDAgaG92ZXI6Ym9yZGVyLXB1cnBsZS00MDAgdHJhbnNpdGlvbiB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IHNoYWRvdy1sZyBmb250LW9yYml0cm9uIiwgY2hpbGRyZW46ICJDaGFsbGVuZ2UgTW9kZSIgfSldIH0pXSB9KSB9KSk7CiAgICBjb25zdCBDaGFsbGVuZ2VTdGFydFByb21wdCA9ICgpID0+IChfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGluc2V0LTAgYmctYmxhY2svNzAgYmFja2Ryb3AtYmx1ci1zbSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB6LTQwIHBvaW50ZXItZXZlbnRzLW5vbmUiLCBjaGlsZHJlbjogX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC1jZW50ZXIgcC04IGJnLWdyYXktOTAwIGJvcmRlci0yIGJvcmRlci1wdXJwbGUtNTAwLzUwIHJvdW5kZWQteGwgcG9pbnRlci1ldmVudHMtYXV0byBhbmltYXRlLXNjYWxlLWluIiwgY2hpbGRyZW46IFtfanN4KCJoMiIsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIGZvbnQtb3JiaXRyb24gdGV4dC1wdXJwbGUtMzAwIiwgY2hpbGRyZW46ICJDaGFsbGVuZ2UgTW9kZSIgfSksIF9qc3goInAiLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbXQtMiBtYi02IiwgY2hpbGRyZW46ICJTYXZlZCBwcm9ncmVzcyBmb3VuZC4gQ29udGludWUgb3Igc3RhcnQgYSBuZXcgZ2FtZT8iIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGp1c3RpZnktY2VudGVyIHNwYWNlLXgtNCIsIGNoaWxkcmVuOiBbX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVDb250aW51ZUNoYWxsZW5nZSwgY2xhc3NOYW1lOiAicHgtNiBweS0zIGJnLXB1cnBsZS02MDAvODAgcm91bmRlZC1sZyB0ZXh0LXdoaXRlIGhvdmVyOmJnLXB1cnBsZS01MDAgdHJhbnNpdGlvbiB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IGZvbnQtb3JiaXRyb24iLCBjaGlsZHJlbjogIkNvbnRpbnVlIiB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVOZXdDaGFsbGVuZ2VHYW1lLCBjbGFzc05hbWU6ICJweC02IHB5LTMgYmctZ3JheS02MDAvODAgcm91bmRlZC1sZyB0ZXh0LXdoaXRlIGhvdmVyOmJnLWdyYXktNTAwIHRyYW5zaXRpb24gdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBmb250LW9yYml0cm9uIiwgY2hpbGRyZW46ICJOZXcgR2FtZSIgfSldIH0pXSB9KSB9KSk7CiAgICBjb25zdCBDaGFsbGVuZ2VIVUQgPSAoKSA9PiAoX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgdG9wLTQgbGVmdC0xLzIgLXRyYW5zbGF0ZS14LTEvMiB3LWZ1bGwgbWF4LXctc20gYmctYmxhY2svNjAgYmFja2Ryb3AtYmx1ci1tZCBwLTMgcm91bmRlZC1sZyBib3JkZXItMiBib3JkZXItcHVycGxlLTUwMC81MCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgc2hhZG93LWxnIiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWxnIGZvbnQtYm9sZCIsIGNoaWxkcmVuOiBbIkxldmVsOiAiLCBfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXB1cnBsZS0zMDAgZm9udC1vcmJpdHJvbiIsIGNoaWxkcmVuOiBjaGFsbGVuZ2VTdGF0ZS5sZXZlbCB9KV0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInRleHQtY2VudGVyIiwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInRleHQtc20gdGV4dC1ncmF5LTQwMCIsIGNoaWxkcmVuOiAiVEFSR0VUIiB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIGZvbnQtYm9sZCBmb250LW9yYml0cm9uIiwgY2hpbGRyZW46IGNoYWxsZW5nZVN0YXRlLnRhcmdldD8ubmFtZSB9KV0gfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1vcmJpdHJvbiB0ZXh0LXB1cnBsZS0zMDAiLCBjaGlsZHJlbjogY2hhbGxlbmdlU3RhdGUudGltZXIgfSldIH0pKTsKICAgIHJldHVybiAoX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LWNvbC1yZXZlcnNlIG1kOmZsZXgtcm93IGgtc2NyZWVuIGJnLWdyYXktOTAwIHRleHQtd2hpdGUgb3ZlcmZsb3ctaGlkZGVuIiwgY2hpbGRyZW46IFtfanN4cygibWFpbiIsIHsgY2xhc3NOYW1lOiAiZmxleC1ncm93IGgtWzY1dmhdIG1kOmgtZnVsbCByZWxhdGl2ZSBiZy1ncmlkIiwgcmVmOiB3b3Jrc3BhY2VSZWYsIGNoaWxkcmVuOiBbX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBpbnNldC0wIGJnLXJhZGlhbC1ncmFkaWVudCIgfSksIGdhbWVNb2RlID09PSAnbWVudScgJiYgX2pzeChHYW1lTWVudSwge30pLCBzaG93Q2hhbGxlbmdlUHJvbXB0ICYmIF9qc3goQ2hhbGxlbmdlU3RhcnRQcm9tcHQsIHt9KSwgZ2FtZU1vZGUgPT09ICdjaGFsbGVuZ2UnICYmIGNoYWxsZW5nZVN0YXRlLmlzQWN0aXZlICYmIF9qc3goQ2hhbGxlbmdlSFVELCB7fSksIHdvcmtzcGFjZUVsZW1lbnRzLm1hcChlbCA9PiAoX2pzeChFbGVtZW50Q2FyZCwgeyBlbGVtZW50OiBlbCwgb25Nb3VzZURvd246IGhhbmRsZU1vdXNlRG93biwgaXNEcmFnZ2luZzogZHJhZ2dpbmdJbmZvLmN1cnJlbnQuaWQgPT09IGVsLmlkLCBpc0NvbWJpbmluZzogY29tYmluaW5nRWxlbWVudElkcy5pbmNsdWRlcyhlbC5pZCkgfSwgZWwuaWQpKSksIHBhcnRpY2xlQnVyc3QgJiYgKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAicGFydGljbGUtYnVyc3QiLCBzdHlsZTogeyB0b3A6IHBhcnRpY2xlQnVyc3QueSwgbGVmdDogcGFydGljbGVCdXJzdC54IH0sIGNoaWxkcmVuOiBbLi4uQXJyYXkoMTIpXS5tYXAoKF8sIGkpID0+IF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAicGFydGljbGUiLCBzdHlsZTogeyAnLS1pJzogaSB9IH0sIGkpKSB9LCBwYXJ0aWNsZUJ1cnN0LmtleSkpLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGJvdHRvbS00IHJpZ2h0LTQgZmxleCBzcGFjZS14LTQiLCBjaGlsZHJlbjogX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBnYW1lTW9kZSAhPT0gJ21lbnUnID8gaGFuZGxlRW5kR2FtZSgpIDogbnVsbCwgY2xhc3NOYW1lOiAicC0zIGJnLXJlZC04MDAvODAgYmFja2Ryb3AtYmx1ci1zbSBib3JkZXItMiBib3JkZXItcmVkLTUwMC81MCByb3VuZGVkLWZ1bGwgdGV4dC13aGl0ZSBob3ZlcjpiZy1yZWQtNzAwIGhvdmVyOmJvcmRlci1yZWQtNDAwIHRyYW5zaXRpb24gdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTExMCBzaGFkb3ctbGcgZGlzYWJsZWQ6b3BhY2l0eS01MCBkaXNhYmxlZDpjdXJzb3Itbm90LWFsbG93ZWQiLCBkaXNhYmxlZDogZ2FtZU1vZGUgPT09ICdtZW51JywgImFyaWEtbGFiZWwiOiBnYW1lTW9kZSA9PT0gJ2NoYWxsZW5nZScgPyAnUXVpdCBDaGFsbGVuZ2UnIDogJ1Jlc2V0IFdvcmtzcGFjZScsIGNoaWxkcmVuOiBnYW1lTW9kZSA9PT0gJ2NoYWxsZW5nZScgPyBfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJmb250LWJvbGQgcHgtMiIsIGNoaWxkcmVuOiAiUVVJVCIgfSkgOiBfanN4KFRyYXNoSWNvbiwgeyBjbGFzc05hbWU6ICJ3LTYgaC02IiB9KSB9KSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgdG9wLTQgbGVmdC00IGZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMiBiZy1ibGFjay81MCBwLTIgcm91bmRlZC1sZyIsIGNoaWxkcmVuOiBbX2pzeChTcGFya2xlc0ljb24sIHsgY2xhc3NOYW1lOiAidy02IGgtNiB0ZXh0LWN5YW4tMzAwIiB9KSwgX2pzeCgiaDEiLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIGZvbnQtYm9sZCBmb250LW9yYml0cm9uIHRleHQtY3lhbi0zMDAiLCBjaGlsZHJlbjogImdlbmNyYWZ0IiB9KV0gfSldIH0pLCBfanN4KFNpZGViYXIsIHsgZGlzY292ZXJlZEVsZW1lbnRzOiBkaXNjb3ZlcmVkRWxlbWVudHMsIG9uRWxlbWVudENsaWNrOiAoZWwpID0+IHNwYXduRWxlbWVudChlbCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGZhbHNlKSB9KSwgaXNMb2FkaW5nICYmIF9qc3goTG9hZGVyLCB7fSksIF9qc3goQUlQb3B1cCwgeyBtZXNzYWdlOiBwb3B1cE1lc3NhZ2UsIG9uQ2xvc2U6ICgpID0+IHNldFBvcHVwTWVzc2FnZShudWxsKSB9KSwgX2pzeCgic3R5bGUiLCB7IGNoaWxkcmVuOiBgCiAgICAgICAgYm9keSB7IC13ZWJraXQtZm9udC1zbW9vdGhpbmc6IGFudGlhbGlhc2VkOyAtbW96LW9zeC1mb250LXNtb290aGluZzogZ3JheXNjYWxlOyB9CiAgICAgICAgLmJnLWdyaWQgewogICAgICAgICAgYmFja2dyb3VuZC1pbWFnZToKICAgICAgICAgICAgbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCByZ2JhKDQsIDIxNywgMjU1LCAwLjEpIDFweCwgdHJhbnNwYXJlbnQgMXB4KSwKICAgICAgICAgICAgbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgcmdiYSg0LCAyMTcsIDI1NSwgMC4xKSAxcHgsIHRyYW5zcGFyZW50IDFweCk7CiAgICAgICAgICBiYWNrZ3JvdW5kLXNpemU6IDQwcHggNDBweDsKICAgICAgICB9CiAgICAgICAgLmJnLXJhZGlhbC1ncmFkaWVudCB7CiAgICAgICAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCB0cmFuc3BhcmVudCwgIzBmMTcyYSA3MCUpOwogICAgICAgIH0KICAgICAgICBAa2V5ZnJhbWVzIHNjYWxlSW4gewogICAgICAgICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGUoMC41KTsgb3BhY2l0eTogMDsgfQogICAgICAgICAgdG8geyB0cmFuc2Zvcm06IHNjYWxlKDEpOyBvcGFjaXR5OiAxOyB9CiAgICAgICAgfQogICAgICAgIC5hbmltYXRlLXNjYWxlLWluIHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBzY2FsZUluIDAuNHMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpIGZvcndhcmRzOwogICAgICAgIH0KICAgICAgICBAa2V5ZnJhbWVzIGZhZGVJbkRvd24gewogICAgICAgICAgZnJvbSB7IG9wYWNpdHk6IDA7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC0yMHB4KTsgfQogICAgICAgICAgdG8geyBvcGFjaXR5OiAxOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAwKTsgfQogICAgICAgIH0KICAgICAgICAuYW5pbWF0ZS1mYWRlLWluLWRvd24gewogICAgICAgICAgYW5pbWF0aW9uOiBmYWRlSW5Eb3duIDAuM3MgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICAgICAgfQogICAgICAgIC5wYXJ0aWNsZS1idXJzdCB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgd2lkdGg6IDFweDsKICAgICAgICAgICAgaGVpZ2h0OiAxcHg7CiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgICAgIH0KICAgICAgICAucGFydGljbGUgewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHdpZHRoOiA4cHg7CiAgICAgICAgICAgIGhlaWdodDogOHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMDZiNmQ0OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIGFuaW1hdGlvbjogYnVyc3QgMC42cyBlYXNlLW91dCBmb3J3YXJkczsKICAgICAgICB9CiAgICAgICAgQGtleWZyYW1lcyBidXJzdCB7CiAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCkgc2NhbGUoMSk7IG9wYWNpdHk6IDE7IH0KICAgICAgICAgICAgMTAwJSB7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZShjYWxjKGNvcyh2YXIoLS1pKSAqIDMwZGVnKSAqIDkwcHgpLCBjYWxjKHNpbih2YXIoLS1pKSAqIDMwZGVnKSAqIDkwcHgpKSBzY2FsZSgwKTsKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIGAgfSldIH0pKTsKfTsKZXhwb3J0IGRlZmF1bHQgQXBwOwo="}}</script>
        <script>
          window.APPLET_FILES = ["index.tsx","metadata.json","index.html","types.ts","services/geminiService.ts","components/icons.tsx","components/ElementCard.tsx","components/Sidebar.tsx","components/AIPopup.tsx","components/Loader.tsx","App.tsx","vercel.json"];
          </script>
        <script type="module">
        window.API_KEY = 'GEMINI_API_KEY';
window.GEMINI_API_KEY = 'GEMINI_API_KEY';
window.process = window.process || {};
window.process.env = window.process.env || {};
window.process.env.API_KEY = window.API_KEY;
window.process.env.GEMINI_API_KEY = window.GEMINI_API_KEY;

(() => {
  const bootstrapChannel = new Promise((resolve) => {
    window.addEventListener('message', (event) => {
      if (event.origin !== 'https://aistudio.google.com') {
        return;
      }

      if (event.data.type === 'bootstrap') {
        resolve({
          port: event.ports[0],
          urlPatterns:
              event.data.urlPatterns.map((pattern) => new RegExp(pattern)),
        });
      }
    });
  });

  window.aistudio = window.aistudio || {
    getHostUrl: async function() {
      const hostPort = (await bootstrapChannel).port;
      return new Promise((resolve) => {
        const channel = new MessageChannel();
        hostPort.postMessage(
            {type: 'get_host_url'},
            [channel.port2]);
        const port = channel.port1;
        port.onmessage = (message) => {
          resolve(message.data.url);
        };
      });
    },
    openSelectKey: async function() {
      const hostPort = (await bootstrapChannel).port;
      const channel = new MessageChannel();
      hostPort.postMessage(
          {type: 'open_select_key'},
          [channel.port2]);
    },
    getModelQuota: async function(model) {
      const hostPort = (await bootstrapChannel).port;
      return new Promise((resolve) => {
        const channel = new MessageChannel();
        hostPort.postMessage(
            {type: 'get_model_quota', model},
            [channel.port2]);
        const port = channel.port1;
        port.onmessage = (message) => {
          resolve(message.data.modelQuota);
        };
      });
    },
  };

  const nativeFetch = window.fetch;

  /**
   * @param {string | URL | Request} resource The resource of the fetch request.
   * @param {RequestInit} options The options of the fetch request.
   * @return {Promise!} The promise of the fetch request.
   */
  async function fetch(resource, options) {
    const config = await bootstrapChannel;

    const request = new Request(resource, options);
    if (!config.urlPatterns.some((pattern) => request.url.match(pattern))) {
      return nativeFetch(resource, options);
    }
    const hostPort = config.port;

    const channel = new MessageChannel();
    const port = channel.port1;
    let bodyBytes;
    const transfer = [channel.port2];
    const parts = [];
    const buffer = await request.arrayBuffer();
    if (buffer.byteLength) {
      bodyBytes = buffer;
      transfer.push(bodyBytes);
    }
    hostPort.postMessage(
        {
          type: 'fetch',
          url: request.url,
          method: request.method,
          headers: [...request.headers.entries()],
          body: bodyBytes,
        },
        transfer);

    let streamController;
    const body = new ReadableStream({
      start(controller) {
        streamController = controller;
      },
    });
    let resolveReceive;
    const receivePromise = new Promise((resolve) => {
      resolveReceive = resolve;
    });
    port.onmessage = (message) => {
      switch (message.data.type) {
        case 'response':
          resolveReceive(new Response(body, {
            status: message.data.status,
            statusText: message.data.statusText,
            headers: new Headers(message.data.headers),
          }));
          break;
        case 'body':
          streamController.enqueue(message.data.data);
          break;
        case 'body_done':
          streamController.close();
          break;
      }
    };
    return receivePromise;
  }

  Object.defineProperty(window, 'fetch', {
    get: function() {
      return fetch;
    },
  });

  // See details in: https://github.com/angular/angular/issues/63064.
  function patchHistoryStateFunctionForAngular(originalFn, baseHref) {
    return (state, unused, url) => {
      if (typeof url === 'string' && !url.startsWith('blob:')) {
        url = baseHref + url;
      }
      return originalFn.apply(window.history, [state, unused, url]);
    };
  }

  if (false) {
    const baseHref = window.location.href;
    window.history.replaceState = patchHistoryStateFunctionForAngular(window.history.replaceState, baseHref);
    window.history.pushState = patchHistoryStateFunctionForAngular(window.history.pushState, baseHref);
  }

  const originalWebSocket = window.WebSocket;
  class ProxiedWebSocket extends EventTarget {
    /**
     * @param {string} url The url of the websocket.
     * @param {Object!} protocols The protocols of the websocket.
     */
    constructor(url, protocols) {
      super();
      this.url = url;
      this.protocols = protocols;

      this.open();
    }

    /** Opens the websocket. */
    async open() {
      const hostPort = (await bootstrapChannel).port;
      const channel = new MessageChannel();
      hostPort.postMessage(
          {type: 'websocket_open', url: this.url, protocols: this.protocols},
          [channel.port2]);
      this.port = channel.port1;
      this.port.onmessage = (message) => {
        if (message.data.type === 'close') {
          const event = new CloseEvent('close', {
            code: message.data.code,
            reason: message.data.reason,
            wasClean: message.data.wasClean,
          });
          if (this.onclose) {
            this.onclose(event);
          }
          this.dispatchEvent(event);
          return;
        } else if (message.data.type === 'open') {
          const event = new Event('open');
          if (this.onopen) {
            this.onopen(event);
          }
          this.dispatchEvent(event);
          return;
        } else if (message.data.type === 'message') {
          let data = message.data.data;
          if (message.data.messageType === 'text' || message.data.messageType === 'message') {
            data = new TextDecoder().decode(data);
          }
          const event = new MessageEvent('message', {
            data,
            type: message.data.messageType,
          });
          if (this.onmessage) {
            this.onmessage(event);
          }
          this.dispatchEvent(event);
          return;
        } else if (message.data.type === 'error') {
          const event = new ErrorEvent('error', {
            message: message.data.message,
          });
          if (this.onerror) {
            this.onerror(event);
          }
          this.dispatchEvent(event);
          return;
        }
        console.error('received unknown message in frame', event.data);
      };
    }
    /**
     * @param {string|ArrayBuffer!} data The data to send.
     */
    send(data) {
      if (typeof data === 'string') {
        this.port.postMessage({type: 'send', data});
      } else {
        this.port.postMessage({type: 'send', data}, [data.buffer]);
      }
    }

    /**
     * @param {number} code The code of the close event.
     * @param {string} reason The reason of the close event.
     */
    close(code, reason) {
      this.port.postMessage({type: 'close', code, reason});
    }
  }

  /**
   * @param {string} url The url of the websocket.
   * @param {Object!} protocols The protocols of the websocket.
   * @return {WebSocket!} The websocket.
   */
  function createWebSocket(url, protocols) {
    // This should come from the bootstrap channel, but we want this to
    // work for the synchronous constructor here.
    if (url.startsWith('wss://generativelanguage.googleapis.com/')) {
      return Reflect.construct(ProxiedWebSocket, [url, protocols]);
    }
    return Reflect.construct(originalWebSocket, [url, protocols]);
  }

  Object.defineProperty(window, 'WebSocket', {
    get: function() {
      return createWebSocket;
    },
  });

  async function instrumentErrorReporting() {
    const errors = [];
    let hostPort;

    function reportError(message) {
      if (!hostPort) {
        errors.push(message);
      } else {
        hostPort.postMessage({type: 'error', message: message}, message);
      }
    }

    function serialize(args) {
      return args.map((a) => {
        if (a instanceof Error || a instanceof ErrorEvent) {
          return a.message;
        }
        if(a instanceof CloseEvent) {
          return {code: a.code, reason: a.reason, wasClean: a.wasClean};
        }
        if( a instanceof Map) {
          return JSON.parse(JSON.stringify([...a.entries()]));
        }
        if( a instanceof Set) {
          return JSON.parse(JSON.stringify([...a.values()]));
        }
        if (a instanceof Object) {
          return JSON.parse(JSON.stringify(a));
        }
        return a;
      });
    }

    const originalConsole = window.console;
    const originalConsoleLog = window.console.log;
    const originalConsoleError = window.console.error;
    const originalConsoleWarn = window.console.warn;
    const originalConsoleDebug = window.console.debug;
    window.console = {
      ...originalConsole,
      log: (message, ...args) => {
        originalConsoleLog.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_log', message: combined });
      },
      debug: (message, ...args) => {
        originalConsoleDebug.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_debug', message: combined });
      },
      error: (message, ...args) => {
        originalConsoleError.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_error', message: combined });
      },
      warn: (message, ...args) => {
        originalConsoleWarn.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_warn', message: combined });
      },
    };

    window.onerror = (message, source, lineno, colno, error) => {
      reportError({type: 'error', message: serialize([message]), source, lineno, colno, error});
    };

    window.onunhandledrejection = (event) => {
      reportError({type: 'unhandledrejection', message: serialize([event.reason])});
    };

    window.alert = (message) => {
      reportError({type: 'alert', message: serialize([message]) });
    };

    hostPort = (await bootstrapChannel).port;
    for(const error of errors) {
      hostPort.postMessage({type: 'error', message: error});
    }
  }

  const availableFiles = new Set(window.APPLET_FILES || []);

  instrumentErrorReporting();

  window.addEventListener('hashchange', async (e) =>{
    const config = await bootstrapChannel;
    const hostPort = config.port;
    hostPort.postMessage({type: 'hashchange', hash: window.location.hash});
  });

})();
// # sourceURL=iframe_shim.js
        </script>
        <base href="https://ai.studio">



    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/vite.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gencraft (Offline)</title>
    
    <!-- Apple Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="gencraft">
    
    <!-- Android/PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&amp;family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        -webkit-font-smoothing: antialiased; 
        -moz-osx-font-smoothing: grayscale;
      }
      .font-orbitron {
        font-family: 'Orbitron', sans-serif;
      }
      .bg-grid {
        background-image:
          linear-gradient(to right, rgba(4, 217, 255, 0.1) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(4, 217, 255, 0.1) 1px, transparent 1px);
        background-size: 40px 40px;
      }
      .bg-radial-gradient {
        background: radial-gradient(circle, transparent, #0f172a 70%);
      }
      @keyframes scaleIn {
        from { transform: scale(0.5); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }
      .animate-scale-in {
          animation: scaleIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      }
      @keyframes fadeInDown {
        from { opacity: 0; transform: translate(-50%, -20px); }
        to { opacity: 1; transform: translate(-50%, 0); }
      }
      .animate-fade-in-down {
        animation: fadeInDown 0.3s ease-out forwards;
      }
       @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
        40%, 60% { transform: translate3d(4px, 0, 0); }
      }
      .animate-shake {
          animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
      }
      .particle-burst {
          position: absolute;
          width: 1px;
          height: 1px;
          pointer-events: none;
      }
      .particle {
          position: absolute;
          width: 8px;
          height: 8px;
          background: #06b6d4;
          border-radius: 50%;
          animation: burst 0.6s ease-out forwards;
      }
      @keyframes burst {
          0% { transform: translate(0, 0) scale(1); opacity: 1; }
          100% {
              transform: translate(calc(cos(var(--i) * 30deg) * 90px), calc(sin(var(--i) * 30deg) * 90px)) scale(0);
              opacity: 0;
          }
      }
      .hidden {
        display: none !important;
      }
      .element-card {
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem;
        width: 10rem;
        height: 6rem;
        border-radius: 1rem;
        user-select: none;
        cursor: grab;
        transition: all 200ms ease-out;
        background-color: rgba(15, 23, 42, 0.7);
        backdrop-filter: blur(4px);
        border: 2px solid rgba(6, 182, 212, 0.5);
        color: white;
        box-shadow: 0 4px 6px -1px rgba(6, 182, 212, 0.2), 0 2px 4px -2px rgba(6, 182, 212, 0.2);
      }
      .element-card.dragging {
        border-color: #67e8f9;
        box-shadow: 0 0 15px rgba(103, 232, 249, 0.4);
        transform: scale(1.1);
        z-index: 30;
        cursor: grabbing;
      }
      .element-card.combining {
        opacity: 0.5;
        animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      .element-card.new {
        animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      }
      /* Intro Animation Styles */
      .intro-letter {
          position: absolute;
          font-size: 4rem; /* 64px */
          font-weight: bold;
          font-family: 'Orbitron', sans-serif;
          color: white;
          opacity: 0;
          animation-fill-mode: forwards;
          animation-duration: 1s;
          animation-timing-function: cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      #intro-d { animation-name: slide-in-d; animation-delay: 0.2s; }
      #intro-g { animation-name: slide-in-g; animation-delay: 0.4s; }
      #intro-a { animation-name: slide-in-a; animation-delay: 0.6s; }
      #intro-b { animation-name: slide-in-b; animation-delay: 0.8s; }

      #intro-subtitle {
          animation: fade-in-subtitle 1s ease-out 1.5s forwards;
      }

      @keyframes slide-in-d {
          from { transform: translate(-150px, -100px) scale(0.5); opacity: 0; }
          to { transform: translate(-72px, 0) scale(1); opacity: 1; }
      }
      @keyframes slide-in-g {
          from { transform: translate(150px, -100px) scale(0.5); opacity: 0; }
          to { transform: translate(-24px, 0) scale(1); opacity: 1; }
      }
      @keyframes slide-in-a {
          from { transform: translate(-150px, 100px) scale(0.5); opacity: 0; }
          to { transform: translate(24px, 0) scale(1); opacity: 1; }
      }
      @keyframes slide-in-b {
          from { transform: translate(150px, 100px) scale(0.5); opacity: 0; }
          to { transform: translate(72px, 0) scale(1); opacity: 1; }
      }

      @keyframes fade-in-subtitle {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
      }
    </style>
    <style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0px}.bottom-4{bottom:1rem}.left-1\/2{left:50%}.left-3{left:0.75rem}.left-4{left:1rem}.right-3{right:0.75rem}.right-4{right:1rem}.top-0{top:0px}.top-1\/2{top:50%}.top-4{top:1rem}.top-5{top:1.25rem}.z-10{z-index:10}.z-20{z-index:20}.z-40{z-index:40}.z-50{z-index:50}.z-\[100\]{z-index:100}.mb-6{margin-bottom:1.5rem}.mr-2{margin-right:0.5rem}.mt-2{margin-top:0.5rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-24{height:6rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-\[35vh\]{height:35vh}.h-\[65vh\]{height:65vh}.h-screen{height:100vh}.w-16{width:4rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-8{width:2rem}.w-full{width:100%}.max-w-md{max-width:28rem}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-pointer{cursor:pointer}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border-2{border-width:2px}.border-4{border-width:4px}.border{border-width:1px}.border-b-2{border-bottom-width:2px}.border-l-2{border-left-width:2px}.border-t-2{border-top-width:2px}.border-cyan-400{--tw-border-opacity:1;border-color:rgb(34 211 238 / var(--tw-border-opacity, 1))}.border-cyan-400\/20{border-color:rgb(34 211 238 / 0.2)}.border-cyan-500\/50{border-color:rgb(6 182 212 / 0.5)}.border-gray-500\/50{border-color:rgb(107 114 128 / 0.5)}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.border-gray-600\/50{border-color:rgb(75 85 99 / 0.5)}.border-purple-500\/50{border-color:rgb(168 85 247 / 0.5)}.border-red-500\/50{border-color:rgb(239 68 68 / 0.5)}.border-transparent{border-color:transparent}.border-t-transparent{border-top-color:transparent}.bg-black\/50{background-color:rgb(0 0 0 / 0.5)}.bg-black\/60{background-color:rgb(0 0 0 / 0.6)}.bg-black\/70{background-color:rgb(0 0 0 / 0.7)}.bg-cyan-500\/20{background-color:rgb(6 182 212 / 0.2)}.bg-cyan-600\/80{background-color:rgb(8 145 178 / 0.8)}.bg-gray-600\/80{background-color:rgb(75 85 99 / 0.8)}.bg-gray-700\/80{background-color:rgb(55 65 81 / 0.8)}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-gray-900\/50{background-color:rgb(17 24 39 / 0.5)}.bg-purple-600\/80{background-color:rgb(147 51 234 / 0.8)}.bg-red-800\/80{background-color:rgb(153 27 27 / 0.8)}.bg-gray-800\/50{background-color:rgb(31 41 55 / 0.5)}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-8{padding:2rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.pl-10{padding-left:2.5rem}.pr-10{padding-right:2.5rem}.pr-2{padding-right:0.5rem}.pt-6{padding-top:1.5rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.uppercase{text-transform:uppercase}.tracking-wider{letter-spacing:0.05em}.tracking-widest{letter-spacing:0.1em}.text-cyan-100\/70{color:rgb(207 250 254 / 0.7)}.text-cyan-300{--tw-text-opacity:1;color:rgb(103 232 249 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-purple-300{--tw-text-opacity:1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.opacity-0{opacity:0}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.backdrop-blur-lg{--tw-backdrop-blur:blur(16px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur:blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-200{transition-duration:200ms}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:scale-110:hover{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-cyan-400:hover{--tw-border-opacity:1;border-color:rgb(34 211 238 / var(--tw-border-opacity, 1))}.hover\:border-gray-400:hover{--tw-border-opacity:1;border-color:rgb(156 163 175 / var(--tw-border-opacity, 1))}.hover\:border-purple-400:hover{--tw-border-opacity:1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.hover\:border-red-400:hover{--tw-border-opacity:1;border-color:rgb(248 113 113 / var(--tw-border-opacity, 1))}.hover\:border-cyan-500:hover{--tw-border-opacity:1;border-color:rgb(6 182 212 / var(--tw-border-opacity, 1))}.hover\:bg-cyan-500:hover{--tw-bg-opacity:1;background-color:rgb(6 182 212 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-500:hover{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-700\/50:hover{background-color:rgb(55 65 81 / 0.5)}.hover\:bg-purple-500:hover{--tw-bg-opacity:1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-cyan-500\/20:hover{background-color:rgb(6 182 212 / 0.2)}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.focus\:border-cyan-400:focus{--tw-border-opacity:1;border-color:rgb(34 211 238 / var(--tw-border-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-cyan-400:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(34 211 238 / var(--tw-ring-opacity, 1))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:opacity-50:disabled{opacity:0.5}@media (min-width: 768px){.md\:h-full{height:100%}.md\:w-80{width:20rem}.md\:flex-row{flex-direction:row}}</style></head>
<body>
    <!-- Intro Animation -->
    <div id="intro-overlay" class="fixed inset-0 bg-gray-900 z-[100] flex flex-col items-center justify-center cursor-pointer hidden" style="transition: opacity 0.5s ease-out; opacity: 0; pointer-events: none;">
        <div class="relative w-64 h-24 flex items-center justify-center">
            <div id="intro-d" class="intro-letter">D</div>
            <div id="intro-g" class="intro-letter">G</div>
            <div id="intro-a" class="intro-letter">A</div>
            <div id="intro-b" class="intro-letter">B</div>
        </div>
        <div id="intro-subtitle" class="text-2xl text-cyan-300 font-orbitron opacity-0 mt-4">Game Studios</div>
    </div>

    <div id="root" class="flex flex-col-reverse md:flex-row h-screen bg-gray-900 text-white overflow-hidden">
      <!-- Main Content -->
      <main id="workspace" class="flex-grow h-[65vh] md:h-full relative bg-grid">
        <div class="absolute inset-0 bg-radial-gradient"></div>
        
        <!-- Branding Pill -->
        <a href="https://www.tiktok.com/@dhruvatdg8ab" target="_blank" rel="noopener noreferrer" class="absolute bottom-4 left-4 flex items-center space-x-2 bg-black/50 p-2 rounded-full backdrop-blur-sm transition-transform hover:scale-105 z-20">
            <img src="https://p16-sign.tiktokcdn-us.com/tos-useast5-avt-0068-tx/f632a446c61e4f5c01fa1271fcbfb129~tplv-tiktokx-cropcenter:1080:1080.jpeg?dr=9640&amp;refresh_token=ae5bf42c&amp;x-expires=1757610000&amp;x-signature=xjA5APVBqmtbQRewOWPbDrBj48E%3D&amp;t=4d5b0474&amp;ps=13740610&amp;shp=a5d48078&amp;shcp=81f88b70&amp;idc=useast5" alt="Dhruv Gowda" class="w-8 h-8 rounded-full border-2 border-cyan-400">
            <span class="text-sm font-bold text-white pr-2">Dhruv Gowda</span>
        </a>
        
        <!-- Game Title -->
        <div class="absolute top-4 left-4 flex items-center space-x-2 bg-black/50 p-2 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-cyan-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokewidth="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
            </svg>
            <h1 class="text-2xl font-bold font-orbitron text-cyan-300">gencraft</h1>
        </div>

        <!-- Game Menu -->
        <div id="game-menu" class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="text-center p-8 bg-black/50 rounded-xl pointer-events-auto">
                <h1 class="text-4xl font-bold font-orbitron text-cyan-300">gencraft</h1>
                <p class="text-gray-400 mt-2 mb-6">Choose your game mode.</p>
                <div class="flex justify-center space-x-4">
                    <button id="start-free-play" class="px-6 py-3 bg-cyan-600/80 backdrop-blur-sm border-2 border-cyan-500/50 rounded-lg text-white hover:bg-cyan-500 hover:border-cyan-400 transition transform hover:scale-105 shadow-lg font-orbitron">Free Play</button>
                    <button id="start-challenge" class="px-6 py-3 bg-purple-600/80 backdrop-blur-sm border-2 border-purple-500/50 rounded-lg text-white hover:bg-purple-500 hover:border-purple-400 transition transform hover:scale-105 shadow-lg font-orbitron">Challenge Mode</button>
                </div>
                
            </div>
        </div>

        <!-- API Key Modal for Download -->
        

        <!-- Challenge Start Prompt -->
        <div id="challenge-prompt" class="hidden absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-40 pointer-events-none">
            <div class="text-center p-8 bg-gray-900 border-2 border-purple-500/50 rounded-xl pointer-events-auto animate-scale-in">
                <h2 class="text-2xl font-bold font-orbitron text-purple-300">Challenge Mode</h2>
                <p class="text-gray-300 mt-2 mb-6">Saved progress found. Continue or start a new game?</p>
                <div class="flex justify-center space-x-4">
                    <button id="continue-challenge" class="px-6 py-3 bg-purple-600/80 rounded-lg text-white hover:bg-purple-500 transition transform hover:scale-105 font-orbitron">Continue</button>
                    <button id="new-challenge" class="px-6 py-3 bg-gray-600/80 rounded-lg text-white hover:bg-gray-500 transition transform hover:scale-105 font-orbitron">New Game</button>
                </div>
            </div>
        </div>

        <!-- Challenge HUD -->
        <div id="challenge-hud" class="hidden absolute top-4 left-1/2 -translate-x-1/2 w-full max-w-sm bg-black/60 backdrop-blur-md p-3 rounded-lg border-2 border-purple-500/50 flex justify-between items-center shadow-lg">
            <div class="text-lg font-bold">
              Level: <span id="challenge-level" class="text-purple-300 font-orbitron">1</span>
            </div>
            <div class="text-center">
              <div class="text-sm text-gray-400">TARGET</div>
              <div id="challenge-target" class="text-xl font-bold font-orbitron">Steam</div>
            </div>
            <div id="challenge-timer" class="text-2xl font-orbitron text-purple-300">
              00:00
            </div>
        </div>
        
        <!-- Controls -->
        <div class="absolute bottom-4 right-4 flex space-x-4">
          <button id="end-game-btn" class="p-3 bg-red-800/80 backdrop-blur-sm border-2 border-red-500/50 rounded-full text-white hover:bg-red-700 hover:border-red-400 transition transform hover:scale-110 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled="">
            <span id="end-game-btn-content">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
            </span>
          </button>
        </div>
      </main>

      <!-- Sidebar -->
      <aside class="w-full md:w-80 h-[35vh] md:h-full bg-black/50 backdrop-blur-lg border-l-2 border-cyan-400/20 flex flex-col">
          <div class="p-4 border-b-2 border-cyan-400/20">
              <h2 class="text-2xl font-bold text-center text-cyan-300 font-orbitron">Discoveries</h2>
              <p id="discovery-count" class="text-center text-sm text-cyan-100/70">4 found</p>
          </div>
          
          <div class="flex border-b-2 border-cyan-400/20">
              <button id="tab-elements" class="flex-1 p-2 text-sm font-bold uppercase tracking-wider transition-colors bg-cyan-500/20 text-cyan-300">Elements</button>
              <button id="tab-recipes" class="flex-1 p-2 text-sm font-bold uppercase tracking-wider transition-colors text-gray-400 hover:bg-gray-700/50">Recipes</button>
          </div>

          <div class="p-2 border-b-2 border-cyan-400/20 sticky top-0 bg-gray-900/50 z-10">
              <div class="relative">
                  <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                  </svg>
                  <input id="search-input" type="text" placeholder="Search..." class="w-full bg-gray-800 border-2 border-gray-600 rounded-lg pl-10 pr-10 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 transition">
                  <button id="clear-search-btn" class="hidden absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
              </div>
          </div>

          <div class="flex-grow overflow-y-auto p-2">
            <!-- Elements List -->
            <div id="elements-list" class="grid grid-cols-2 gap-2"><button class="flex items-center p-2 bg-gray-800/50 rounded-lg hover:bg-cyan-500/20 border border-transparent hover:border-cyan-500 transition-all duration-200 transform hover:scale-105"><span class="text-2xl mr-2"></span><span class="text-white text-sm truncate">Air</span></button><button class="flex items-center p-2 bg-gray-800/50 rounded-lg hover:bg-cyan-500/20 border border-transparent hover:border-cyan-500 transition-all duration-200 transform hover:scale-105"><span class="text-2xl mr-2"></span><span class="text-white text-sm truncate">Earth</span></button><button class="flex items-center p-2 bg-gray-800/50 rounded-lg hover:bg-cyan-500/20 border border-transparent hover:border-cyan-500 transition-all duration-200 transform hover:scale-105"><span class="text-2xl mr-2"></span><span class="text-white text-sm truncate">Fire</span></button><button class="flex items-center p-2 bg-gray-800/50 rounded-lg hover:bg-cyan-500/20 border border-transparent hover:border-cyan-500 transition-all duration-200 transform hover:scale-105"><span class="text-2xl mr-2"></span><span class="text-white text-sm truncate">Water</span></button></div>
            <!-- Recipes List -->
            <div id="recipes-list" class="hidden space-y-2"></div>
            <!-- Empty State -->
            <div id="elements-empty-state" class="hidden text-center text-gray-400 mt-8 px-4">
              <p>No elements found. Drag elements from the workspace to start combining!</p>
            </div>
            <div id="recipes-empty-state" class="text-center text-gray-400 mt-8 px-4">
                <p>No recipes found. Combine elements to discover them!</p>
            </div>
          </div>
      </aside>

      <!-- Loader -->
      <div id="loader" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center z-50">
        <div class="w-16 h-16 border-4 border-cyan-400 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 text-xl text-white font-orbitron tracking-widest animate-pulse">Combining...</p>
      </div>

      <!-- AI Popup -->
      <div id="ai-popup" class="hidden fixed top-5 left-1/2 -translate-x-1/2 w-full max-w-sm p-4 rounded-lg shadow-2xl border-2 backdrop-blur-md z-50 animate-fade-in-down">
          <!-- Content will be generated by JS -->
      </div>
    </div>
    
    


        <script type="module" onerror="console.error('Failed to load the app. Try reloading it.')">import '@/index';</script>
        <script type="module">
        // Dynamically import the Google GenAI library from a CDN.
        import { GoogleGenAI, Type } from "https://esm.sh/@google/genai";
        
        // The game script expects these to be on the window object.
        (window as any).googleGenai = { GoogleGenAI, Type };
        
        // Execute the entire game's logic string.
        // Using eval is necessary here to run the self-contained script string.
        // JSON.stringify ensures the string is safely embedded.
        eval("(() => {\n        // --- Start of Embedded App Script ---\n        const { GoogleGenAI, Type } = window.googleGenai;\n        // --- Embedded Sound Manager ---\n        const SoundManager = { audioContext: null, isInitialized: false, init() { if (this.isInitialized || typeof window.AudioContext === 'undefined')\n                return; try {\n                this.audioContext = new AudioContext();\n                this.isInitialized = true;\n            }\n            catch (e) {\n                console.error(\"Web Audio API is not supported in this browser.\", e);\n            } }, playSound(type, frequency, duration, volume = 0.5) { if (!this.audioContext)\n                return; const oscillator = this.audioContext.createOscillator(); const gainNode = this.audioContext.createGain(); oscillator.connect(gainNode); gainNode.connect(this.audioContext.destination); oscillator.type = type; oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime); gainNode.gain.setValueAtTime(volume, this.audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.0001, this.audioContext.currentTime + duration); oscillator.start(this.audioContext.currentTime); oscillator.stop(this.audioContext.currentTime + duration); }, playClick() { if (!this.isInitialized)\n                this.init(); if (!this.audioContext)\n                return; this.playSound('triangle', 500, 0.1, 0.3); this.playSound('triangle', 800, 0.1, 0.3); }, playTab() { if (!this.isInitialized)\n                return; this.playSound('sine', 700, 0.08, 0.2); }, playCombine() { if (!this.isInitialized)\n                return; this.playSound('sawtooth', 200, 0.2, 0.4); this.playSound('sawtooth', 100, 0.3, 0.4); }, playDiscover() { if (!this.isInitialized || !this.audioContext)\n                return; setTimeout(() => this.playSound('sine', 523.25, 0.1, 0.4), 0); setTimeout(() => this.playSound('sine', 659.25, 0.1, 0.4), 100); setTimeout(() => this.playSound('sine', 783.99, 0.1, 0.4), 200); setTimeout(() => this.playSound('sine', 1046.50, 0.2, 0.5), 300); }, playError() { if (!this.isInitialized)\n                return; this.playSound('square', 150, 0.2, 0.3); } };\n        const premadeCombinations = {\n            'Air_Earth': { name: 'Dust', emoji: '' }, 'Air_Fire': { name: 'Smoke', emoji: '' }, 'Air_Water': { name: 'Rain', emoji: '' }, 'Earth_Fire': { name: 'Lava', emoji: '' }, 'Earth_Water': { name: 'Plant', emoji: '' }, 'Fire_Water': { name: 'Steam', emoji: '' }, 'Dust_Fire': { name: 'Gunpowder', emoji: '' }, 'Dust_Water': { name: 'Mud', emoji: '' }, 'Earth_Lava': { name: 'Volcano', emoji: '' }, 'Lava_Water': { name: 'Stone', emoji: '' }, 'Lava_Air': { name: 'Obsidian', emoji: '' }, 'Plant_Fire': { name: 'Ash', emoji: '' }, 'Plant_Smoke': { name: 'Tobacco', emoji: '' }, 'Plant_Stone': { name: 'Fossil', emoji: '' }, 'Plant_Water': { name: 'Swamp', emoji: '' }, 'Plant_Air': { name: 'Pollen', emoji: '' }, 'Plant_Earth': { name: 'Grass', emoji: '' }, 'Rain_Earth': { name: 'Mud', emoji: '' }, 'Rain_Fire': { name: 'Rainbow', emoji: '' }, 'Steam_Air': { name: 'Cloud', emoji: '' }, 'Steam_Earth': { name: 'Geyser', emoji: '' }, 'Smoke_Water': { name: 'Fog', emoji: '' }, 'Ash_Stone': { name: 'Statue', emoji: '' }, 'Cloud_Fire': { name: 'Lightning', emoji: '' }, 'Cloud_Water': { name: 'Rain', emoji: '' }, 'Grass_Grass': { name: 'Lawn', emoji: '' }, 'Grass_Earth': { name: 'Field', emoji: '' }, 'Lightning_Metal': { name: 'Electricity', emoji: '' }, 'Lightning_Earth': { name: 'Crystal', emoji: '' }, 'Mud_Fire': { name: 'Brick', emoji: '' }, 'Stone_Fire': { name: 'Metal', emoji: '' }, 'Stone_Water': { name: 'Sand', emoji: '' }, 'Stone_Air': { name: 'Sandstorm', emoji: '' }, 'Brick_Brick': { name: 'Wall', emoji: '' }, 'Electricity_Glass': { name: 'Light Bulb', emoji: '' }, 'Metal_Water': { name: 'Rust', emoji: '' }, 'Sand_Fire': { name: 'Glass', emoji: '' }, 'Wall_Wall': { name: 'House', emoji: '' }, 'Earth_Earth': { name: 'Land', emoji: '' }, 'Water_Water': { name: 'Sea', emoji: '' }, 'Sea_Sea': { name: 'Ocean', emoji: '' }, 'Ocean_Earth': { name: 'Island', emoji: '' }, 'Plant_Plant': { name: 'Garden', emoji: '' }, 'Garden_Plant': { name: 'Forest', emoji: '' }, 'Forest_Fire': { name: 'Wildfire', emoji: '' }, 'Stone_Stone': { name: 'Mountain', emoji: '' }, 'Mountain_Lava': { name: 'Eruption', emoji: '' }, 'Earth_Life': { name: 'Human', emoji: '' }, 'Fire_Life': { name: 'Phoenix', emoji: '' }, 'Human_Plant': { name: 'Farmer', emoji: '' }, 'Human_Stone': { name: 'Tool', emoji: '' }, 'Human_Fire': { name: 'Cook', emoji: '' }, 'Human_Water': { name: 'Sailor', emoji: '' }, 'Human_Human': { name: 'Love', emoji: '' }, 'Human_House': { name: 'Family', emoji: '' }, 'Farmer_Field': { name: 'Wheat', emoji: '' }, 'Tool_Forest': { name: 'Wood', emoji: '' }, 'Tool_Wood': { name: 'Wheel', emoji: '' }, 'Wheat_Stone': { name: 'Flour', emoji: '' }, 'Flour_Water': { name: 'Dough', emoji: '' }, 'Dough_Fire': { name: 'Bread', emoji: '' },\n        };\n        const responseSchema = { type: Type.OBJECT, properties: { name: { type: Type.STRING, description: \"The name of the resulting element. Should be simple, one or two words. If the combination is nonsensical or results in the same element, use 'Nothing' or the original element's name.\" }, emoji: { type: Type.STRING, description: \"A single, relevant emoji for the resulting element. Use '' for nonsensical combinations.\" }, isNewDiscovery: { type: Type.BOOLEAN, description: \"Set to true if the combination creates a genuinely new and distinct element. Set to false if it results in 'Nothing', one of the original elements, or something trivial.\" }, commentary: { type: Type.STRING, description: \"A quirky, short, first-person comment from the perspective of the new element. Max 15 words.\" } }, required: [\"name\", \"emoji\", \"isNewDiscovery\", \"commentary\"] };\n        const initialElements = [{ name: 'Water', emoji: '' }, { name: 'Fire', emoji: '' }, { name: 'Earth', emoji: '' }, { name: 'Air', emoji: '' }];\n        const challengeTiers = [[{ name: 'Steam', emoji: '' }, { name: 'Dust', emoji: '' }, { name: 'Rain', emoji: '' }, { name: 'Lava', emoji: '' }], [{ name: 'Stone', emoji: '' }, { name: 'Plant', emoji: '' }, { name: 'Smoke', emoji: '' }, { name: 'Obsidian', emoji: '' }], [{ name: 'Mud', emoji: '' }, { name: 'Brick', emoji: '' }, { name: 'Grass', emoji: '' }, { name: 'Sand', emoji: '' }], [{ name: 'Metal', emoji: '' }, { name: 'Glass', emoji: '' }, { name: 'Wall', emoji: '' }, { name: 'Lightning', emoji: '' }], [{ name: 'House', emoji: '' }, { name: 'Electricity', emoji: '' }, { name: 'Human', emoji: '' }, { name: 'Phoenix', emoji: '' }]];\n        const DISCOVERED_ELEMENTS_KEY = 'gencraft_discoveredElements';\n        const CHALLENGE_LEVEL_KEY = 'gencraft_challengeLevel';\n        let gameMode = 'menu', workspaceElements = [], discoveredElements = [...initialElements], challengeState = { level: 0, target: null, startTime: 0, timer: '00:00', isActive: false };\n        let nextId = 0, timerInterval, draggingInfo = { id: null, element: null, offsetX: 0, offsetY: 0 };\n        let endGameBtnDefaultContent = null;\n        const ai = new GoogleGenAI({ apiKey: 'AIzaSyBAUlZw6XBSqPA_I64LByOGpBrIzge9BMI' });\n        async function getCombination(element1, element2) {\n            const key = [element1.name, element2.name].sort().join('_');\n            if (premadeCombinations[key])\n                return { ...premadeCombinations[key], isNew: true, commentary: 'A classic combination!' };\n            if (element1.name === element2.name)\n                return { name: element1.name, emoji: element1.emoji, isNew: false, commentary: 'Two of the same make no change.' };\n            try {\n                const prompt = `You are an AI for a creative alchemy game. What is created when you combine \"${element1.name} ${element1.emoji}\" and \"${element2.name} ${element2.emoji}\"?\\n- If it creates a new, logical item, provide its name, emoji, and a fun commentary from its perspective.\\n- If the combination is illogical, impossible, or just makes more of one of the inputs (e.g., Fire + Fire), respond with a result where isNewDiscovery is false.\\n- Keep the names simple (1-3 words). - Be creative and consistent.`;\n                const response = await ai.models.generateContent({ model: 'gemini-2.5-flash', contents: prompt, config: { responseMimeType: 'application/json', responseSchema, temperature: 0.8 } });\n                const result = JSON.parse(response.text.trim());\n                return { name: result.name, emoji: result.emoji, isNew: result.isNewDiscovery, commentary: result.commentary };\n            }\n            catch (error) {\n                console.error(\"Error calling Gemini API:\", error);\n                return null;\n            }\n        }\n        function saveProgress() { if (gameMode === 'free')\n            try {\n                localStorage.setItem(DISCOVERED_ELEMENTS_KEY, JSON.stringify(discoveredElements));\n            }\n            catch (e) {\n                console.error(\"Failed to save progress:\", e);\n            } }\n        function loadProgress() {\n            const savedDiscoveries = localStorage.getItem(DISCOVERED_ELEMENTS_KEY);\n            if (savedDiscoveries) {\n                try {\n                    const parsed = JSON.parse(savedDiscoveries);\n                    if (Array.isArray(parsed) && parsed.length >= initialElements.length && parsed[0].name)\n                        discoveredElements = parsed;\n                }\n                catch (e) {\n                    console.error(\"Failed to parse saved discoveries:\", e);\n                }\n            }\n        }\n        const workspace = document.getElementById('workspace'), gameMenu = document.getElementById('game-menu'), challengePrompt = document.getElementById('challenge-prompt'), challengeHUD = document.getElementById('challenge-hud'), endGameBtn = document.getElementById('end-game-btn'), loader = document.getElementById('loader'), aiPopup = document.getElementById('ai-popup'), discoveryCount = document.getElementById('discovery-count'), elementsList = document.getElementById('elements-list'), recipesList = document.getElementById('recipes-list'), searchInput = document.getElementById('search-input'), tabElements = document.getElementById('tab-elements'), tabRecipes = document.getElementById('tab-recipes'), elementsEmptyState = document.getElementById('elements-empty-state'), recipesEmptyState = document.getElementById('recipes-empty-state'), clearSearchBtn = document.getElementById('clear-search-btn'), introOverlay = document.getElementById('intro-overlay');\n        function updateUI() {\n            gameMenu.classList.toggle('hidden', gameMode !== 'menu');\n            challengeHUD.classList.toggle('hidden', gameMode !== 'challenge' || !challengeState.isActive);\n            endGameBtn.disabled = gameMode === 'menu';\n            if (gameMode === 'challenge') {\n                document.getElementById('challenge-level').textContent = challengeState.level.toString();\n                document.getElementById('challenge-target').textContent = challengeState.target?.name || '...';\n                document.getElementById('challenge-timer').textContent = challengeState.timer;\n                endGameBtn.innerHTML = '<span class=\"font-bold px-2\">QUIT</span>';\n            }\n            else {\n                if (endGameBtnDefaultContent) {\n                    endGameBtn.innerHTML = endGameBtnDefaultContent;\n                }\n            }\n            renderSidebar();\n            renderWorkspace();\n        }\n        function renderWorkspace() {\n            workspace.querySelectorAll('.element-card').forEach(el => el.remove());\n            workspaceElements.forEach(el => {\n                const card = document.createElement('div');\n                card.className = 'element-card';\n                card.dataset.id = String(el.id);\n                card.style.left = `${el.x}px`;\n                card.style.top = `${el.y}px`;\n                card.innerHTML = `<div class=\"text-4xl mr-3 pointer-events-none\">${el.emoji}</div><div class=\"text-lg font-bold font-orbitron pointer-events-none truncate\">${el.name}</div>`;\n                if (el.isNew) {\n                    card.classList.add('new');\n                    setTimeout(() => card.classList.remove('new'), 500);\n                }\n                card.addEventListener('mousedown', (e) => handleMouseDown(e, el.id));\n                workspace.appendChild(card);\n            });\n        }\n        function renderSidebar() {\n            const term = searchInput.value.toLowerCase();\n            discoveryCount.textContent = `${discoveredElements.length} found`;\n            const filteredElements = discoveredElements.filter(el => el.name.toLowerCase().includes(term)).sort((a, b) => a.name.localeCompare(b.name));\n            elementsList.innerHTML = '';\n            if (filteredElements.length > 0) {\n                filteredElements.forEach(el => { const btn = document.createElement('button'); btn.className = \"flex items-center p-2 bg-gray-800/50 rounded-lg hover:bg-cyan-500/20 border border-transparent hover:border-cyan-500 transition-all duration-200 transform hover:scale-105\"; btn.innerHTML = `<span class=\"text-2xl mr-2\">${el.emoji}</span><span class=\"text-white text-sm truncate\">${el.name}</span>`; btn.onclick = () => spawnElement(el, undefined, undefined, false); elementsList.appendChild(btn); });\n            }\n            elementsEmptyState.classList.toggle('hidden', filteredElements.length > 0);\n            const filteredRecipes = discoveredElements.filter(el => el.recipe && (el.name.toLowerCase().includes(term) || el.recipe.element1.toLowerCase().includes(term) || el.recipe.element2.toLowerCase().includes(term))).sort((a, b) => a.name.localeCompare(b.name));\n            recipesList.innerHTML = '';\n            if (filteredRecipes.length > 0) {\n                filteredRecipes.forEach(el => { const div = document.createElement('div'); div.className = \"p-2 bg-gray-800/50 rounded-lg text-sm text-center\"; div.innerHTML = `<span class=\"font-bold\">${el.recipe.element1}</span> + <span class=\"font-bold\">${el.recipe.element2}</span>  <span class=\"text-cyan-300 font-bold\">${el.name} ${el.emoji}</span>`; recipesList.appendChild(div); });\n            }\n            recipesEmptyState.classList.toggle('hidden', filteredRecipes.length > 0);\n        }\n        function showLoader(show) { loader.classList.toggle('hidden', !show); }\n        function showAIPopup({ type, title, text, commentary }) {\n            const themes = { success: { bg: 'bg-green-900/80', border: 'border-green-400', icon: 'text-green-300' }, error: { bg: 'bg-red-900/80', border: 'border-red-400', icon: 'text-red-300' }, info: { bg: 'bg-blue-900/80', border: 'border-blue-400', icon: 'text-blue-300' } };\n            const theme = themes[type];\n            aiPopup.className = `fixed top-5 left-1/2 -translate-x-1/2 w-full max-w-sm p-4 rounded-lg shadow-2xl border-2 backdrop-blur-md z-50 animate-fade-in-down ${theme.bg} ${theme.border}`;\n            let commentaryHtml = commentary ? `<p class=\"mt-2 text-sm italic border-l-2 pl-2 ${theme.border} ${theme.icon}\">${commentary}</p>` : '';\n            aiPopup.innerHTML = `<div class=\"flex items-start\"><div class=\"flex-shrink-0\"><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 ${theme.icon}\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z\" /></svg></div><div class=\"ml-3 w-0 flex-1\"><p class=\"text-lg font-bold font-orbitron text-white\">${title}</p><p class=\"mt-1 text-sm ${type === 'success' ? 'text-green-200' : type === 'error' ? 'text-red-200' : 'text-blue-200'}\">${text}</p>${commentaryHtml}</div><div class=\"ml-4 flex-shrink-0 flex\"><button id=\"close-popup-btn\" class=\"inline-flex rounded-md text-gray-300 hover:text-white\"><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" /></svg></button></div></div>`;\n            aiPopup.classList.remove('hidden');\n            document.getElementById('close-popup-btn').onclick = () => aiPopup.classList.add('hidden');\n            setTimeout(() => aiPopup.classList.add('hidden'), 6000);\n        }\n        function createParticleBurst(x, y) { const burst = document.createElement('div'); burst.className = 'particle-burst'; burst.style.left = `${x + 80}px`; burst.style.top = `${y + 48}px`; for (let i = 0; i < 12; i++) {\n            const particle = document.createElement('div');\n            particle.className = 'particle';\n            particle.style.setProperty('--i', String(i));\n            burst.appendChild(particle);\n        } workspace.appendChild(burst); setTimeout(() => burst.remove(), 600); }\n        function spawnElement(element, x, y, isNew = true) { const bounds = workspace.getBoundingClientRect(); const newX = x ?? Math.random() * (bounds.width - 200) + 20; const newY = y ?? Math.random() * (bounds.height - 150) + 20; workspaceElements.push({ ...element, id: nextId++, x: newX, y: newY, isNew }); renderWorkspace(); }\n        function resetWorkspace(spawnInitial = true) {\n            workspaceElements = [];\n            if (spawnInitial) {\n                const bounds = workspace.getBoundingClientRect();\n                const positions = [{ x: bounds.width / 2 - 160 - 20, y: bounds.height / 2 - 96 - 20 }, { x: bounds.width / 2 + 20, y: bounds.height / 2 - 96 - 20 }, { x: bounds.width / 2 - 160 - 20, y: bounds.height / 2 + 20 }, { x: bounds.width / 2 + 20, y: bounds.height / 2 + 20 },];\n                initialElements.forEach((el, i) => spawnElement(el, positions[i].x, positions[i].y, false));\n            }\n            renderWorkspace();\n        }\n        async function performCombination(el1, el2) {\n            const card1 = workspace.querySelector(`.element-card[data-id='${el1.id}']`), card2 = workspace.querySelector(`.element-card[data-id='${el2.id}']`);\n            card1?.classList.add('combining');\n            card2?.classList.add('combining');\n            SoundManager.playCombine();\n            showLoader(true);\n            const result = await getCombination(el1, el2);\n            if (result && result.isNew) {\n                SoundManager.playDiscover();\n                const isFirstDiscovery = !discoveredElements.some(d => d.name === result.name);\n                const newElement = { name: result.name, emoji: result.emoji };\n                if (isFirstDiscovery) {\n                    discoveredElements.push({ ...newElement, recipe: { element1: el1.name, element2: el2.name } });\n                    saveProgress();\n                    showAIPopup({ type: 'success', title: 'First Discovery!', text: `You've created ${result.name} ${result.emoji}!`, commentary: result.commentary });\n                }\n                else {\n                    showAIPopup({ type: 'info', title: 'New Element!', text: `You made ${result.name} ${result.emoji}!`, commentary: result.commentary });\n                }\n                const spawnX = (el1.x + el2.x) / 2, spawnY = (el1.y + el2.y) / 2;\n                workspaceElements = workspaceElements.filter(el => el.id !== el1.id && el.id !== el2.id);\n                spawnElement(newElement, spawnX, spawnY);\n                createParticleBurst(spawnX, spawnY);\n                if (gameMode === 'challenge' && result.name === challengeState.target?.name) {\n                    challengeState.isActive = false;\n                    clearInterval(timerInterval);\n                    const timeTaken = (Date.now() - challengeState.startTime) / 1000;\n                    const tierIndex = Math.min(Math.floor((challengeState.level - 1) / 2), challengeTiers.length - 1);\n                    const goldTime = 10 + tierIndex * 5, silverTime = 20 + tierIndex * 10;\n                    let rank = 'Bronze ';\n                    if (timeTaken < goldTime)\n                        rank = 'Gold ';\n                    else if (timeTaken < silverTime)\n                        rank = 'Silver ';\n                    showAIPopup({ type: 'success', title: `Level ${challengeState.level} Complete!`, text: `Rank: ${rank} | Time: ${timeTaken.toFixed(1)}s`, commentary: `You crafted ${challengeState.target.name}!` });\n                    localStorage.setItem(CHALLENGE_LEVEL_KEY, JSON.stringify(challengeState.level));\n                    setTimeout(() => startNextLevel(challengeState.level), 4000);\n                }\n            }\n            else {\n                SoundManager.playError();\n                const reason = result ? `Combining ${el1.name} and ${el2.name} results in ${result.name}. Nothing new created.` : \"Those elements don't seem to combine well.\";\n                showAIPopup({ type: 'error', title: 'No Reaction', text: reason, commentary: result?.commentary });\n            }\n            showLoader(false);\n            card1?.classList.remove('combining');\n            card2?.classList.remove('combining');\n            updateUI();\n        }\n        function handleMouseDown(e, id) {\n            if (gameMode === 'menu' || draggingInfo.id)\n                return;\n            const element = workspaceElements.find(el => el.id === id);\n            const card = e.currentTarget;\n            if (!element || !card)\n                return;\n            card.classList.add('dragging');\n            draggingInfo = { id, element: card, offsetX: e.clientX - card.getBoundingClientRect().left, offsetY: e.clientY - card.getBoundingClientRect().top, };\n            workspace.appendChild(card);\n            document.onmousemove = handleMouseMove;\n            document.onmouseup = handleMouseUp;\n        }\n        function handleMouseMove(e) {\n            if (!draggingInfo.id || !draggingInfo.element)\n                return;\n            const { element, offsetX, offsetY } = draggingInfo;\n            const workspaceRect = workspace.getBoundingClientRect();\n            let x = e.clientX - workspaceRect.left - offsetX, y = e.clientY - workspaceRect.top - offsetY;\n            x = Math.max(0, Math.min(x, workspaceRect.width - element.offsetWidth));\n            y = Math.max(0, Math.min(y, workspaceRect.height - element.offsetHeight));\n            element.style.left = `${x}px`;\n            element.style.top = `${y}px`;\n            const draggedRect = element.getBoundingClientRect();\n            for (const otherEl of workspaceElements) {\n                if (otherEl.id === draggingInfo.id)\n                    continue;\n                const otherCard = workspace.querySelector(`.element-card[data-id='${otherEl.id}']`);\n                if (!otherCard)\n                    continue;\n                const otherRect = otherCard.getBoundingClientRect();\n                if (draggedRect.left < otherRect.right && draggedRect.right > otherRect.left && draggedRect.top < otherRect.bottom && draggedRect.bottom > otherRect.top) {\n                    const draggedElement = workspaceElements.find(el => el.id === draggingInfo.id);\n                    if (draggedElement) {\n                        draggedElement.x = x;\n                        draggedElement.y = y;\n                        handleMouseUp();\n                        performCombination(draggedElement, otherEl);\n                        return;\n                    }\n                }\n            }\n        }\n        function handleMouseUp() {\n            if (!draggingInfo.id || !draggingInfo.element)\n                return;\n            const { id, element } = draggingInfo;\n            const elInState = workspaceElements.find(el => el.id === id);\n            if (elInState) {\n                elInState.x = parseFloat(element.style.left);\n                elInState.y = parseFloat(element.style.top);\n            }\n            element.classList.remove('dragging');\n            draggingInfo = { id: null, element: null, offsetX: 0, offsetY: 0 };\n            document.onmousemove = null;\n            document.onmouseup = null;\n        }\n        function startNextLevel(currentLevel) {\n            const nextLevel = currentLevel + 1;\n            const tierIndex = Math.min(Math.floor((nextLevel - 1) / 2), challengeTiers.length - 1);\n            const tier = challengeTiers[tierIndex];\n            const target = tier[Math.floor(Math.random() * tier.length)];\n            challengeState = { level: nextLevel, target, startTime: Date.now(), timer: '00:00', isActive: true };\n            timerInterval = window.setInterval(() => { const seconds = Math.floor((Date.now() - challengeState.startTime) / 1000); const mins = Math.floor(seconds / 60).toString().padStart(2, '0'); const secs = (seconds % 60).toString().padStart(2, '0'); challengeState.timer = `${mins}:${secs}`; document.getElementById('challenge-timer').textContent = challengeState.timer; }, 1000);\n            resetWorkspace();\n            updateUI();\n        }\n        function startFreePlay() { gameMode = 'free'; resetWorkspace(); updateUI(); }\n        function handleChallengeStartRequest() { const savedLevel = localStorage.getItem(CHALLENGE_LEVEL_KEY); if (savedLevel && parseInt(savedLevel, 10) > 0) {\n            challengePrompt.classList.remove('hidden');\n        }\n        else {\n            handleNewChallengeGame();\n        } }\n        function handleContinueChallenge() { const savedLevel = parseInt(localStorage.getItem(CHALLENGE_LEVEL_KEY) || '0', 10); gameMode = 'challenge'; discoveredElements = [...initialElements]; startNextLevel(savedLevel); challengePrompt.classList.add('hidden'); }\n        function handleNewChallengeGame() { localStorage.removeItem(CHALLENGE_LEVEL_KEY); gameMode = 'challenge'; discoveredElements = [...initialElements]; startNextLevel(0); challengePrompt.classList.add('hidden'); }\n        function handleEndGame() { gameMode = 'menu'; workspaceElements = []; if (challengeState.isActive) {\n            challengeState.isActive = false;\n            clearInterval(timerInterval);\n        } updateUI(); }\n        function init() {\n            loadProgress();\n            if (endGameBtn) {\n                endGameBtnDefaultContent = endGameBtn.innerHTML;\n            }\n            document.getElementById('start-free-play').addEventListener('click', () => { SoundManager.init(); SoundManager.playClick(); startFreePlay(); });\n            document.getElementById('start-challenge').addEventListener('click', () => { SoundManager.init(); SoundManager.playClick(); handleChallengeStartRequest(); });\n            document.getElementById('continue-challenge').addEventListener('click', () => { SoundManager.playClick(); handleContinueChallenge(); });\n            document.getElementById('new-challenge').addEventListener('click', () => { SoundManager.playClick(); handleNewChallengeGame(); });\n            endGameBtn.addEventListener('click', () => { SoundManager.playClick(); handleEndGame(); });\n            searchInput.addEventListener('input', renderSidebar);\n            clearSearchBtn.addEventListener('click', () => { searchInput.value = ''; renderSidebar(); SoundManager.playClick(); });\n            tabElements.addEventListener('click', () => { elementsList.classList.remove('hidden'); recipesList.classList.add('hidden'); tabElements.classList.add('bg-cyan-500/20', 'text-cyan-300'); tabRecipes.classList.remove('bg-cyan-500/20', 'text-cyan-300'); SoundManager.playTab(); });\n            tabRecipes.addEventListener('click', () => { elementsList.classList.add('hidden'); recipesList.classList.remove('hidden'); tabRecipes.classList.add('bg-cyan-500/20', 'text-cyan-300'); tabElements.classList.remove('bg-cyan-500/20', 'text-cyan-300'); SoundManager.playTab(); });\n            if (introOverlay) {\n                introOverlay.addEventListener('click', () => {\n                    introOverlay.style.transition = 'opacity 0.5s ease-out';\n                    introOverlay.style.opacity = '0';\n                    introOverlay.style.pointerEvents = 'none';\n                    setTimeout(() => { introOverlay.classList.add('hidden'); }, 500);\n                });\n            }\n            updateUI();\n        }\n        init();\n        // --- End of Embedded App Script ---\n    })()");
    </script></body></html>